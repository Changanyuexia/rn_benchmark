commits,release
"Update CHANGELOG.md
parser(ini): allow setting the section name

In an egg replacer putting `[]` will cause it to not be split at the first dot.

Before this change putting `""find"": { ""/Script/Engine.GameSession.MaxPlayers"": ""<DATA>"" }`
would make the section name `/Script/Engine` and the key `GameSession.MaxPlayers`.  After
this change, the same behavior occurs, but if you wrap the key in `[]` it will set the
section name properly, for example `""find"": { ""[/Script/Engine.GameSession].MaxPlayers"": ""<DATA>"" }`
would make the sesion name `/Script/Engine.GameSession` and the key `MaxPlayers`.

Closes https://github.com/pterodactyl/panel/issues/2533
replace deprecated ioutil function calls
change default version to be 'develop'
config: don't expand 'environment variables'

fixes https://github.com/pterodactyl/panel/issues/3692, again :)
run gofumpt
Update diagnostics command ()

Co-authored-by: Matthew Penner <me@matthewp.io>
ci: fix version replace and Docker version
ci: fix release version, again
RPM is now tracking v1.5.3 ()
Redacts redacted info from all ()
environment: allow overriding memory overhead; closes pterodactyl/panel ()
Don't turn SSL into lowercase ()
Server Event Optimizations ()
router: support the `Access-Control-Request-Private-Network` header ()
Update CHANGELOG.md
Use GID from config for container ()
server: ensure last lines are always logged","Fixed
Fixes SSL paths being improperly converted to lowercase in environments where the path is case-sensitive.
Fixes a memory leak due to the implemention of server event processing.
Changed
Selecting to redact information now redacts URLs from the log output when running the diagnostic command.
Added
Adds support for modifying the default memory overhead percentages in environments where the shipped values are not adequate.
Adds support for sending the Access-Control-Request-Private-Network header in environments where Wings will be accessed over a private network. This is defaulted to off.
SHA256 Checksum"
"Update CHANGELOG.md
Support escaping dollar signs in the YAML config file; closes pterodactyl/panel
Close websocket connections and allow the client to re-connect on send errors; ref pterodactyl/panel
fix incorrect error handling logic when a JWT is created wrongly; closes pterodactyl/panel

Prior to this logic not only was the error response incorrect for events, but we registered event listeners before the authentication event; so if auth failed we flooded the socket with tons of output that was never going to be sent anyways.

This change now waits to register listeners until the socket is fully authenticated and we're guaranteed to have a token present.
Update CHANGELOG.md","Fixed
Fixes improper event registration and error handling during socket authentication that would cause the incorrect error message to be returned to the client, or no error in some scenarios. Event registration is now delayed until the socket is fully authenticated to ensure needless listeners are not registed.
Fixes dollar signs always being evaluated as environment variables with no way to escape them. They can now be escaped as $$ which will transform into a single dollar sign.
Changed
A websocket connection to a server will be closed by Wings if there is a send error encountered and the client will be left to handle reconnections, rather than simply logging the error and continuing to listen for new events.
SHA256 Checksum"
"Version bump (15.1)
Added more debug profile info and hidden esn
Update Polish strings

Update to the last database changes.
Fix esn key handshake on session initialization

In the many prevoius changes i made a mistake,
the esn after initialization should always be maintained
because the key handshake was created with that esn.
To keep in mind that however that the esn from the web login and
esn used locally are different.
Also there was a check for the change of esn in the login was incorrect.
Perform upgrade and configuration checks after login
Implemented create SQLite database
Deleted database files
Readded superclass methods to shared db class
Fix LibraryUpdateService at first run

At service very first run, settings.xml is not created yet and throws an error
""update_frequency = g.ADDON.getSettingInt('auto_update') TypeError: Invalid setting type""
If falkor cache profile list is empty do not delete profiles
Version bump (15.2)","Fixed key handshake at addon first run
Fixed library update service at first run
Local database now dynamically created by code
Profile data is not deleted if an problem occurred
Minor fixes"
"Version bump (1.12.6) ()
Fix search by language
Fix missing/wrong MPD data
Version bump (1.12.7) ()","Fixed wrong/missing MPD data
Fixed bug in search by subtitle/audio language"
"Version bump (0.15.10)
Update README.md

*Updated logging instructions
Moved some imports inside func to speedup
Fixed SQLite thread error on py3

ProgrammingError:
SQLite objects created in a thread can only be used in that same thread.
The object was created in thread id 140332173866752 and this is thread
id 140333045176064.
Fixed decode on py3
Fixed default logging level
Print to the log the logging level if enabled
write dvhe codec for hevc-dv* (Dolby Vision) in manifest
Sync with My List only when enabled
Update fr translation
Update Dutch translation

This PR includes:
- Updates and fixes to Dutch translations
Version bump (0.15.11)","Fixed a critical error on auto-update
Fixed some error on py3
Fix to handle dolby vision on Kodi 19
Updated fr_fr, nl_nl translations
Minor fixes"
"Version bump (1.2.0)
Update README.md
Intercept missing library on linux
Catch possible error on rollback
Update README.md

New daily builds link
Added accept prop to endpoints config
Fixed double profile switch with autoselection

this also fix:
-case of ProfileMissing, when a profile is deleted and autoselection try
to login with it
-case of ProfileMissing, when open the addon and the profile set as active no more exists
-avoid performing switch profile when return to main menu from sub-menus
Add some falcor json graph helper functions
Revert accept attribute

no influence to the authurl issue
Add profilegate endpoint

to now only for take note
Add json graph optional param
Reviewed first access and profile switch

this is an attempt to reproduce more accurately the access and the profile switch,
in order to be able to find a solution to the http 401 error problem,
the situation has improved but in some cases the error still persist
Fixed unrelated pylint
On Kodi 19 makeLegalFilename is moved to xbmcvfs module
Fixed first param as list
Changed service address with 127.0.0.1 see note
Minor event data update
Fixed h265 video mediaflag
Fixed get_video_raw_data path request

cause of KeyError: u'videos' error when play videos
Init lenght more precise
Fixed conversion of protection data
Catch error 401 more deeply

the http 401 error seem apparently more complex
Fixed send signal to upnext

sending a signal to upnext addon with empty data will cause upnext to crash
this will be handled in the future upnext addon versions
Add CDN selection setting
Catch InputStreamHelper errors avoids confusing users

most of the time they think the problem is in this add-on
Add missing return
fix wrong timestamps in viewing activity
remove fractional seconds sent in logblobs
fix CacheMiss exception in StreamContinuityManager ()

* fix CacheMiss exception in StreamContinuityManager

* convert local variable to class
Reorganized service playback modules
Removed not needed imports
Set time limit for paused playback
Assign proper cdn id after ae8e17aea7478ba24c7281c10e4fe6b83cfebd69
Updated it translation
Try handle MSL error ""Email or password is incorrect""
Fixed password validity check regression
Updated german translation für v.1.2.1 ()

* Updated german translation for v. 1.2.1

See

* Updated german translation

* Fixed ""Open Connect CDN""

See
Version bump (1.2.1)","Reviewed access and profile selection to mitigate http error 401 (not resolved)
Add Open Connect CDN setting
Set time limit for paused playback
Fixed a issue caused wrong date in viewing activity
Fixed dash content protection data
Fixed a issue caused UpNext to crash
Fixed a issue caused KeyError when play videos
Fixed a issue caused TypeError on more addon rollback
Fixed a issue caused a double profile switch on selection
Fixed a issue caused slow playback video starts (on windows)
Fixed a issue caused missing of h265 media flag
Fixed broken ""force the update of my list"" context menu
Some changes for Kodi 19 due to API changes
Updated translations de, it
Other minor improvements/changes"
"Version bump (1.18.3) ()
Use single `viewableId` instead of list

This PR solves (or at least works around?) the issue described in and is inspired by the fixes posted there. I don't know whether this really fixes an underlying issue, but it at least gets playback working again for me.
Fixed tvshow.nfo not exported on library update
Sync translations with en
Update strings.po ()
JP/KR tranlsation (1.18.4) ()
Updated german translation for version 1.18.4 ()
Updated it translation
Version bump (1.18.4) ()","Fix error ""This title is not available to watch instantly"" when using MSL manifest v1
Fixed tvshow.nfo not exported on library auto-update
Update translations gl_es, jp, kr, de"
"Version bump (1.20.4) ()
Revert ""Replaced MSL idtoken auth with netflixid on android""

This reverts commit 906f5dd2406bab1f1756147fede35ca3b284bb10.

Website has fixed the bug
Handle ErrorMessage on display_error_info
Disabled update loco context on playback stop
Removed fetching of loco data

By testing seems the website now is able to auto update the category menu continue watching
Add uiVersion to event params
Pylint fixes
Update Simplified Chinese translation for 1.20.5 ()
update zh_TW language ()
Version bump (1.20.5) ()","NOTICE FOR ANDROID DEVICES: The website has fixed the recent bug for ""MSL: Email or password is incorrect"" error,
so video playback is now restored for all Android devices.
Disabled update loco context, is not more used to update watched status
Minor changes
Update translations zh_cn, zh_tw"
"v0.3.4
Update liquidjs dependancy
Fixes
Got 3 more skipped tests passing too!
Fixes
Add note about quoted/unquoted includes on liquid templates.
Automatic browsersync server reload if pathPrefix changes in config. All config changes _should_ happen transparently without requiring manual intervention.
Better handling of redirects (with cleanup)
Move browsersync stuff to EleventyServe class.
Check to make sure we have a path before we split it
Switch to an async file read
Fixes, wraps it all in a try catch.
Only browser-sync on --serve
Fix for .htaccess (all files starting with dot) in passthrough copies
make sure path exists when comparing isInclude, removes pify (superfluous with fs-extra)
Fixes
v0.3.5","Eleventy is a simpler Static Site Generator!
https://www.11ty.io/
Getting Started Quick Guide
Support Eleventy by starring us on GitHub! This will increase our project’s visibility on staticgen.com, a big giant list of static site generators.
Follow us on Twitter @​eleven_ty!
Changelog
Option to opt-out of automatic .gitignore ignores in Eleventy. Use eleventyConfig.setUseGitIgnore(false);:
Major semver update: Upgrades liquidjs to 4.0.0:
Fixes issue with using permalink in layout front matter.
Fixes issue with using collections and pagination together
Milestone
Bugs fixed in Milestone"
"v0.3.5
Fixes
Add some tests around
Fixes !!!!!!!!!!!!!!
Regression with data.page.url and data.page.outputPath for
Regressions around url and outputPath in collections
Better handling of vague indexOf errors when passing non-string values to url filter
Add tests and docs around existing support for JSON and JS front matter.
Moved documentation to 11ty.io/docs
Moved docs to 11ty.io
Add logo to README and keywords to package.json
Try to center the logo
Try for centering
Fixes
Comment
v0.3.6","Eleventy is a simpler Static Site Generator!
https://www.11ty.io/
Documentation
Support Eleventy by starring us on GitHub! This will increase our project’s visibility on staticgen.com, a big giant list of static site generators.
Follow us on Twitter @​eleven_ty!
Changelog
Fix issue with cascade of template and directory data files (template values should override directory values, the reverse was happening)
url filter now accepts falsy values (improvement over vague indexOf errors before)
Fix for issue with pagination with aliasing and permalink slug filter
Better top level error handling (get rid of UnhandledPromiseRejectionWarning’s, especially with passthrough copy errors)
Milestone
Bugs fixed in v0.3.6 Milestone"
"Fix race condition with File#mkdirs ()
Remove annotations from a list with size greater than 1 while preserving the exising formatting in RemoveAnnotationVisitor. fixes. ()
Added check for empty leadingAnnotations in visitClassDec of RemoveAnnotationVisitor. fixes.
Append `.` to pck in longest common prefix in Autodetect#getPattern. Refactored rewriteImportLayout test to reflect changes. fixes ()
Fixes","Fixes:
Remove annotations from a list with size greater than 1.
RemoveAnnotation throws index out of bounds if a leading annotation doesn't exist
OrderImports sets blocks with common packages to all others.
JavaVisitor#visitMethodDeclaration doesn't visit annotations on the name prefix."
"Fix AddGradleEnterpriseTest to account for minor version upgrades
Added support for empty json files.
Converted JsonParserTest from kotlin to java and updated with RewriteTest.
fixes
Maven credentials in the execution context were being incorrectly ignored. Fixes
Fix license.
Updated parent scope detection to handle java records in the RemoveUnusedLocalVariables recipe.
fixes
Updated parent scope detection to handle java records in the RenameLocalVariablesToCamelCase recipe.
fixes
Remove buildSrc in favor of a plugin built separately ()
Do not call JavaType$Class#getKind() on null object in BlockStatementTemplateGenerator.
fixes
Set group to org.openrewrite, add shadow plugin to rewrite-gradle
Add AutoCRLF and EOL to GitProvenance
Reproducer for ChangeType on private inner class creates import statements that fails to compile ()
Disabled test to reproduce issue 2521 in ChangeTypeTest.
FindDependency doesn't attempt to match configuration when configuration is blank
ChangeDependency* reacts to blank configuration options correctly
Fix import
FindDependency now supports glob (Gradle)
Add `visitValue` to PropertyVisitor ()

Co-authored-by: Tyler Van Gorder <tkvangorder@users.noreply.github.com>
Also type-attribute Gradle's defunct 'runtime' configuration to facilitate migration and modernization of old build files
Do not import classes that are declared in the CU in the ChangeType recipe. ()

fixes.
Updated parent scope detection to check for java records in RenamePrivateFieldsToCamelCase.
fixes
Yaml parsing of arrays test
added FindProperties.find
Convert rewrite-xml tests to Java/RewriteTest. Deprecate XmlRecipeTest
Convert rewrite-proto tests to Java/RewriteTest. Deprecate ProtoRecipeTest
Convert rewrite-properties tests to Java/RewriteTest. Deprecate PropertiesRecipeTest
Add Set range support and find wrapper recipe ()
Added Properties.Comment.Delimiter to distinguish between comments delimited by `#` or `!`.
fixes
Make `FinalizeLocalVariables` aware of non-modifying unary operators ()

The non-modifying unary operators (`-`, `+`, `~`, and `!`) must not prevent a local variable from being made final.
Preserve the source code delimiter of property entries in PropertiesParser. ()

* Preserve the source code delimiter of property entries in PropertiesParser.
Updated PropertiesPrinter.
Added Option to AddProperty to set the delimiter.
fixes

* Updated rewrite-gradle recipes that add property entries.

* Updated ActivateStyle.
Polish. Removed unused imports in FindProperty.
Replaced getMarkers().searchResult() with SearchResult.found(..)
Add description to all projects, it is a required field when publishing
Disable annotation parameter default value type information until we can figure out how to do it correctly
Finish disabling java type mapping annotaiton default values
Enable package private SourceFile path renames in ChangeType.
fixes
Add the Gradle testRuntime configuration ()
Add metedata plugin to bom project","What's Changed
JSON parser doesn't support empty JSON files
Remove buildSrc in favor of a plugin built separately by @jkschneider in
RemoveUnusedLocalVariables doesn't correctly handle records
NPE in BlockStatementTemplateGenerator
Add AutoCRLF and EOL to GitProvenance cb44631
ChangeDependency* reacts to blank configuration options correctly 1f9e170
FindDependency doesn't attempt to match configuration when the configuration is blank ab9d3d2
FindDependency now supports glob (Gradle) a3b9752
Reproducer for ChangeType on private inner class creates import state… by @ge0ffrey in
Add visitValue() to PropertyVisitor by @tkvangorder in
Added FindProperties.find() 114051c
Do not import classes that are declared in the CU in the ChangeType recipe. by @traceyyoshima in
Add Set range support and find wrapper recipe by @shanman190 in
Make FinalizeLocalVariables aware of non-modifying unary operators by @knutwannheden in
Preserve the source code delimiter of property entries in PropertiesParser by @traceyyoshima in
Full Changelog: v7.34.0...v7.34.1"
"Add async modifier for use in kotlin/python/etc
enhancement: improve CompareEnumsWithEqualityOperator to support unwrap parentheses
Ensure that non-fatal groovy parser warnings do not show up as parse failures
Suppress any exceptions which might pop up from closing jgit","What's Changed
Ensure that non-fatal groovy parser warnings do not show up as parse failures by @sambsnyd in cb7a700
Suppress any exceptions when closing jgit by @sambsnyd in 93ab5a0
Improve CompareEnumsWithEqualityOperator to support unwrapping parentheses by @kunli2 in 1520590
Full Changelog: v7.37.0...v7.37.1"
"FindTags throws ClassCastException (fixes)
Add MemberReference to MethodMatcher ()
Add overloaded constructor to `AddProperty`. Fixes
Ensure JavaType.Method's primary constructor is the Jackson @JsonCreater
Any source applicable tests should be ANDed together not ORed / fixes
Any source applicable tests should be ANDed together not ORed / fixes
Fix broken test","What's Changed
Add MemberReference to MethodMatcher by @JLLeitschuh in
Any source applicable tests should be applied together as a logical and instead of a logical or
Add overloaded constructor in AddProperty to maintain backward compatibility
Ensure JavaType.Method primary constructor is the Jackson @JsonCreater a252912
Full Changelog: v7.34.2...v7.34.3"
"More data in FindParseFailures ()
Update java-categories.yml
SearchResult is now final
[Rewrite8 migration]Add recipe to migrate JavaTemplate to rewrite8
Add license headers
[rewrite8 migration]Make MigrateMarkersSearchResult works again
Add support for instanceof to groovy parser
Add recipe UpdateMovedPackageClassName to update class fqn after moving it to a new package
[rewrite8 migration] Add a recipe to update referencing package name for the recipes moved to rewrite-static-analysis
[rewrite8 migration] Add handling of removed TreeVisitor#doAfterVisit(Recipe)
Fix/yaml encoding ()

* fix: use StringReader without explicit encoding ()

* fix: handle InputStream with try-resource ()
Update Gradle Enterprise plugin to 3.13.3 ()
TypeUtils#isOfType infinite recursion ()
Tweak style autodetect ()
Java import autodetect extracts import package name (and other stats) eagerly
Do not throw when visiting a block not contained in a method declaration
[Rewrite8 migration]polish and add examples
[Rewrite8 migration] Add recipe to handle moved recipe in yaml file && polish && more tests
fix: Scan ScanningRecipes too when scanning jars ()
Avoid duplicate recipe loads
License headers
Fix UpdateStaticAnalysisPackageTest","What's Changed
Fix/yaml encoding by @thomaszub in
Update Gradle Enterprise plugin to 3.13.3 by @jprinet in
TypeUtils#isOfType infinite recursion by @jkschneider in
Tweak style autodetect by @sambsnyd in
fix: Scan ScanningRecipes too when scanning jars by @kmccarp in
New Contributors
@jprinet made their first contribution in
Full Changelog: v8.1.1...v8.1.2"
"Add placeholder to keep space between Groovy String curly braces ()
Remove Analysis Code From Rewrite ()

* Remove Analysis Code From Rewrite

Signed-off-by: Jonathan Leitschuh <Jonathan.Leitschuh@gmail.com>

* Empty to retrigger CI run

Signed-off-by: Jonathan Leitschuh <Jonathan.Leitschuh@gmail.com>

---------

Signed-off-by: Jonathan Leitschuh <Jonathan.Leitschuh@gmail.com>
Add exception for `J.EnumValueSet` to `WrappingAndBracesTest`

Since the individual enum constants own the prefix, the `J.EnumValueSet` doesn't have any.

Fixes:
`ReplaceConstantWithAnotherConstant` should keep static imports ()

To minimize the diff and maintain the original coding style the `ReplaceConstantWithAnotherConstant` recipe should replace static imports of the constant with another static import for the new constant and update `J.Identifier` references accordingly.

Co-authored-by: Tim te Beek <tim@moderne.io>
Correct marker computation for replace, if present
Support G.GString types in ChangeDependencyGroupId

Fixes gh-3239
Support G.GString types in ChangeDependencyArtifactId

Fixes gh-3240
Polish
Add support for G.GString matching when adding dependencies

Fixes gh-3209
Reproducer for Gradle change dependency ignores platform ()

* Reproducer for Gradle change dependency ignores platform

* Add support for Gradle platform dependency updates

Fixes gh-3227

---------

Co-authored-by: Shannon Pamperl <shanman190@gmail.com>
Support 21-ea as value for java.version in JavaParser ()

For https://github.com/openrewrite/rewrite/issues/3170
fix: parse environment properties in maven repositories ()

* fix: parse environment properties in maven repositories

Fixes

* Make resolveEnvironmentPropertyName private

* Correctly resolve `password` instead of username field

---------

Co-authored-by: Tim te Beek <tim@moderne.io>
Fixes RenamePropertyKey and ChangePropertyValue running together ()

* Fixes RenamePropertyKey and ChangePropertyValue running together don't work as expected

* Update rewrite-maven/src/test/java/org/openrewrite/maven/RenamePropertyKeyTest.java

* Update rewrite-maven/src/test/java/org/openrewrite/maven/RenamePropertyKeyTest.java
Fix NoClassDefFoundError in RewriteTest on jgit diff() ()

Fixes https://github.com/openrewrite/rewrite/issues/3243
Improve accuracy and performance of template matching

`J.SwitchExpression` and `J.TypeCast` now also implement `TypedTree` so that they can be matched against a `JavaTemplate`.

Also make sure to not match any `J.Empty` against a template parameter placeholder.
Feature/gradle/enhance update java compatibility ()

* Rename ChangeJavaCompatibility => UpdateJavaCompatibility

* Add more capabilities for updating Gradle Java compatibility

* Apply formatter

* Add several combination tests to ensure robustness

* Add a few more variation tests and fix a bug with string styling

* Lowercase source and target enum values

* Have Option valid values match enum case

---------

Co-authored-by: Tim te Beek <tim@moderne.io>
Co-authored-by: Tim te Beek <timtebeek@gmail.com>
Handle assignments in Gradle extra properties ()
JavaParser classpath from byte array has issue with default package ()

* JavaParser classpath from byte array has issue with default package

For https://github.com/openrewrite/rewrite/issues/3222

* Add missing licences
Suppress exceptions in Autodetect to prevent it from dying on some kotlin sources
Fix AddGradleEnterpriseMavenExtension running on Windows
Add options to the Add Gradle Enterprise Maven recipe ()

* Add options to the Add Gradle Enterprise Maven recipe

* Apply formatter

---------

Co-authored-by: Tim te Beek <tim@moderne.io>
Invalid Javadoc should remain unchanged ()

Co-authored-by: Michael Duerig <michael.duerig@magnolia-cms.com>
Support default package in `JavaParser.Builder.classpath(byte[][])` ()

Fixes

Sets package to """" for classes in default package, not identical to class name.
Compare XML tag names for equality ()

Fixes
fix: skip blocked repository ()

* fix: skip blocked repository

* temp: add temporary commit with a limit

* Slight polish

---------

Co-authored-by: Tim te Beek <tim@moderne.io>","What's Changed
Remove Analysis Code From Rewrite by @JLLeitschuh in
ReplaceConstantWithAnotherConstant should keep static imports by @knutwannheden in
Reproducer for Gradle change dependency ignores platform by @ge0ffrey in
Support 21-ea as value for java.version in JavaParser by @timtebeek in
fix: parse environment properties in maven repositories by @yeikel in
Fixes RenamePropertyKey and ChangePropertyValue running together by @ge0ffrey in
Fix NoClassDefFoundError in RewriteTest on jgit diff() by @timtebeek in
Feature/gradle/enhance update java compatibility by @shanman190 in
Handle assignments in Gradle extra properties by @shanman190 in
JavaParser classpath from byte array has issue with default package by @timtebeek in
Add options to the Add Gradle Enterprise Maven recipe by @alextu in
Invalid Javadoc should remain unchanged by @mduerig in
Support default package in JavaParser.Builder.classpath(byte[][]) by @timtebeek in
Compare XML tag names for equality by @timtebeek in
fix: skip blocked repository by @yeikel in
Full Changelog: v7.40.7...v7.40.8"
"Update preconditions hint in yaml recipes ()
Migrate single-source applicability tests to preconditions ()

Co-authored-by: Tim te Beek <tim@moderne.io>
Prevent NPE as reported due to null normalized repository ()

Possibly due to mirrors applied with property placeholders
Don't use static import on collision with local method ()

If a class declares a method with the same name as a candidate for a static import, then that will always lead to compile errors if the static import is applied. Therefore the recipe must check for not having any similarly named method locally.
Fix plain text parser failing to consider the path ""README.md"" as being matched by a pattern like ""**/README.md""
Handle `JavaType.Intersection` in `DefaultJavaTypeSignatureBuilder` ()

Fixes:","What's Changed
Migrate single-source applicability tests to preconditions by @knutwannheden in
Prevent NPE as reported due to null normalized repository by @timtebeek in
Don't use static import on collision with local method by @Bananeweizen in
Handle JavaType.Intersection in DefaultJavaTypeSignatureBuilder by @knutwannheden in
Full Changelog: v8.9.6...v8.9.7"
"Flip equals to prevent NPE for nullable plugin.groupId
Switch to Objects.equals for null safe plugin comparison
Add recipe `AddLiteralMethodArgument` ()

* Add recipe `AddLiteralMethodArgument`

This recipe finds a method and adds a literal argument at the specified index.

* Use `valid` to validate  type option

Co-authored-by: Tim te Beek <tim@moderne.io>

---------

Co-authored-by: Tim te Beek <tim@moderne.io>
Fall back to  default groupId when comparing plugins

Fixes openrewrite/rewrite-maven-plugin
As per https://github.com/openrewrite/rewrite-maven-plugin/issues/745#issuecomment-1966447178
Get tools compiling again
Get tools compiling
Guard against NPE in MavenVisitor#visitPlugin","What's Changed
Add recipe AddLiteralMethodArgument by @pstreef in
Guard against NPE in MavenVisitor#visitPlugin by @jkschneider in  e2a8cb8
Full Changelog: v8.18.1...v8.18.2"
"Fix parsing of Groovy sources containing extra parentheses on Java 8
refactor: Update Gradle wrapper

Use this link to re-run the recipe: https://app.moderne.io/recipes/org.openrewrite.gradle.UpdateGradleWrapper?organizationId=T3BlblJld3JpdGU%3D

Co-authored-by: Moderne <team@moderne.io>
Add whitespace validation to RewriteTest
Changes packaging only if it matches provided packaging ()
chore: Delete unused .github/workflows/dependency-check.yml

Use this link to re-run the recipe: https://app.moderne.io/recipes/org.openrewrite.DeleteSourceFiles?organizationId=T3BlblJld3JpdGU%3D

Co-authored-by: Moderne <team@moderne.io>
`MergeYaml` should only make changes when required
Decouple UpdateGradleWrapperTest from project Gradle version
Resolve unrelated test failures and add disabled dedicated test
Drop UseJavaParserBuilderInJavaTemplate following
Another trailing comma parser error with arrays
Use `Tree.randomId()` to construct LST elements, not `UUID.randomUUID()` ()

* Added recipe for modifying references to 'UUID.randomUUID()' to 'Tree.randomId()', and test

* Changed the recipe so that it only changes UUID.randomID() to Tree.randomId() only when it is used as a parameter in an LST constructor.

* Modified the recipe as instructed. Improved the test statements

* Apply suggestions from code review

* Adopt review suggestions

---------

Co-authored-by: Tim te Beek <tim@moderne.io>
Fix cast exception in UseTreeRandomId

IntelliJ extract method failed me. :/
Document non-whitespace semicolon after class

As discovered on https://github.com/openrewrite/rewrite-spring/commit/7fd47ab78835cc7c1ac824cb0c563a59e6bf32c1
refactor: Remove `public` visibility of JUnit 5 tests

Use this link to re-run the recipe: https://app.moderne.io/recipes/org.openrewrite.java.testing.cleanup.TestsShouldNotBePublic?organizationId=T3BlblJld3JpdGU%3D

Co-authored-by: Moderne <team@moderne.io>
refactor: Remove `test` prefix from JUnit 5 tests

Use this link to re-run the recipe: https://app.moderne.io/recipes/org.openrewrite.java.testing.cleanup.RemoveTestPrefix?organizationId=T3BlblJld3JpdGU%3D

Co-authored-by: Moderne <team@moderne.io>
refactor: Remove unused imports ()

Use this link to re-run the recipe: https://app.moderne.io/recipes/org.openrewrite.java.RemoveUnusedImports?organizationId=T3BlblJld3JpdGU%3D

Co-authored-by: Moderne <team@moderne.io>
Limit RecipeEqualsAndHashCodeCallSuper to recipes and callSuper ()
Submit dependency graph to GitHub after publish ()

As per https://github.com/gradle/actions/blob/main/dependency-submission/README.md

Could help us both to analyze dependencies and get insight into dependents.
- https://github.com/openrewrite/rewrite-docs/issues/131
Add support for adding JavaCompatibility statements where missing to `UpdateJavaCompatibility` recipe ()
Trim out some redundant tests
Polish
Fix AddProperty insertion point not properly taking comments into account
Less than 100 response status implies bad connection ()

* Zero or lower response code should not be treated as an existing server

* Less than 100 response code should not be treated as an existing server","What's Changed
Changes packaging only if it matches provided packaging by @ammachado in
Use Tree.randomId() to construct LST elements, not UUID.randomUUID() by @TheMarvelFan in
refactor: Remove unused imports by @timtebeek in
Limit RecipeEqualsAndHashCodeCallSuper to Recipe and callSuper by @timtebeek in
Submit dependency graph to GitHub after publish by @timtebeek in
Add support for adding JavaCompatibility statements where missing to … by @krlittle in
Less than 100 response status implies bad connection by @pstreef in
New Contributors
@krlittle made their first contribution in
Full Changelog: v8.15.1...v8.15.2
What's Changed
Changes packaging only if it matches provided packaging by @ammachado in
Use Tree.randomId() to construct LST elements, not UUID.randomUUID() by @TheMarvelFan in
refactor: Remove unused imports by @timtebeek in
Limit RecipeEqualsAndHashCodeCallSuper to Recipe and callSuper by @timtebeek in
Submit dependency graph to GitHub after publish by @timtebeek in
Add support for adding JavaCompatibility statements where missing to … by @krlittle in
Less than 100 response status implies bad connection by @pstreef in
New Contributors
@krlittle made their first contribution in
Full Changelog: v8.15.1...v8.15.2"
"Added recipe options as JSON to FindRecipes. ()

* Added recipe options as JSON to FindRecipes.

* Use Jackson to construct JSON to deal with escaping

---------

Co-authored-by: Knut Wannheden <knut@moderne.io>
Include tools in build.
[TypeUtils.findOverridenMethod] Skip found methods with default access and not same package ()

* fix[TypeUtils.findOverridenMethod]: skip found methods with default access and different package

* Apply suggestions from code review

* Add test and simplify logic for override check

---------

Co-authored-by: Tim te Beek <timtebeek@gmail.com>
Co-authored-by: Tim te Beek <tim@moderne.io>
Minor fix in FindRecipes to prevent unexpected reported errors.
Disable nested jar scanning in `dependenciesFromClasspath()`

Nested jar scanning is currently not supported and is thus explicitly disabled in `JavaParser#dependenciesFromClasspath()` so that it doesn't end up causing exceptions (due to missing `FileSystems#newFileSystem()` call).","What's Changed
Fix problem caused by nested jar scanning in tests: 6fbb85d
[TypeUtils.findOverridenMethod] Skip found methods with default access and not same package by @joteri in
New Contributors
@joteri made their first contribution in
Full Changelog: v8.7.3...v8.7.4"
"Update json parser to support multiple-bytes-unicodes ()

* Update json parser to support multiple-bytes-unicodes
Recipes must be public to be loaded by ClasspathScanningLoader","What's changed
Recipes must be public to be loaded by ClasspathScanningLoader (avoids attempted classloads of Recipe$Noop, etc.)"
"Strengthen override method determination for generic parameters ()
Do not add constraints inside version J.MethodInvocations part of the constraint itself. ()

* Added test to showcase issue

* Do not update version method in constraints with a new constraint

Closes

---------

Co-authored-by: Jente Sondervorst <jente.sondervorst@colruytgroup.com>
refactor: OpenRewrite best practices ()

Use this link to re-run the recipe: https://app.moderne.io/recipes/builder/BftezDRNh?organizationId=T3BlblJld3JpdGU%3D

Co-authored-by: Moderne <team@moderne.io>
Correct `AnnotationMatcher` calls
Only consider specified configurations for UpgradeTransitiveDependencyVersion created constraints if these are mentioned. ()

Co-authored-by: Jente Sondervorst <jente.sondervorst@colruytgroup.com>
Replaced early exit logic for versions using property values with property resolution, allowing dependencies/plugins using redundant property versions to correctly be removed. ()","What's Changed
Do not add constraints inside version J.MethodInvocations part of the constraint itself. by @Jenson3210 in
refactor: OpenRewrite best practices by @timtebeek in
Only consider specified configurations for UpgradeTransitiveDependencies created constraints by @Jenson3210 in
Add Property Resolution to RemoveRedundantDependencyVersions by @ryan-hudson in
Full Changelog: v8.27.3...v8.27.4"
"Use an immutable tagged version of the Docker CLI container
First implementation of nuclei segmentation CLI
Fix bug in MaxClustering

Before modifying input argument a copy of it must be made
Added nuclei segmentation to server/slicer_cli_list.json
Using regionprops to stuff needed to generate annotations for nuclei
Finished adding code for generating annotations for each nucleus
style fix
Specify .anot extension for annotation file in xmlspec of Nuclei segmentation
Removed print statement in rest_slicer_cli.pu
Create BinaryMixtureCut.py

Performs a graph cut optimization to generate a binary mask from a probabilistic image model.
Create PoissonMixture.py

Generates a foreground/background mixture model for integer valued images.
Update __init__.py

Added 'BinaryMixtureCut' and 'PoissonMixture'.
Update PoissonMixture.py

Updated docstring to fix cut & paste error.
Update BinaryMixtureCut.py

Fixed error in edge weight calculation. Also improved handling of default values for 'Sigma' depending on class of 'I'.
Update BinaryMixtureCut.py

Added missing square operator in edge weight numerator calculation.
Fixed a bug in MaxClustering
Fixed bugs in NucleiSegmentation CLI
Bump commit hash of girder, girder_worker, and large_image
BUG: Use json.loads to decode json value in _getParamCommandLineValue
Added FeatureExtraction.xml for CLI
Added feature extraction to server/slicer_cli_list.json
JSON encode values passed back to the server
Updated FeatureExtraction.py removed a hard-coded cropping
Updated FeatureExtraction.py removed hard-coded parameters and followed NucleiSegmentation processing
Updated FeatureExtraction.py removed hard-coded parameters and followed NucleiSegmentation processing
Updated FeatureExtraction.xml added grouped parameters
Catch exceptions generated in _getParamCommandLineValue and print a user friendly error
Fix a bug in exception handling of _getParamCommandLineValue
Upgrade requirements for upstream packages
Upgrade Travis to fix an issue with PhantomJS install
Fix bugs and add reference to input image in xmlspec of annotation file
BUG: Make centroid three-dimensional by adding zero for z-coord
Disabling BinaryMixtureCut until we get pygco installed
Bump version of ctk_cli to 1.3.1 to expose reference field of file parameter
git clone install ctk_cli until new changes become available on pypi
Change rest end point code to pass reference imageid and userid for files
Fixed bugs in NucleiSegmentation CLI
Enabling docker in .travis.yml
Install ctk_cli 1.3.1 using my binstar channel until available on pypi
Merge two RUN commands in Dockerfile
Fix style errors
Fix style error","This release includes two new CLIs
FeatureExtraction
NucleiSegmentation
It also includes changes to the automatic rest end-point generation code to pass on additional information (reference image itemId and userId) to the girder_worker binding spec for output files that specify the reference attribute in their xml spec."
"Update conf.py
Add a console entry point. ()

Closes.","What's Changed
Add a console entry point. by @manthey in
Full Changelog: v1.3.4...v1.3.5"
"Change opencv-python to opencv-python-headless ()

* Don't require mapnik or GDAL and use opencv-python-headless

* Use GitHub's Python.gitignore template

* Revert changes to large-image in setup.py
Update tissue_detection.py
Simplify the Dockerfile.

Before, this was based on the dsarchive/base_docker_image, which greatly
sped up building the docker image when we built all dependencies in the
docker.  Since all of the complex dependencies are now available as
wheels, this no longer has much advantage.

We can install fewer system packages, which shrinks the size of the
docker a small amount.

We can more easily be explicit about the version of Python we want to
use.  Here it has been changed to 3.8.

As a starting point, if you need a newer version of cuda, that can more
easily be changed, too.

Additionally, dockcross now support s Python 3.9, but we can't build
with it yet.
Fix build for CI. ()
Update config.yml
BUG: Fix merge_colinear ()

* BUG: Fix merge_colinear

* DOC: fix comment
Fix tests. ()

Some package has changed how rounding or decoding images works,
resulting in some minor variations that affected the tests.  Adjust
tests to reflect this change.

This also switches to always downloading regions for tests as png rather
than jpeg.
Switch publishing gh-pages to Circle-CI. ()

This removes the travis CI as that is no longer free and doesn't add any
particular value over Circle.
Test in Python 3.9. ()

This had to wait for several packages to have a 3.9 wheel
(opencv-python-headless and shapely).

This moves the wheels to use manylinux2014.","Notes
This will be the last version to support Python 2.7 and 3.5."
"Remove deprecated `kind` argument from `jnp.sort` and `jnp.argsort`.

PiperOrigin-RevId: 631429900
Add optional size argument to jnp.compress & jnp.extract.
Fixed Mosaic GPU build following
Updated the Pallas GPU lowering to work with older jaxlib versions

Triton changed the signatures of LoadOp and DotOp upstream, and the lowering
code was not ready to handle both old and new signatures.
Minor doc fix to `jaxpr.rst`

Update the written description of the example `jaxpr` to match the given snippet of code.
Skip float64 test_nextafter on TPU
Handle ellipsis `...` in `_attempt_rewriting_take_via_slice`.

Previously `model['some_array'][:,0,0,:]` would generate a `slice`, while `model['some_array'][...,0,0,:]` would generate a `gather`. Now both of these generate `slice` eqns.

PiperOrigin-RevId: 631469837
jax.numpy: better docs for matmul-like functions
Finish jax and jaxlib 0.4.27 release

PiperOrigin-RevId: 631486157
CI: fix typo in workflow
CHANGELOG: move change from 0.4.27 to 0.4.28
The Bazel version used in JAX is bumped from 6.1.2 to 6.5.0.

The update is needed for Windows/Clang builds and for the future hermetic CUDA implementation.

PiperOrigin-RevId: 631519200
Implement jnp.linalg.multi_dot using opt_einsum
Recommend the plugin in the CUDA installation instructions.

PiperOrigin-RevId: 631555876
Bump minimum jaxlib version to 0.4.27

xla_extension_version is 261 and mlir_api_version is 56

PiperOrigin-RevId: 631579739
[Pallas] Fix some typos.

PiperOrigin-RevId: 631592201
[jax:mosaic-gpu] FragmentedArray can do tiled load.

PiperOrigin-RevId: 631611060
Update XLA dependency to use revision
http://github.com/openxla/xla/commit/c6df436f9e3d2a706a3a9595e37224276fb6013b.

PiperOrigin-RevId: 631629197
Enable logging_test on all CI platforms.

Should catch issues like https://github.com/google/jax/issues/21121
Switch Windows jobs to use Clang.

Remove the experimental/trial Clang job.

PiperOrigin-RevId: 631814321
Removed stale version guards and try/except blocks from Pallas GPU

They are unnecessary now that the minimum jaxlib version is 0.4.27.
Cleanup second registration of custom_partitioning callbacks now that
the jaxlib version has been bumped.

PiperOrigin-RevId: 631852273
Refactor pipeline emitter API.

Building on enrique's work, this CL refactors the emit_pipeline abstraction:
1) factors out the VMEM double-buffering bookkeeping into a helper class.
2) concentrate the intricate copy/wait scheduling logic into one place inside a scheduler helper
while allowing manual overrides, callbacks don't control scheduling anymore, rather we have
explicit loop scheduling.
3) minimize callbacks and simplify the ""defaults"" for fusing pipelines together.

Examples of fully overlapped versions of latency- and throughput- optimized AG-matmuls and
matmul-RSs are included in new tests.

PiperOrigin-RevId: 631865641
Update XLA dependency to use revision
http://github.com/openxla/xla/commit/68b17a8571f197676ea07479637da1546b3b501d.

PiperOrigin-RevId: 631874377
Removed get_compute_capability from jax.experimental.pallas.gpu

Compute capability is available as a `str` attribute on a GPU device since
jaxlib 0.4.26.
Renamed is_device_gpu_at_least to is_cuda_compute_capability_at_least

This makes it clear that the predicate is only supposed to be used for NVidia
GPUs at the moment.
Generic reduce window jvp

The problem is that we want to generically jvp and tranpose over any reduction_fn. Jax already handles some of the hard parts for us, namely, ensuring that the user provided fn is jax capturable. All that is left then, is to write a jvp and tranpose fn that utilize the jax utils correctly.

However, this is not so straightforward because in order to get the transpose of a reduction window, we need to be able to use both the tangents and primals. The current reduce_fn operates on (x, y) - but we actually need is, under jvp, to operate on `(x_primal, y_primal, x_tangent, y_tangent)`. In turn, this means we need to push down notions of a jvp-specific reduction_fn (captured via the usual machinery of as_fun `as_fun(jvp_fn(closed(user_reduction_jaxp)))`).

For the jvp fn, we stack the primal operand and the tangent operand together, and we stack their respective initial values together - this means a good deal of changes to safety checks and assurances downstream (as well as unpacking) as the shape of the operand has changed from [K,...Kt] to [K, ...Kt, 2] where the last dim is the stacked primal and tangent values.

In following CLs, we will add (1) re-entrant/recursive is_jvp and (2) transposition

PiperOrigin-RevId: 631916764
jnp.einsum: improve documentation
TST: fix Lpmn test for new scipy
Reverts 1956ff7d7b73794012fece2d8452e097196587fc

PiperOrigin-RevId: 631974751
[XLA:Python] Fix a memory corruption bug in the tp_name attribute of ArrayImpl and PjitFunction for Python 3.10 or earlier.

This works around https://github.com/python/cpython/issues/89478, which was fixed in Python 3.11.

PiperOrigin-RevId: 631984256
Update XLA dependency to use revision
http://github.com/openxla/xla/commit/4872030c44e20556efdfea47829d942985e0ccf1.

PiperOrigin-RevId: 631997979
jnp.linalg.multi_dot: use optimize='auto'
Reenable examples_test in Bazel build.

Fix bitrot.

This test was disabled years ago because it was slow, but it isn't any more.

PiperOrigin-RevId: 632138101
Update the multi-process note in pjit's docstring

PiperOrigin-RevId: 632160561
jnp.linalg: add precision & preferred_element_type to dot-like functions
Update XLA dependency to use revision
http://github.com/openxla/xla/commit/d60579f54a0b6c37d1caf11dc3eb34488cf6922a.

PiperOrigin-RevId: 632232639
Prepare 0.4.28 release.","Bug fixes
Reverted a change to make_jaxpr that was breaking Equinox ().
Deprecations & removals
The kind argument to jax.numpy.sort and jax.numpy.argsort
is now removed. Use stable=True or stable=False instead.
Removed get_compute_capability from the jax.experimental.pallas.gpu
module. Use the compute_capability attribute of a GPU device, returned
by jax.devices or jax.local_devices, instead.
Changes
The minimum jaxlib version of this release is 0.4.27."
"Refactor JAX CPU kernels to make them usable from C++.

Most of the work here is porting the LAPACK interface from Cython to plain C++. This is something I wanted to do anyway to make use of C++ templating facilities: the code is noticeably shorter in C++.

This change removes the only use of Cython in JAX. It also removes the need for a build-time dependency on Scipy, which we only needed for Cython cimport reasons.

When using C++, we most likely do not want to fetch LAPACK and BLAS kernels from Python. Therefore we add another option: we define the LAPACK functions we need using weak symbols where supported; the user can then simply link against LAPACK to provide the necessary symbols.

Added a jaxlib:cpu_kernels module to facilitate using the JAX CPU kernels from C++.

PiperOrigin-RevId: 394705605
jnp.isclose/jnp.allclose: require array inputs
[sparse] add BCOO._unbatch() utility
[sparse] add BCOO._dedupe() method
Update the readme to reflect that Cuda 10.1 and cuda 11.0 support is dropped.

PiperOrigin-RevId: 394772160
Delete Cuda 10.2 release and continuous builds.

PiperOrigin-RevId: 394772236
added pjit tuorial colab
[sparse] add support for sparse-sparse matrix products
[sparse]: fix corner case in BCOO validation
lax.numpy: require arraylike inputs throughout
added pjit tuorial colab
add markdown version
Remove stderr blocks
sync md file
don't use top-level headings
Use the raw C API for ShardedDeviceArray.

It's similar than PyBuffer.

PiperOrigin-RevId: 395058367
Use the raw C API for ShardedDeviceArray.

It's similar than PyBuffer.

PiperOrigin-RevId: 395071943
Fix argument names for jnp.ndarray.clip and deprecate the old ones
hook up xla initial style translation rule for linear_call_p
Ensure that named axes consistently refer to global axis sizes in xmap

Fixes.

PiperOrigin-RevId: 395210686
Implement 'reflect' and 'mirror' padding modes for scipy.ndimage.map_coordinates
Don't cast out_axis_resources to a tuple automatically

It's confusing and makes it impossible to specify non-trivial pytrees of
out_axis_resources for functions that return lists. Also extend the error
messages to be less confusing and hint at potential fixes.

PiperOrigin-RevId: 395246450
Move ShardedDeviceArray & PmapFunction to the raw C API and implement pickling/unpickling.

PiperOrigin-RevId: 395256774
Unpin the tpu_driver version used for Cloud TPU Colabs.

This reverts https://github.com/google/jax/pull/6942. The nightly appears to work again, and we wanna pick up new fixes and improvements.
expose random key array type

This is meant to allow for downstream type annotations and checking
(e.g. via `isinstance`).
Uploaded smaller images
handle dropped output values in the sparse interpreter
avoid constvar conversion when closing a sparse jaxpr
Remove axis name from named_shape when unmapping avals

Even though `vmap` and `pmap` don't use avals with names, the batching infrastructure
is used to implement xmap and pjit. So while we keep the introduction of names carefully
scoped, forgetting to remove them at the right points leads to extremely confusing errors.

PiperOrigin-RevId: 395423006
Drop support for the deprecated StreamExecutor CPU backend.

The TFRT backend is better and there's no reason to keep the StreamExecutor backend around any longer.

PiperOrigin-RevId: 395455049
Add a @jit decorator around jnp.linspace.

Don't test integer dtype values. The exact rounding semantics may be quite sensitive to, e.g., jit compilation, and this is not something end users should be relying on. Simplify implementation to only use version that gets the endpoints correct.

Use the same approach NumPy does to ensure the endpoint is included when endpoint=True: explicitly set the endpoint.

Various minor cleanups.
Move contents of jax.api_util to jax._src.api_util and add a forwarding shim.

One of many changes to codify the set of exported symbols in the jax.* namespace.

PiperOrigin-RevId: 395484706
New lowering APIs for pjit

This is the first in a series of refactoring patches that add the new AOT APIs
to all JIT-like transforms in JAX. I'm sending this early, because I expect that
it will come in handy when adding reverse-mode AD support for pjit.

PiperOrigin-RevId: 395510449
Use shorter variable names in lax.py.

In the implementation of gather/scatter, use `indices` instead of `start_indices` and `scatter_indices`. Cleanup only; no functional changes intended.
[JAX] Include the function name in the error message when hash/equality of a static argument fails.

PiperOrigin-RevId: 395550728
Move implementation of jax.flatten_util to jax._src.flatten_util. Add a jax.flatten_util shim.

Change as part of cleaning up the jax.* namespace.

PiperOrigin-RevId: 395551093
added images for pjit tutorial
delete images
added first img
added all imgs
add space
Add more @jit decorators to jax.numpy functions.

PiperOrigin-RevId: 395687875
Combine initial_style_batchers with collective_rules
Add new lowering APIs for jit

PiperOrigin-RevId: 395779305
not exclude 08-pjit.md
removing ipynb in format
Cache used_axis_names calls for jaxprs

All control-flow primitives are `AxisPrimitive`s now, which means that we're doing
lots of those used-names traversals during dispatch and they can be expensive!
This adds caching to try to lower the cost of that change.

PiperOrigin-RevId: 395921887
Remove some debug print statements left in lax_numpy.
Fix performance degradation due to repeated aval creation.
Fix error when printing a DeviceArray without an aval.

PiperOrigin-RevId: 395946904
Avoid accidental on-device array creation in _reduction_init_val.

Revert changes to _reduction_init_val, which is carefully crafted to use classic NumPy functions so lax can pattern match on the reducer monoid.

Instead, don't call _reduction_init_val on the initial argument from NumPy, which might well be a traced value.

PiperOrigin-RevId: 395947318
Add new lowering APIs for xmap

PiperOrigin-RevId: 395950859
make PRNGKeyArray.shape a property, add tests for it and for disallowed addition
docs: remove application tutorials
flip lower bits to derive seeds for the custom test PRNG

Changing bits, instead of incrementing, fixes an inherited test that seeds
with a maximum-valued numpy.uint64.

PiperOrigin-RevId: 396061086
[jax2tf] Fix stale comments
Relax test tolerance for a lax_test.py test.

This test fails on CPU with a very low probability.
Also improve printing of the test name.
Replace uses of jax.partial with functools.partial, in preparation for removing jax.partial.

jax.partial is an alias for functools.partial, and functools.partial is a Python standard library API. There's no need for jax to export this function.

PiperOrigin-RevId: 396370975
Expose allow_spmd_sharding_propagation_to_output in Python

We need to set this option to support reverse-mode AD of pjit in JAX.

PiperOrigin-RevId: 396400683
Use jax.* APIs rather than api.* names in tests.

Tests should use our own public APIs where they exist.
Add PEP484-compatible export for jax and its subpackages
Add `jnp.get_printoptions` and `jnp.printoptions`.

`jnp.set_printoptions` already exists but other printing utilities do not.

`jnp.get_printoptions` forwards `numpy.get_printoptions`.
`jnp.printoptions` forwards `numpy.printoptions`.
Add precision param for pdot
Switch internal users of jax.ops.index_... to use x.at[x].set() APIs.
handle linear custom_jvp functions
ppermute: avoid passing lists of indices to jnp.take
Switch internal users of jax.util.partial to use functools.partial.
Add a note about Google Colab setup

User must run `jax.tools.colab_tpu.setup_tpu()`
Feat: scipy.stats.nbinom implementation

fix: increasing tolerance check for testNBinomLogPmf in scipy_stats_test.py
add a test for linear_call with jit
[call_tf] Fix bug when calling TF functions with variables in a jit context.

The code was assuming that the `.captured_inputs` of a function are
variables in the same order as `.variables`. This seems to not be
true. Lookup variables now by handle.
jnp.take: require array argument (but not indices) to be arraylike
DOC: add brief comments to example in README
Remove export of jax.lax.partial.
Fix package exports
[jax2tf] Document an expected error when saving converted functions

If the JAX function is not reverse-mode differentiable (e.g., lax.while_loop) then
it should be converted without gradients, or saved without gradients.
Update docs for nan checker and tfds example.
Add Changelog for jax v0.2.21 development
jnp.array: raise TypeError on boolean scalar indices
fix html formatting of markdown
bazelrc changes for building Cuda 11.4 wheels with cudnn 8.2

PiperOrigin-RevId: 397088624
jax.numpy: add wrapper for np.insert
Fix for singleton axis name in `axis_index_translation_rule`
Remove jax.api.

Functions exported as jax.api were aliases for names in jax.*. Use the jax.* names instead.
DOC: add missing jax.numpy functions
jnp.insert: use broadcast_shapes
Update changelog for several recent PRs
Check presence of __jax_array__ in _arraylike before calling it in isscalar
Update developer.md
[host_callback] Fix an assertion failure for grad(remat(host_callback))

Fixes:
Add flags to configure the cuda_compute_capability and rocm_amd_targets
Reflected the opinions from the reviewer.
tweak cuda/rocm targets

Closes.
Remove jax.partial from the JAX API.

Use functools.partial instead.
Make sure that xmap raises a clear error when using an undefined resource name

PiperOrigin-RevId: 397762568
Add the equation source context in jaxpr_subcomp.

Improves tracebacks if XLA translation fails.
Remove jax.util.partial.
convolutions: use flip() to clean up reverse-indexing
Attempt to land https://github.com/google/jax/pull/6400 again.

This PR changes `jax.numpy.array()` to avoid creating any on-device arrays during tracing. As a consequence, calls to `jnp.array()` in a traced context, such as `jax.jit` will always be staged into the trace.

This change may break code that depends on the current (undocumented and unintentional) behavior of `jnp.array()` to perform shape or index calculations that must be known statically (at trace time). The workaround for such cases is to use classic NumPy to perform shape/index calculations.

PiperOrigin-RevId: 398008511
Turn jnp.ndarray into a true abstract base class.

Make all JAX array types instances of jnp.ndarray.
Remove np.ndarray from jnp.ndarray.
Remove a stale comment.
[sparse]: fix fromdense JIT code path
mark custom derivative calls as API boundaries for stack trace filtering
[jax2tf] Minor updates to the jax2tf examples documentation
Apply review suggestions
Reenable indexing TPU tests that pass at HEAD.
Merge static indexing forward and gradient test cases.

I'm not entirely clear why these were separate in the first place, and everything seems to work fine if we merge them. Possibly the two were separate because of unimplemented cases that have subsequently been implemented.
Add traceback to Graph Tensor runtime error and update error message.

PiperOrigin-RevId: 398256308
Fix wrong dtype output from indexing with an empty slice.

Fix test failures in lax_numpy_indexing_test for complex64 pow() scatters.

The existing tests actually catch both of these bugs, but only when run with a sufficiently high number of test cases.
Add atol and rtol arguments to jtu._CheckAgainstNumpy().

Prefer atol and rtol if they are provided.
Use traced identity in jacobian std_basis
disable pytype on custom derivative calls

Method decorator seems to interfere with pytype relating the typevar
in the return value annotation to its appearance in the enclosing
class.
Move contents of jax.lib to jax._src.lib.

Add shim libraries for functions exported from jax.lib that other code seems to use in practice.

PiperOrigin-RevId: 398471863
[jax2tf] Ensure that shared constants in JAX are shared also in the converted function

Fixes:
Create 0.2.21 jax release

PiperOrigin-RevId: 398528427","New features:
Added jax.numpy.insert implementation ( ).
Breaking Changes
jax.api has been removed. Functions that were available as jax.api.*
were aliases for functions in jax.*; please use the functions in
jax.* instead.
jax.partial, jax.lax.partial, and jax.util.partial were accidental
exports that have now been removed. Use functools.partial from the Python
standard library instead.
Boolean scalar indices now raise a TypeError; previously this silently
returned wrong results ( ).
Many more jax.numpy functions now require array-like inputs, and will error
if passed a list ( ).
See  for a discussion of the rationale behind this change.
When inside a transformation such as jax.jit, jax.numpy.array always
stages the array it produces into the traced computation. Previously
jax.numpy.array would sometimes produce a on-device array, even under
a jax.jit decorator. This change may break code that used JAX arrays to
perform shape or index computations that must be known statically; the
workaround is to perform such computations using classic NumPy arrays
instead.
jnp.ndarray is now a true base-class for JAX arrays. In particular, this
means that for a standard numpy array x, isinstance(x, jnp.ndarray) will
now return False ()."
"update version and changelog for pypi
support key array pickling

Involves:
* a weaker notion of equality on key element types
* avoiding jitted functions as PRNG impl fields
Throw error when 64-bit dtypes used incorrectly in `jax.pure_callback`
Add `__hash__` and `__eq__` to PmapSharding

PiperOrigin-RevId: 471356052
[jax2tf] add a new test for jax2tf gda test.

Now it cover the test using gda as jax function input.

PiperOrigin-RevId: 471365834
Add fast path args to Array similar to GDA to speed up initialization and other operations like calculating indices and addressable_device_assignment.

This is important because looping over 1000s of devices is extremely expensive during runtime and throttles the performance (all these optimizations were applied to GDA when integrating it into PAX and are applicable to Array as well). This will also be helpful for single-controller environments.

Also even hashing and __eq__ checks when you have 1000s of devices is going to be slow and will show up in xprof as a slowdown (I have seen this before).

PiperOrigin-RevId: 471366295
Add support to handle arbitrary shardings to KeyArray. Resolve all the TODOs that were created before.

Co-authored-by: Roy Frostig <frostig@google.com>
PiperOrigin-RevId: 471443690
require scalar key arrays when seeding, splitting, and folding

Recent changes to RNG internals actually make it easier for us to
render these operations batch-polymorphic. However, any existing use
of these in a non-scalar way suggests incorrect usage, since they were
scalar-only before (albeit imperfectly guarded as such).
[sparse] add sparse support for dynamic_slice
Use lowering as impl rule for `pure_callback`
Enable cuBLASLt by default in XLA for most matmuls

Enable cuBLASLt by default in XLA with two exceptions. First, the current XLA implementation using cublasLt does not yet support int8 gemms. Second, the cublasLt api does not support a certain dimension size larger than a specific value; in this case we fallback to legacy cublas. This change makes a modification so that we prefer to do the cublaslt gemm operation in place when fusing with a bias add. Updated JAX test precision for new matmul results.

PiperOrigin-RevId: 471661566
docstring for `jax.stages.Wrapped`
write and generate package API documentation for `jax.stages`
Make `__iter__` of `Array` behave like DA when there is a SingleDeviceSharding and like SDA when there is a non-trivial sharding.

This is important because when `Array` contains more than 1 shard, each shard can be on a different device and those things need to be preserved when iterating over `Array`.

PiperOrigin-RevId: 471695841
Improves quickdraw example in jax2tf
Rolling back due to breaking tests

PiperOrigin-RevId: 471847099
write in-process AOT walkthrough doc
mention AOT readiness in changelog
Add benchmarks for jax.Array

PiperOrigin-RevId: 471889808
Allow get_aval to work on ShapeDtypeStruct

This is necessary to be able to call jit(f).lower(ShapeDtypeStruct(...) when
--jax_dynamic_shapes is on. The code in partial_eval.infer_lambda_input_type
calls get_aval.
Show link to GitHub repo in navbar
[jax2tf] Refactor top-level jax2tf.convert

There are several goals for this refactoring:
  * improve the readability of the code: more helper functions, move big
    nested functions to top-level make make it obvious what are the
    data dependencies
  * try to be more systematic about naming: JAX entities end with _jax
    and TF entities with _tf. This is helpful because in several cases
    one function has to operate with both kinds of entities.
  * the main goal is to enable fixing the experimental_native_lowering
    for pjit. For that (future) work, we want to pass JAX callables
    to _interpret_fun_jax, rather than linear_util.WrappedFun. Then
    we can use the standard AOT APIs.
Update jax/experimental/jax2tf/jax2tf.py

Co-authored-by: Marc van Zee <marcvanzee@gmail.com>
Internal change

PiperOrigin-RevId: 472301936
Fix NaNs in the gradient of jnp.interp when the spline being interpolated into contains the same knot coordinate twice.

PiperOrigin-RevId: 472333594
[jax2tf] Rewrites `converters_eval` framework.

Resulting table: https://github.com/google/jax/blob/ebdfb60ee89f53736c9a83147e358d750da96f98/jax/experimental/jax2tf/g3doc/convert_models_results.md

* Makes testing models more similar to testing primitives: Moves the framework into `jax2tf/tests`, the main file to call now is `model_test.py` and the models themselves are now in `model_harness.py`.

* Moves the g3doc to `jax2tf/g3doc`

* Simplifies conversion and testing logic.

* Adds more converters and improves the output in the g3doc.

* Fixes various bugs in the conversion. The errors shown now are all problems with the actual converters.

PiperOrigin-RevId: 472437502
[jax2tf] Refactor top-level jax2tf.convert

There are several goals for this refactoring:
  * improve the readability of the code: more helper functions, move big
    nested functions to top-level to make make it obvious what are the
    data dependencies
  * try to be more systematic about naming: JAX entities end with _jax
    and TF entities with _tf. This is helpful because in several cases
    one function has to operate with both kinds of entities.
  * the main goal is to enable fixing the experimental_native_lowering
    for pjit. For that (future) work, we want to pass JAX callables
    to _interpret_fun_jax, rather than linear_util.WrappedFun. Then
    we can use the standard AOT APIs.

This was initially reviewed and submitted as,
but was rolled back due to test failures.
Fix some cases where deserialization hangs:

* Make sure to release the semaphore in the dtype!=None case.
* If chunks are too large to _ever_ acquire the semaphore, immediately raise an
  error.

PiperOrigin-RevId: 472496109
Use reduce_window for faster cumulative reductions on small inputs on GPU.

On GPU, reduce_window is executed in a single fusion and associative_scan
is split into multiple to materialize intermediate calculations.
On small inputs reduce_window is faster being a single fusion,
but on larger ones is slower because of O(n^2) complexity.
The conservative value of the threshold to choose between the two algorithms was obtained by benchmarking.
cumred_tpu_impl was renamed into cumred_reduce_window_impl to reflect that it is useful not only on TPUs.

PiperOrigin-RevId: 472504553
Add partial_eval_custom rule for `for_loop`
Fix NaNs in the gradient of jnp.interp when the spline being interpolated into contains knots that are small and nearby.

PiperOrigin-RevId: 472511203
Add pytest marker inside the test only if pytest is present in the env
DCE jaxpr and trivial_jaxpr support for lower_sharding_computation

Co-authored-by: Matthew Johnson <mattjj@google.com>
PiperOrigin-RevId: 471274989
Avoid direct references to jax._src.

jax._src will be removed from the JAX namespace shortly.

PiperOrigin-RevId: 472566026
fix bugs, infeed/outfeed must be considered effectful

Co-authored-by: Yash Katariya <yashkatariya@google.com>
Co-authored-by: Sharad Vikram <sharad.vikram@gmail.com>
[jax2tf] Refactor the experimental_native_lowering path in jax2tf

This is part of a suite of refactorings aimed towards supporting
pjit by jax2tf experimental_native_lowering. The goal here is
to remove many references to internal JAX core APIs, and instead
use the AOT APIs: jax.jit(func_jax).lower(*args).

Only the experimental_native_lowering behavior should be affected.
[jax2tf] Updates convert_models_results.md table

I was generating the table with an old version of `tf-nightly`, which caused many more failures for TFLite.

PiperOrigin-RevId: 472676935
[jax2tf] Rename models_test.py, since it is not  a test

With the current name the file is scanned when doing `pytest .../jax2tf/tests` and this leads to a number of errors.

PiperOrigin-RevId: 472696561
Use MLIR bytecode when passing IR to backends.

MLIR bytecode is more compact to represent and should be faster to generate and parse.

PiperOrigin-RevId: 472701621
Roll forward: Upgrade logistic into a primitive.

Unlike the previous attempt, we don't try to use mhlo.logistic as the lowering of the new primitive yet. Instead, we lower to the old implementation of `expit`. This means that this change should be a no-op numerically and we can work on changing its implementation in a subsequent change.

PiperOrigin-RevId: 472705623
Rollback of: Breaks internal target with `NotImplementedError: Differentiation rule for 'assert' not implemented`

PiperOrigin-RevId: 472709946
Raises a warning if Math is done on Arrays that are not fully addressable.

The point of this is to warn users about a possible footgun as the computation needs to be executed in the same order on every process.

PiperOrigin-RevId: 472759199
Revert: Use MLIR bytecode when passing IR to backends.

MLIR bytecode is more compact to represent and should be faster to generate and parse.

This change broke at least one downstream test.

PiperOrigin-RevId: 472781103
For execute_sharded_on_local_devices, the overload that takes PyBuffers should take precedence during overload resolution.

PyBuffer is still the default types used and it is assumed in some places in python frontend. It will be unexpected and cause errors later when an empty arg list is passed and the overload that takes PyShardedBuffer is chosen.

This change also removes __getitem__ from PyShardedBuffer to avoid implicit conversion from PyShardedBuffer to List[PyBuffer::object], and adds implicit conversion from List[PyBuffer::object] to PyShardedBuffer.

PiperOrigin-RevId: 472811325
[PJRT:C] Control whether to call wrapped C++ PJRT client directly with a global variable `kPjRtCApiBypass`.

Default value of `kPjRtCApiBypass` is false.

PiperOrigin-RevId: 472847147
Add missing Google-internal option to jax_test
Ignore the mypy errors.
roll back breakage

PiperOrigin-RevId: 472949225
Checkify: add jvp rule for assert_p.

PiperOrigin-RevId: 472961963
Split State effect into Read/Write/Accum effects and tie them to Ref avals
Reapply: Use MLIR bytecode when passing IR to backends.

MLIR bytecode is more compact to represent and should be faster to generate and parse.

The previous attempt at this change broke for 0D convolutions. JAX was not ensuring that the padding attribute had the correct [N, 2] shape when N was 0.

PiperOrigin-RevId: 472991661
Fix Forward. The fix is on the user's end. Original PR: https://github.com/google/jax/pull/12217

Co-authored-by: Matthew Johnson <mattjj@google.com>
Co-authored-by: Yash Katariya <yashkatariya@google.com>
PiperOrigin-RevId: 472999907
Rollforward of

PiperOrigin-RevId: 473002040
Use `value` instead of `ValueOrDie`.

PiperOrigin-RevId: 473011038
Add sound loop invariance detection
Add a test for jnp.array(..., copy=True) for Array.

PiperOrigin-RevId: 473041718
[xla:jitrt] Enable serializing GPU executable for JAX

Serialization is enabled only if JitRt is enabled.

PiperOrigin-RevId: 473047031
Try Cuda 11.2 build in presubmit for GPU. Presubmit uses 11.2 and CI uses 11.1

PiperOrigin-RevId: 473071603
Bump the minimum jaxlib version to 0.3.15.
Introduce class PyArray that contains the data members of python Array.

A few key methods is implemented in C++ while the rest are still implmemented in python and added to the class later. A class decorator, @use_cpp_array, is added to add python methods to xc.Array.

PiperOrigin-RevId: 473075244
Drop support for non-MLIR modules in compile().

I can't think of any reason why we still support anything else here.
Support deserializing from non-chunked storage such as tensorstore.array.

PiperOrigin-RevId: 473080245
add _device attribute to PRNGKeyArray so that computation follows key placement

unrelated: remove some redundant hasattr + try / except AttributeError
Enable `testArrayCopy` now that its fixed.

PiperOrigin-RevId: 473088085
Add a github presubmit build which runs with jax.Array flag enabled for OSS coverage.

PiperOrigin-RevId: 473100614
[dynamic-shapes] add basic vmap-of-indexing support

The main changes here are only indirectly related to gather: we just had to
update some other rules (e.g. for comparison, and squeeze) for a simple
dynamic-batch-shape gather to work.

I also skipped two tests and deleted some old dynamic shape slicing logic
because we want to handle that differently. We didn't have to do that removal
in this PR, but it's just convenient given I'm looking at indexing again.
[Rollback] Add a github presubmit build which runs with jax.Array flag enabled for OSS coverage.

PiperOrigin-RevId: 473161716
Minimally support the `backend` argument on `jit` in the jax.Array path.

This means that only a single device is allowed to flow through this path. This is a compromise i.e. it will support the existing codepaths but won't support sharded arrays to go through this path and encourage users to use other well supported techniques.

PiperOrigin-RevId: 473162167
[jax2tf] Updates to the documentation

One change I made throughout is to use the verb lower instead of
convert when refering to what jax2tf does. This is more accurate,
because what is happening is that the lowering to HLO is replaced
with a lowering to TF ops. Some users were confused by the use
of the verb convert as suggesting some sort of source-to-source
translation of JAX programs to TF, which sounds very complicated
and risky.
[jax2tf] Fixes a bug in gather (enable_xla=False)

For batched gather, we only support 1 batch dimension in the output. but in this case we were only collapsing a single dimension. However, if there are multiple `collapsed_slice_dims`, all of them should be collapsed. We can simply solve this by reshaping to the desired output shape.

PiperOrigin-RevId: 473182794
Remove jax._src from JAX namespace.

This is a JAX-internal name and not subject to any deprecation policy. Please avoid the use of JAX-internal functions outside JAX.

PiperOrigin-RevId: 473243243
lax.broadcast_shapes: clearer error for incompatible shapes
Show the correct sharding in `is_compatible_aval` error in `MeshPspecSharding` when created via `_from_parsed_pspec`. Preserve the original PartitionSpec from ParsedPartitionSpec if it exists, else calculate it.

PiperOrigin-RevId: 473267905
jax.Array: support fast path for lax.transpose & lax.squeeze

As part of this change, I created a helper function so that the logic of type checking is
in a single location. Eventually we can replace this helper function with appropriate
isinstance() checks using the APIs described in.
Enabled cpp_jit test with Array now that Array is in C++. Also check for the unsafe_buffer_pointer in the trivial_computation tests rather than an identity check. Also set the array priority to 100 and that makes the float0 test pass.

PiperOrigin-RevId: 473323695
Add pmap benchmarks using jax.Array

PiperOrigin-RevId: 473325120
Make `__getitem__` work for PmapSharding just like SDA works. DA is already covered with the current implementation.

Added TODOs to take fast path for indices wherever it is possible to do that. If a correct index is passed during getitem and if that index exists on `Array`, then the fast path is taken (see the test in this CL).

PiperOrigin-RevId: 473342504
Remove the jax_array disables from call_tf_test.py. They work now.

PiperOrigin-RevId: 473352068
Minimally support `device` argument on `jit` in the `jax.Array` path

This means that only a single device is allowed to flow through this path. This is a compromise i.e. it will support the existing codepaths but won't support sharded arrays to go through this path and encourage users to use other well supported techniques like using device_put explicitly instead of relying on `jit` to do that for you.

PiperOrigin-RevId: 473373822
Skip the infeed test since its failing on GPU with jax at HEAD and latest jaxlib on pypi

PiperOrigin-RevId: 473400592
Bounce to host for any sharding that's not PmapSharding or a sharding with a single device for `__iter__` and `__getitem__`.

PiperOrigin-RevId: 473402857
Increase the GPU shard count to 40 since its timing out every once in a while in kokoro.

PiperOrigin-RevId: 473617463
[jax2tf] Disable some tests for experimental_native_lowering

PiperOrigin-RevId: 473667029
jax._src/typing: add basic types
use jax._src.typing in lax.py & a few other places
[sparse] Lower batch-mode bcoo_dot_genernal to cusparseSpMM.

PiperOrigin-RevId: 473777597
jax.lax: ensure GatherDimensionNumbers contains tuples for hashability
ensure_index: raise better error for traced inputs
Add a MLIR constant handler for GDA.

PiperOrigin-RevId: 473848126
Split for_loop_test out of lax_control_flow_test

PiperOrigin-RevId: 473848277
jax.test_util: add capture_stdout context manager
Add jax.print_environment_info()
JEP 12049: Type Annotation Roadmap
Bump shards on for_loop_test

PiperOrigin-RevId: 474038276
Use cases_from_list to subsample enumerated cases in for_loop_test

PiperOrigin-RevId: 474093596
Add typing_test.py
Add support for closing over `Ref`s in nested for loops
jax_array_test: set config once & fix X64 failure
Delete soft_pmap as it has no users. Please use `pjit` or `xmap` if you do want soft_pmap.

`jax.soft_pmap` is undocumented. If it were documented, a deprecation period would have been provided.

PiperOrigin-RevId: 474145090
[dynamic-shapes] enable basic einsum support, following jax2tf shape polys
Use C++ Array in pmap path and move PmapSharding to cpp

PiperOrigin-RevId: 474151089
skip some for_loop test cases on gpu due to flakey timeouts

PiperOrigin-RevId: 474168747
Add a jit decorator to comparison operators.

We had previously omitted jit because of https://github.com/google/jax/issues/6713, but concrete remat no longer exists.

PiperOrigin-RevId: 474309905
Make nested xmap work with Arrays and GDA (in single process).

PiperOrigin-RevId: 474323667
Internal change

PiperOrigin-RevId: 474331907
Change TensorFlow to depend on StableHLO instead of vendoring it

This makes handling TensorFlow's dependency on StableHLO consistent with handling other TensorFlow's dependencies. For example, LLVM goes into //third_party/llvm, and so should StableHLO.

Users of tensorflow/tensorflow (e.g. JAX) need to change Bazel builds, replacing `@org_tensorflow//tensorflow/compiler/xla/mlir_hlo/stablehlo` with `@stablehlo//`. Nothing else changes, e.g. C++ includes, C++ usage, Python bindings and Python usage all stay the same. Example: https://github.com/google/jax/pull/12174.

Users of tensorflow/mlir-hlo are unaffected thanks to the awesome power of Copybara. There are minor changes in the StableHLO part of MLIR-HLO caused by the fact that the StableHLO repository and the vendored StableHLO inside tensorflow/tensorflow have diverged a little bit (e.g. Markdown formatting is slightly different between repositories because I didn't have the time to propagate these changes) and now they have been forced to converge, but these changes won't affect the behavior of neither CMake nor Bazel builds of MLIR-HLO.

Moving forward, contributions to StableHLO will only be possible through openxla/stablehlo. This is because tensorflow/tensorflow no longer vendors StableHLO. (tensorflow/mlir-hlo still does, but it's readonly).

PiperOrigin-RevId: 474360128
add paper link about grad-relu-at-zero
Change case of typing.Dtype -> typing.DType

This follows the convention used in numpy.typing.DType.
[typing] clear up logic in scatter_update

Static type checkers do not parse deeply enough to know that by line 182
bucket_size cannot by None; branching on an explicit None check is easier
to follow (even for human readers)
jax.Array: add issubclass test analogous to existing DeviceArray test.
Implement unrolling for for_loop
[jax] Update expected error message in preparation for new XLA:GPU runtime

PiperOrigin-RevId: 474458551
Enable the debugging_primitives pjit(xmap) case. Also don't check for sharding mismatch when the array is not committed. Check the device assignment only for committed arrays.

PiperOrigin-RevId: 474598597
Remove the optional OpSharding typehint from XLACompatibleSharding

PiperOrigin-RevId: 474598756
Adjust tolerance for lu test in preparation for XLA switch from cublas to cublasLt

PiperOrigin-RevId: 474618770
JAX implementation of scipy.stats.multinomial pmf & logpmf

Co-authored-by: harryjulian <harry.julian@peak.ai>
Some miscellaneous changes to make tests pass when jax.Array is enabled by default.

1. Add `device_buffer` and `device_buffers` fields to Array as a backwards compatible change for DA and SDA.
2. Support PartitionSpecs as input to in_axis_resources and out_axis_resources when jax_array is enabled as a backwards compatible change since all user code uses this currently. Create a MeshPspecSharding internally.
3. Some tests changes to make them pass

PiperOrigin-RevId: 474642889
tests: fix is_valid_shape() function
Fix and add test for weakref_lru_cache asan issue.

PiperOrigin-RevId: 474684516
Mark multiprocess_gpu_test as manual to skip it in OSS

PiperOrigin-RevId: 474806518
Pass device_assignment to ShardingContext instead of first_sharding which contains partitioning of an input too.

It does not make sense to pass how an input is partitioned to ShardingContext because you can have `n` inputs all partitioned in a different way but all of them should have the same device_assignment. This follows SPMDAxisContext too.

PiperOrigin-RevId: 474808207
Set the sharding of uncommitted single device sharding Arrays correctly and fix some miscellaneous tests with Array too. Enable pjit_test and xmap_test with Array too (all of them are mechanical changes).

PiperOrigin-RevId: 474858389
Silence some pytype errors.

PiperOrigin-RevId: 474898625
Skip remote_transfer_test because Array does not have the xla_shape method since its deprecated.

PiperOrigin-RevId: 474913967
Add `Array` counterparts to the serialization_test.py and disable the GDA tests if jax_array is enabled.

PiperOrigin-RevId: 474944400
Fix the bug where the indices returned from `_get_input_metadata` were of length equal to the length of global devices but should have been the length of local devices instead. `shard_args` only deals with local devices and indices.

Also, enable multihost pjit_test.py with Array.

PiperOrigin-RevId: 475044692
Remove fast_path_args from Array and add `id` checks to Sharding's `__eq__` method as a fast shortcut.

Also the C++ pjit path should help optimize the dispatch path.

PiperOrigin-RevId: 475163903
Bump XLA version.
multiprocess_gpu_test: kill open subprocesses to avoid warning
docs: avoid deprecated matplotlib axis creation
Add function to visualize `Sharding`s
[typing] overloaded type declaration for variadic lax.sort
Only copy_to_device if the indices match. Otherwise reshard the array if its uncommitted. This is important where you have 1 process per device.

PiperOrigin-RevId: 475418561
Limit console width for visualize_sharding
Add support for pmap sharding
Make the gda and xmap sharding check work generally by checking the OpSharding protos.

PiperOrigin-RevId: 475560097
Tracer: add missing __round__ and __reversed__ methods
Update JEP-12049 implementation discussion
Checkify: support batched while.
Update pjit_test to skip GDA tests with Array is enabled.

PiperOrigin-RevId: 475684445
Fix linker error due to chlo and stablehol symbols are not exported in mlir dll
Switch from experimental_strict_action_env to incompatible_strict_action_env to avoid deprecation warning
Disable tests under sanitizers that are timing out in CI.

PiperOrigin-RevId: 475839926
Flip default value of jax_unique_mhlo_module_names to False.

This should help avoid unnecessary cache misses.

PiperOrigin-RevId: 475852954
Add many args benchmark for jax.Array

PiperOrigin-RevId: 475853211
[XLA:GPU] Allow simplifying lowering-precision-conversions by default

This might lead to the output having higher precision than specified by HLO.

PiperOrigin-RevId: 475889141
[typing] add class-level declarations of Array members.

This fixes some pytype errors associated with the changes in
Temporarily skip LaxBackedNumpyTests.testUnwrap on gpu to unblock jaxlib build

PiperOrigin-RevId: 475970440
Add addressable_data to Array (similar to GDA) to aid in transition and also in auto spmd partitioner mode, always convert to MeshPspecSharding.

PiperOrigin-RevId: 475972534
Implement pjit fast path in cpp for jax.Array inputs

PiperOrigin-RevId: 475988677
Don't tuple arguments passed to XLA:CPU

This is not needed and tuples are being avoided when possible for new code.

This is tested by CPPJitTest.test_jit_with_many_args_works in jax/tests:api_test_cpu

PiperOrigin-RevId: 476032228
Make `jit(f).lower(*args)` go via lower_sharding_computation when `jax_array` is enabled.

PiperOrigin-RevId: 476148608
[ROCM] Update Dockerfil.rocm to Ubuntu20
Disable tests that timeout in debug mode in CI

PiperOrigin-RevId: 476157051
Add generic interface for auto initialization of distributed JAX service

* Also add slurm cluster support
Change JAX's copyright attribution from ""Google LLC"" to ""The JAX Authors."".

See https://opensource.google/documentation/reference/releasing/contributions#copyright for more details.

PiperOrigin-RevId: 476167538
Fix example in `pjit` docstring
[array] full_like: only match sharding if shape==None
Add inspect_array_sharding, enabling looking at shardings in pjit-ted functions

PiperOrigin-RevId: 476237731
Update debugging docs to have sharding visualization
[sparse] Move `_bcoo_nse` to sparse util.

PiperOrigin-RevId: 476263483
removed repeated nan_to_num in docs
Improve documentation for unique_indices.
Checkify: misc improvements.

- err.throw == check_error(err) -> meaning they have the same behavior
  under checkify now
- ""divided by zero"" -> ""division by zero""
- add validation that check_error only takes args of type Error
Fix xla extension version test in debugging.py

The custom call partitioner callback was not present in version 94 but is present in version 95.
Convert the devices in the `Mesh` constructor to a numpy array if its a list, tuple, etc.

PiperOrigin-RevId: 476380496
Fix the asan failure in pjit_test_cpu build target

PiperOrigin-RevId: 476382929
Fix copyright attribution for some newly added files.

PiperOrigin-RevId: 476390902
Modify CorrCoef test to not rely on floating poing representation of 1/3

The operation computed an average while using the dimension of size 3. This is then changed to multiplying by 1/3 with compilers, but 1/3 cannot be represented perfectly. That made this test case rely on a very precise result from an unrepresentable calculation.

PiperOrigin-RevId: 476391389
Allow transpose axes to be negative to match (undocumented) NumPy behavior
Update the `_check_special` code to not use xla_shape since its deprecated and does not work with Array.

PiperOrigin-RevId: 476422732
Add regression test for lax.rev simplification error

PiperOrigin-RevId: 476430486
add multihost pjit tests
fix leak checker internal error

The issue was that partial_eval.py's _memoize, used in custom_jvp, was made
into an identity function by enabling config.jax_check_tracer_leaks (from
references to the main trace (needed for the jvp_jaxpr thunk) and hence trigger
the leak checker (which would see if any references to the main trace persisted
after finishing tracing of the user function).

But after, the leak checker should only trigger when actual Tracers are
leaked. So disabling the memoization when jax_check_tracer_leaks is no longer
active shouldn't be necessary. (These PR numbers seem out of order! We're not
sure why.)

Co-authored-by: Sharad Vikram <sharad.vikram@gmail.com>
Return single device Arrays from `.device_buffer` and `.device_buffers`.

PiperOrigin-RevId: 476449591
fix typo in test
Fix jnp.unwrap() test failures on GPU.

A recent XLA change allows XLA to use excess precision on GPU, which caused CompileAndCheck to report noticeable numerical changes for bfloat16.

In passing, also enable the comparison against NumPy test for bfloat16 by using a wrapper function.

PiperOrigin-RevId: 476494989
Only look at hlo_modules for output sharding if there is more than 1 device because if there is only 1 device, the spmd partitioner won't run.

PiperOrigin-RevId: 476497929
- Wraps calls to lax.xeinsum and _einsum in a named call with their 'spec', the string specifying the computation. Makes xprof traces more interpretable.

PiperOrigin-RevId: 476796185
Wrap multiprocess test popen() uses in a context manager.

Ensures that resources from popen() are cleaned up.
Jax and jaxlib 0.3.18 release candidate.
Add initial jax.Array base class for instance checks & annotation
Lowerable checks!!
Remove unused _remat_static_argnums import.
lowerable errors behind a config flag.","GitHub commits.
Changes
Ahead-of-time lowering and compilation functionality (tracked in
{jax-issue}) is stable and public. See the
overview and the API docs
for {mod}jax.stages.
Introduced {class}jax.Array, intended to be used for both isinstance checks
and type annotations for array types in JAX. Notice that this included some subtle
changes to how isinstance works for {class}jax.numpy.ndarray for jax-internal
objects, as {class}jax.numpy.ndarray is now a simple alias of {class}jax.Array.
Breaking changes
jax._src is no longer imported into the from the public jax namespace.
This may break users that were using JAX internals.
jax.soft_pmap has been deleted. Please use pjit or xmap instead.
jax.soft_pmap is undocumented. If it were documented, a deprecation period
would have been provided."
"chore(release): 1.7.4 [skip ci]

## [1.7.4](https://github.com/iamkun/dayjs/compare/v1.7.3...v1.7.4) (2018-07-11)

### Bug Fixes

* update set week logic ([60b6325](https://github.com/iamkun/dayjs/commit/60b6325)), closes [](https://github.com/iamkun/dayjs/issues/276)
Update README.md
Update README.md
Add romanian locale
fix german locale
Implements isBetween plugin
Sets testURL in jest config for resolve issue with failing tests
Changes logic of isBetween
Now it works with non dayjs-like arguments and not depends on order of input
Prettify isBetween output
fix: add isBetween API & update

update german locale, add romanian locale
chore(release): 1.7.5 [skip ci]

## [1.7.5](https://github.com/iamkun/dayjs/compare/v1.7.4...v1.7.5) (2018-08-10)

### Bug Fixes

* add isBetween API & update ([b5fc3d1](https://github.com/iamkun/dayjs/commit/b5fc3d1))","Bug Fixes
add isBetween API & update (b5fc3d1)"
"chore(release): 1.9.5 [skip ci]

## [1.9.5](https://github.com/iamkun/dayjs/compare/v1.9.4...v1.9.5) (2020-11-05)

### Bug Fixes

* customParseFormat plugin supports parsing localizedFormats  ([](https://github.com/iamkun/dayjs/issues/1110)) ([402b603](https://github.com/iamkun/dayjs/commit/402b603aa3ee4199786950bc88b3fdc6b527aa35))
* fix customParseFormat plugin parse meridiem bug ([](https://github.com/iamkun/dayjs/issues/1169)) ([9e8f8d9](https://github.com/iamkun/dayjs/commit/9e8f8d96c69d557f4d267f42567c25ae9e7ab227)), closes [](https://github.com/iamkun/dayjs/issues/1168)
* fix devHelper error in umd bundle in browser ([](https://github.com/iamkun/dayjs/issues/1165)) ([d11b5ee](https://github.com/iamkun/dayjs/commit/d11b5ee7dc11af671355f65ccda00f6ba42cc725))
* fix utc plugin diff bug in DST ([](https://github.com/iamkun/dayjs/issues/1171)) ([f8da3fe](https://github.com/iamkun/dayjs/commit/f8da3fe7e50c84c0502bf5be0b364910922dbd79)), closes [](https://github.com/iamkun/dayjs/issues/1097) [](https://github.com/iamkun/dayjs/issues/1021)
* isoWeek plugin type ([](https://github.com/iamkun/dayjs/issues/1177)) ([c3d0436](https://github.com/iamkun/dayjs/commit/c3d0436b06f74989e3a2c751a5d170f8072c4aad))
* update localeData plugin to support meridiem ([](https://github.com/iamkun/dayjs/issues/1174)) ([fdb09e4](https://github.com/iamkun/dayjs/commit/fdb09e4074cc7e8f6196846f18d3566c1f9e8fcd)), closes [](https://github.com/iamkun/dayjs/issues/1172)
* update timezone plugin parse Date instance / timestamp logic & remove useless test ([](https://github.com/iamkun/dayjs/issues/1183)) ([a7f858b](https://github.com/iamkun/dayjs/commit/a7f858bb70ad81f718ba35c479e84b54eace48b2))
fix: Update lv (Latvian) locale relative time ()
fix: fix customParseFormat plugin parsing date bug ()

fix
chore(release): 1.9.6 [skip ci]

## [1.9.6](https://github.com/iamkun/dayjs/compare/v1.9.5...v1.9.6) (2020-11-10)

### Bug Fixes

* fix customParseFormat plugin parsing date bug ([](https://github.com/iamkun/dayjs/issues/1198)) ([50f05ad](https://github.com/iamkun/dayjs/commit/50f05ad3addf27827c5657ae7519514e40d9faec)), closes [](https://github.com/iamkun/dayjs/issues/1194)
* Update lv (Latvian) locale relative time ([](https://github.com/iamkun/dayjs/issues/1192)) ([6d6c684](https://github.com/iamkun/dayjs/commit/6d6c6841b13ba4f7e69de92caf132a3592c5253a))","Bug Fixes
fix customParseFormat plugin parsing date bug () (50f05ad), closes
Update lv (Latvian) locale relative time () (6d6c684)"
"chore(release): 1.9.7 [skip ci]

## [1.9.7](https://github.com/iamkun/dayjs/compare/v1.9.6...v1.9.7) (2020-12-05)

### Bug Fixes

* add duration.format to format a Duration ([](https://github.com/iamkun/dayjs/issues/1202)) ([9a859a1](https://github.com/iamkun/dayjs/commit/9a859a147ba223a1eeff0f2bb6f33d97e0ccc6c7))
* Add function handling for relativeTime.future and relativeTime.past ([](https://github.com/iamkun/dayjs/issues/1197)) ([ef1979c](https://github.com/iamkun/dayjs/commit/ef1979ce85c61fe2d759ef3c37cb6aaf2358094f))
* avoid install installed plugin ([](https://github.com/iamkun/dayjs/issues/1214)) ([a92eb6c](https://github.com/iamkun/dayjs/commit/a92eb6c4dc1437ec920e69484d52984f5921a8ea))
* avoid memory leak after installing a plugin too many times ([b8d2e32](https://github.com/iamkun/dayjs/commit/b8d2e32a9eb59661a7ed6200daa070687becaebd))
* fix diff bug when UTC plugin enabled ([](https://github.com/iamkun/dayjs/issues/1201)) ([9544ed2](https://github.com/iamkun/dayjs/commit/9544ed2a6c466b8308d26b33a388a6737435a1f4)), closes [](https://github.com/iamkun/dayjs/issues/1200)
* fix startOf/endOf bug in timezone plugin ([](https://github.com/iamkun/dayjs/issues/1229)) ([eb5fbc4](https://github.com/iamkun/dayjs/commit/eb5fbc4c7d1b62a8615d2f263b404a9515d8e15c))
* fix utc plugin diff edge case ([](https://github.com/iamkun/dayjs/issues/1187)) ([971b3d4](https://github.com/iamkun/dayjs/commit/971b3d40b4c9403165138f1034e2223cd97c3abf))
* update customParseFormat plugin to parse 2-digit offset ([](https://github.com/iamkun/dayjs/issues/1209)) ([b56936a](https://github.com/iamkun/dayjs/commit/b56936ab77b8f6289a1b77d49307b495c4bf9f91)), closes [](https://github.com/iamkun/dayjs/issues/1205)
* Update timezone plugin type definition ([](https://github.com/iamkun/dayjs/issues/1221)) ([34cfb92](https://github.com/iamkun/dayjs/commit/34cfb920b9653ad44d4b31fe49e533692a3ce01b))
fix: update zh-cn locale definition of noon  ()

Changed the definition of “中午”(noon), which is between 11am to 13pm.
test: update zh-cn locale test
fix: update zh locale meridiem ""noon""
fix: fix Ukrainian [uk] locale typo
fix: update Hebrew [he] locale for double units ()
chore(release): 1.9.8 [skip ci]

## [1.9.8](https://github.com/iamkun/dayjs/compare/v1.9.7...v1.9.8) (2020-12-27)

### Bug Fixes

* fix Ukrainian [uk] locale typo ([1605cc0](https://github.com/iamkun/dayjs/commit/1605cc0f6fe0e9c46a92d529bc9cd6e130432337))
* update Hebrew [he] locale for double units ([](https://github.com/iamkun/dayjs/issues/1287)) ([1c4b0da](https://github.com/iamkun/dayjs/commit/1c4b0da1468522e59dc9ee646d10dd2b31477d99))
* update zh locale meridiem ""noon"" ([0e7ff3d](https://github.com/iamkun/dayjs/commit/0e7ff3dd29ca3aed85cb76dfcb8298d326e26542))
* update zh-cn locale definition of noon  ([](https://github.com/iamkun/dayjs/issues/1278)) ([d5930b9](https://github.com/iamkun/dayjs/commit/d5930b96ff884f4176ca3fcb1bc95e8f1ec75c71))","Bug Fixes
fix Ukrainian [uk] locale typo (1605cc0)
update Hebrew [he] locale for double units () (1c4b0da)
update zh locale meridiem ""noon"" (0e7ff3d)
update zh-cn locale definition of noon  () (d5930b9)"
"chore(release): 1.8.27 [skip ci]

## [1.8.27](https://github.com/iamkun/dayjs/compare/v1.8.26...v1.8.27) (2020-05-14)

### Bug Fixes

* Add Kinyarwanda (rw) locale ([](https://github.com/iamkun/dayjs/issues/903)) ([f355235](https://github.com/iamkun/dayjs/commit/f355235a836540d77880959fb1b614c87e9f7b3e))
* Add plugin objectSupport ([](https://github.com/iamkun/dayjs/issues/887)) ([52dfb13](https://github.com/iamkun/dayjs/commit/52dfb13a6b84f0a753cc5761192b92416f440961))
* Add Turkmen (tk) locale ([](https://github.com/iamkun/dayjs/issues/893)) ([a9ca8dc](https://github.com/iamkun/dayjs/commit/a9ca8dcbbd0964c5b9abb4e8a2d620c983cf091a))
* Fix CustomParseFormat plugin set locale error ([](https://github.com/iamkun/dayjs/issues/896)) ([8035c8a](https://github.com/iamkun/dayjs/commit/8035c8a760549b631252252718db3cdc4ab2f68f))
* Fix locale month function bug ([](https://github.com/iamkun/dayjs/issues/908)) ([bf347c3](https://github.com/iamkun/dayjs/commit/bf347c36e401f50727fb5afcc537497b54b90d6b))
* Update CustomParseFormat plugin to support Array formats ([](https://github.com/iamkun/dayjs/issues/906)) ([97856c6](https://github.com/iamkun/dayjs/commit/97856c603ef5fbbeb1cf8a42387479e56a77dbe8))
fix: Update Ukrainian (uk) locale monthFormat and monthStandalone ()
fix: Fix CustomParseFormat plugin month index error ()

fix
chore(release): 1.8.28 [skip ci]

## [1.8.28](https://github.com/iamkun/dayjs/compare/v1.8.27...v1.8.28) (2020-05-28)

### Bug Fixes

* Fix CustomParseFormat plugin month index error ([](https://github.com/iamkun/dayjs/issues/918)) ([fa2ec7f](https://github.com/iamkun/dayjs/commit/fa2ec7fcb980dcd2c7498dafe2f9ca2e52d735cf)), closes [](https://github.com/iamkun/dayjs/issues/915)
* Update Ukrainian (uk) locale monthFormat and monthStandalone ([](https://github.com/iamkun/dayjs/issues/899)) ([a08756e](https://github.com/iamkun/dayjs/commit/a08756e80bd1d7126fca28c5ad9e382613fc86c4))","Bug Fixes
Fix CustomParseFormat plugin month index error () (fa2ec7f), closes
Update Ukrainian (uk) locale monthFormat and monthStandalone () (a08756e)"
"chore(release): 1.8.17 [skip ci]

## [1.8.17](https://github.com/iamkun/dayjs/compare/v1.8.16...v1.8.17) (2019-11-06)

### Bug Fixes

* Fix set utcOffset in utc mode ([d148115](https://github.com/iamkun/dayjs/commit/d148115dad8f1a5afc0a64e9b8163dfeba4616b6))
* Update advancedFormat plugin to support w ww wo week tokens … ([](https://github.com/iamkun/dayjs/issues/678)) ([26cfa63](https://github.com/iamkun/dayjs/commit/26cfa63a524b803f7966dac5464f9cbf8f63387e)), closes [](https://github.com/iamkun/dayjs/issues/676)
* Update ka locale weekdays ([f8ca3d4](https://github.com/iamkun/dayjs/commit/f8ca3d4ba1d3cbe41613d3909c0627935a51a0c4))
* Update nb locale ([](https://github.com/iamkun/dayjs/issues/679)) ([1063b0e](https://github.com/iamkun/dayjs/commit/1063b0e1b5c19a1354d233cc0f21438e7073233a))
* Update Polish locale (pl)([](https://github.com/iamkun/dayjs/issues/713)) ([30d2f02](https://github.com/iamkun/dayjs/commit/30d2f026b47188833a4f44fee4bab52467d4a718))
* Update Ukrainian locale (uk) ([](https://github.com/iamkun/dayjs/issues/710)) ([360161c](https://github.com/iamkun/dayjs/commit/360161cac75f597fdd51d9d1ff138601282a1b4b))
* UTC plugin set utcOffset value ([](https://github.com/iamkun/dayjs/issues/668)) ([8877883](https://github.com/iamkun/dayjs/commit/88778838e71dd309e79cd1a8094d5bea36ca3390))
fix: Update Italian locale (it) ()
fix: Update locale (fa) ()
fix: Update locale (zh-cn) ()
fix: Update locale (zh-cn) meridiem ()
fix: Update Swedish locale (sv) fix ordinal error ()

fix
fix(): Add missing locale type definition ()
fix: Update LocaleData plugin to support dayjs().longDateFormat() ()

fix
fix: Update Mongolian (mn) locale relativeTime ()
fix: Fix .locale() handel unsupported locale
chore(release): 1.8.18 [skip ci]

## [1.8.18](https://github.com/iamkun/dayjs/compare/v1.8.17...v1.8.18) (2019-12-18)

### Bug Fixes

* Add missing locale type definition ([](https://github.com/iamkun/dayjs/issues/716)) ([cde5d0b](https://github.com/iamkun/dayjs/commit/cde5d0b91be7b2f5f3098de4aa0b9a4f0f28ea5c))
* Fix .locale() handel unsupported locale ([78ec173](https://github.com/iamkun/dayjs/commit/78ec173fcecc1299516ab7b44f4554d431b4b2fd))
* Update Italian locale (it) ([](https://github.com/iamkun/dayjs/issues/727)) ([5b53e98](https://github.com/iamkun/dayjs/commit/5b53e98c0a3ba0eb9573a9c77caeb907439be9e7))
* Update locale (fa) ([](https://github.com/iamkun/dayjs/issues/733)) ([9ad2e47](https://github.com/iamkun/dayjs/commit/9ad2e47e0569b23991bb0d5578f49c792c12df08))
* Update locale (zh-cn) ([](https://github.com/iamkun/dayjs/issues/706)) ([e31e544](https://github.com/iamkun/dayjs/commit/e31e54414fb90e1f54da13a117748ba37f52645d))
* Update locale (zh-cn) meridiem ([](https://github.com/iamkun/dayjs/issues/735)) ([15d1b81](https://github.com/iamkun/dayjs/commit/15d1b813e7faf5a1f9d1ea6fc673fd27ac49d8b1))
* Update LocaleData plugin to support dayjs().longDateFormat() ([](https://github.com/iamkun/dayjs/issues/734)) ([aa0f210](https://github.com/iamkun/dayjs/commit/aa0f210a1e3c4f6aba61c3b96f9eb445b43a33f0)), closes [](https://github.com/iamkun/dayjs/issues/680)
* Update Mongolian (mn) locale relativeTime ([](https://github.com/iamkun/dayjs/issues/753)) ([6d51435](https://github.com/iamkun/dayjs/commit/6d51435092c0c94d8e50256d3f0f058cdd15febe))
* Update Swedish locale (sv) fix ordinal error ([](https://github.com/iamkun/dayjs/issues/745)) ([49670d5](https://github.com/iamkun/dayjs/commit/49670d5ae31e4e21636cc5a8bfe35fef0f6d9e4a)), closes [](https://github.com/iamkun/dayjs/issues/743)","Bug Fixes
Add missing locale type definition () (cde5d0b)
Fix .locale() handel unsupported locale (78ec173)
Update Italian locale (it) () (5b53e98)
Update locale (fa) () (9ad2e47)
Update locale (zh-cn) () (e31e544)
Update locale (zh-cn) meridiem () (15d1b81)
Update LocaleData plugin to support dayjs().longDateFormat() () (aa0f210), closes
Update Mongolian (mn) locale relativeTime () (6d51435)
Update Swedish locale (sv) fix ordinal error () (49670d5), closes"
"chore(release): 1.11.11 [skip ci]

## [1.11.11](https://github.com/iamkun/dayjs/compare/v1.11.10...v1.11.11) (2024-04-28)

### Bug Fixes

* day of week type literal ([](https://github.com/iamkun/dayjs/issues/2630)) ([f68d73e](https://github.com/iamkun/dayjs/commit/f68d73efe562fdedd9e288ecb0ce6565e602f507))
* improve locale ""zh-hk"" format and meridiem ([](https://github.com/iamkun/dayjs/issues/2419)) ([a947a51](https://github.com/iamkun/dayjs/commit/a947a5171aad5695eaf593bc95fe073de0f0894a))
* Update 'da' locale to match correct first week of year ([](https://github.com/iamkun/dayjs/issues/2592)) ([44b0936](https://github.com/iamkun/dayjs/commit/44b0936ad709212b63e48672d8b9c225e2c3b830))
* update locale Bulgarian monthsShort Jan ([](https://github.com/iamkun/dayjs/issues/2538)) ([f0c9a41](https://github.com/iamkun/dayjs/commit/f0c9a41c6ec91528f3790e442b0c5dff15a4e640))
fix: Add NegativeYear Plugin support  ()
chore: Update README.md
chore: update doc demo
fix: Improve typing for min/max plugin ()

No null if at least one date is passed; only null if explicitly no dates are passed.

Co-authored-by: iamkun <kunhello@outlook.com>
chore: Update README.md
chore: update demo
chore: update demo
fix: Fix zero offset issue when use tz with locale ()

* test: add test case for tz with locale

* fix: set utc as false if $offset is 0
fix: add UTC support to negativeYear plugin ()
fix: timezone plugin currect parse UTC tz ()
chore: added README translation for Swahili speakers ()
chore: rm useless import
chore(release): 1.11.12 [skip ci]

## [1.11.12](https://github.com/iamkun/dayjs/compare/v1.11.11...v1.11.12) (2024-07-18)

### Bug Fixes

* Add NegativeYear Plugin support  ([](https://github.com/iamkun/dayjs/issues/2640)) ([6a42e0d](https://github.com/iamkun/dayjs/commit/6a42e0d7398639238f575d51287daaf4d495a2a3))
* add UTC support to negativeYear plugin ([](https://github.com/iamkun/dayjs/issues/2692)) ([f3ef705](https://github.com/iamkun/dayjs/commit/f3ef705613af83333fe132b470896a65e12f31b0))
* Fix zero offset issue when use tz with locale ([](https://github.com/iamkun/dayjs/issues/2532)) ([d0e6738](https://github.com/iamkun/dayjs/commit/d0e6738a66e1b65d3706aad2f9168ebb43d4f887))
* Improve typing for min/max plugin ([](https://github.com/iamkun/dayjs/issues/2573)) ([4fbe94a](https://github.com/iamkun/dayjs/commit/4fbe94aaba8c815a42cf4d23dabac918ec50e68c))
* timezone plugin currect parse UTC tz ([](https://github.com/iamkun/dayjs/issues/2693)) ([b575c81](https://github.com/iamkun/dayjs/commit/b575c81a8c9c85c7a0baf6f608a12f9d3ba95bd1))","Bug Fixes
Add NegativeYear Plugin support  () (6a42e0d)
add UTC support to negativeYear plugin () (f3ef705)
Fix zero offset issue when use tz with locale () (d0e6738)
Improve typing for min/max plugin () (4fbe94a)
timezone plugin currect parse UTC tz () (b575c81)"
"chore(release): 1.11.0 [skip ci]

# [1.11.0](https://github.com/iamkun/dayjs/compare/v1.10.8...v1.11.0) (2022-03-14)

### Bug Fixes

* Add Kirundi (rn) locale ([](https://github.com/iamkun/dayjs/issues/1793)) ([74e5247](https://github.com/iamkun/dayjs/commit/74e5247227a779fffde39bdfcd1ee19911496709))
* add missing date shorthand D type definition ([](https://github.com/iamkun/dayjs/issues/1752)) ([b045baf](https://github.com/iamkun/dayjs/commit/b045baf1646a81f7e4f446f355d02d5fb0ef4aa7))
* Add relative time to Galician (gl) and fix ordinals ([](https://github.com/iamkun/dayjs/issues/1800)) ([dcbf170](https://github.com/iamkun/dayjs/commit/dcbf1708400624addfbddbc71e0f6a9ac15fa961))
* update German locales (de-at, de-ch) ([](https://github.com/iamkun/dayjs/issues/1775)) ([f9055a7](https://github.com/iamkun/dayjs/commit/f9055a77bf3d84c575e5fcf99e21611138ba64d7))
* update Icelandic [is] locale relativeTime config ([](https://github.com/iamkun/dayjs/issues/1796)) ([76f9e17](https://github.com/iamkun/dayjs/commit/76f9e1756de7e99c01e471dab30ea074b9ec9629))
* Update index.d.ts note ([](https://github.com/iamkun/dayjs/issues/1716)) ([5a108ff](https://github.com/iamkun/dayjs/commit/5a108ff3159c53fd270ea7638f33c35c934d6457))
* Update locale German [de] monthsShort ([](https://github.com/iamkun/dayjs/issues/1746)) ([4a7b7d0](https://github.com/iamkun/dayjs/commit/4a7b7d07c885bb9338514c234dbb708e24e9863e))
* update meridiem function to Kurdish (ku) locale ([](https://github.com/iamkun/dayjs/issues/1725)) ([efd3904](https://github.com/iamkun/dayjs/commit/efd3904ff8cbf0a4fc064911dda76fc86b669f7b))
* update updateLocal plugin typescript types ([](https://github.com/iamkun/dayjs/issues/1692)) ([c7a3f73](https://github.com/iamkun/dayjs/commit/c7a3f73064dbb63b4d365b2ad4c792f075f4d8d8))

### Features

* Fallback to language only locale + support uppercase locales ([](https://github.com/iamkun/dayjs/issues/1524)) ([9138dc2](https://github.com/iamkun/dayjs/commit/9138dc28206875372da4fb74c64716437cd11b95))
chore(release): 1.11.1 [skip ci]

## [1.11.1](https://github.com/iamkun/dayjs/compare/v1.11.0...v1.11.1) (2022-04-15)

### Bug Fixes

* add Bengali (Bangladesh) [bn-bd] locale ([](https://github.com/iamkun/dayjs/issues/1806)) ([840ed76](https://github.com/iamkun/dayjs/commit/840ed76eedc085afefc4dedd05f31d44196b63b0))
* refactor replace deprecated String.prototype.substr() ([](https://github.com/iamkun/dayjs/issues/1836)) ([627fa39](https://github.com/iamkun/dayjs/commit/627fa393e4daf83c92431162dbe18534b23fcbae))
* Update German [de] locale, adds the abbreviations for month including a . in the end, as in September -> Sept. ([](https://github.com/iamkun/dayjs/issues/1831)) ([4e2802c](https://github.com/iamkun/dayjs/commit/4e2802cc3bec2941ffb737a15fb531c90951eafe))
* update Italian (Switzerland) [it-ch] locale relativeTime ([](https://github.com/iamkun/dayjs/issues/1829)) ([8e6d11d](https://github.com/iamkun/dayjs/commit/8e6d11d053393d97bee1ba411adb2d82de1a58c4))
* update Kurdish [ku] locale strings and formatted output contains non-standard kurdish characters ([](https://github.com/iamkun/dayjs/issues/1848)) ([a597d0b](https://github.com/iamkun/dayjs/commit/a597d0b1b8dd28e626f8c59d326622088f7b51e7))
* update locale bo [Tibetan]: corrected the orders in formats ([](https://github.com/iamkun/dayjs/issues/1823)) ([e790516](https://github.com/iamkun/dayjs/commit/e79051617af6787358f6c9b5443d987b8b53a9e1))","Bug Fixes
add Bengali (Bangladesh) [bn-bd] locale () (840ed76)
refactor replace deprecated String.prototype.substr() () (627fa39)
Update German [de] locale, adds the abbreviations for month including a . in the end, as in September -> Sept. () (4e2802c)
update Italian (Switzerland) [it-ch] locale relativeTime () (8e6d11d)
update Kurdish [ku] locale strings and formatted output contains non-standard kurdish characters () (a597d0b)
update locale bo [Tibetan]: corrected the orders in formats () (e790516)"
"ceph: re-enable config overrides for osds

The Ceph config overrides in the release-1.1 branch require
merging the overrides from /etc/ceph/ceph.conf into the generated ceph.conf.
This is different from the master branch where the osd configuration
has changed such that the overrides will automatically be picked up
from /etc/ceph/ceph.conf.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
Revert ""ceph: osd remove --conf flag""

The --conf flag is necessary in the release-1.1 branch. Due to changes
in master that have not been backported, this flag is not needed there.

This reverts commit 9b614df49004457468cce058b0574791f192ddbb.
Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
build: set the v1.1.4 release tag

With the v1.1.4 patch release we need to set the new tag in the
deployment manifests and documentation.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.1.4 is a patch release limited in scope and focusing on bug fixes. Note that release v1.1.3 was skipped.
Ceph
OSD config overrides were ignored for some upgraded OSDs (, @leseb)
Enable restoring a cluster after disaster recovery (, @travisn)
Enable upgrade of OSDs configured on PVCs (, @sp98)
Automatically removing OSDs requires setting: removeOSDsIfOutAndSafeToRemove(, @rohgupta)
Rework csi keys and secrets to use minimal privileges (, @leseb)
Expose OSD prepare pod resource limits (, @leseb)
Minimum K8s version for running OSDs on PVCs is 1.13 (, @sp98)
Add 'rgw.buckets.non-ec' to list of RGW metadataPools (, @OwenTuz)
Hide wrong error for clusterdisruption controller (, @leseb)
Multiple integration test fixes to improve CI stability (, @travisn)
Detect mount fstype more accurately in the flex driver (, @leseb)
Do not override mgr annotations (, @leseb)
Add OSDs to proper buckets in crush hierarchy with topology awareness (, @mateuszlos)
More robust removal of cluster finalizer (, @travisn)
Take activeStandby into account for the CephFileSystem disruption budget (, @rohantmp)
Update the CSI CephFS registration directory name (, @Madhu-1)
Fix incorrect Ceph CSI doc links (, @binoue)
Remove decimal places for osdMemoryTargetValue monitoring setting (, @eknudtson)
Relax pre-requisites for external cluster to allow connections to Luminous (, @leseb)
Avoid nodes getting stuck in OrchestrationStatusStarting during OSD config (, @mantissahz)
Make metrics and liveness port configurable (, @Madhu-1)
Correct system namespace for CSI driver settings during upgrade (, @Madhu-1)
Other
Proper owner references for garbage collection for yugabytedb, minio, & cockroachdb (, @travisn)"
"ceph: keyring: stop using auid 0

This setting is long gone in Ceph and not used anymore, so let's not
create it for new cluster.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 5a2cd41d25c2e0bdf3d8c89ea3d739783ade4c39)
ceph: stop creating initial crushmap

This commit does:

* remove dead code SetCrushTunables()
* stop creating initial crushmap

There is no need to create an initial crushmap, since Ceph natively does
that for us.
We don't delete the existing configmap containing the initial crush map
of already deployed cluster, perhaps people are using for whatever
reason. It does not harm to keep it around.

Closes: https://github.com/rook/rook/issues/3138
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit ccf21100074766c64071ba3a89b187914e41dc39)
ceph: adjust M-to-Mi rounding in PV creation

Example of failure scenarios:

   - requested PVC 500M = 500,000,000 bytes
   - PV is created as:
        (500M / 2**20)Mi = ""476""Mi
        But 476Mi = 476 * 2**20 = 499122176 < 500M

From the k8s documentation:

   Claims will remain unbound indefinitely if a matching volume does not
   exist. Claims will be bound as matching volumes become available. For
   example, a cluster provisioned with many 50Gi PVs would not match a
   PVC requesting 100Gi. The PVC can be bound when a 100Gi PV is added
   to the cluster.

which is inline with the behavior observed in which a 500M PVC is never
bound. However, the documentation also states:

   If a PV was dynamically provisioned for a new PVC, the loop will
   always bind that PV to the PVC. Otherwise, the user will always get
   at least what they asked for

which suggests that an _explicit_ binding can be created, and perhaps
something has changed with respect to this binding that has caused the
failures in newer versions of k8s.

fixes:
fixes:

Signed-off-by: Noah Watkins <noahwatkins@gmail.com>
(cherry picked from commit e7ae2b6abd7bf7859893849b9678dafa5c535f68)
ceph: rgw: set proper port syntax on beast

The beast fronted configuration for rgw is quite different than civetweb
so we adapted the construct of the arg line based on that configuration
requirement.

Closes: https://github.com/rook/rook/issues/3411
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 7d54cac453ebd7ed715377310b21013e1f29779e)
tests: ensure cluster does not exist before starting a test

The CI instances are not always being properly cleaned up
between runs. This is an attempt to get the tests
to ensure a clean install before proceeding with the test.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit ef9dc0be749a5cf5c5fbb9b516955070af82131a)
Update the yaml and doc versions to v1.0.4 for the release

Signed-off-by: travisn <tnielsen@redhat.com>","Rook v1.0.4 is a patch release limited in scope and focusing on bug fixes.
Improvements
Ceph
RGW: Set proper port syntax for beast in nautilus deployments (, @leseb)
Stop creating initial crushmap to avoid incorrect crush map warning (, @leseb)
Use correct rounding of PV size for binding of PVCs (for example G or Gi) (, @noahdesu)"
"fix slack links

Signed-off-by: Bassam Tabbara <bassam@upbound.io>
(cherry picked from commit ddcbc97e81e4aa89d32e53049235d6f8449cbea3)
Add ENV flag for selinux labeling

Signed-off-by: Timothy Allen <kex.allen13@gmail.com>
(cherry picked from commit ae46f31882708d114190b5d30dc339337739088f)
Correctly set secretkey from mountSecretKey param

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit 2e12167d82db4894bd150e5ae3d4949d465f5917)
fix for enabling tls on rados gateway s3 api:

this mounts secret as volume to rgw container
this adds certificate path to init container

Signed-off-by: Jack Lauritsen <jack.lauritsen@teradata.com>
(cherry picked from commit ea3e0fca26acf1578bf5e6b0dc4b67a1f94bae1c)
ceph: support custom dashboard port

Signed-off-by: Noah Watkins <noahwatkins@gmail.com>
(cherry picked from commit e66ad7463b2988a0843065cec399ab3006c8942e)
ceph: support dashboard ssl on/off

fixes:

cherry-pick notes: fixed whitespace in PendingReleaseNotes.md

Signed-off-by: Noah Watkins <noahwatkins@gmail.com>
(cherry picked from commit e9a9509313b2cc3434e2876ac814e5171f9b4b6a)
set mgr privs for access to the rbd mirroring settings

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 9afbe36ae698787245ad2eaa61bf923fc5c74047)
Changing timeout for dpkg unlock for Ubuntu GCE CI/CD systems

Signed-off-by: Christopher P. Maher <chris@mahercode.io>
(cherry picked from commit 19d953d51f986f63dea9be1a9555f28c159eb8b7)
allow disabling of fsGroup in the flex driver

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit bd25630d917c0f68d2f275c99bd3a34870b10419)
exec: interleave stdout/stderr logging

The io.MultiReader(r1, r2) reads r1 until EOF before moving on to r2.
When used for stdout/stderr stderr will not be written to the log until
stdout reaches EOF. This patch reads stderr in a go routine so that the
two streams can be interleaved properly.

Fixes:

Signed-off-by: Noah Watkins <noahwatkins@gmail.com>
(cherry picked from commit fbb56c41ed2c89e5fdc7178ea55e7c27ae1daff2)
use rook v0.9.2 and ceph v13.2.4 for the sample image tags

Signed-off-by: travisn <tnielsen@redhat.com>","Rook v0.9.2 is a patch release limited in scope and focusing on bug fixes.
Improvements
Ceph
Correctly capture and log the stderr output from child processes (, @noahdesu)
Allow disabling setting fsgroup when mounting a volume (, @travisn)
Allow configuration of SELinux relabeling (, @allen13)
Correctly set the secretKey used for cephfs mounts (, @galexrt)
Set ceph-mgr privileges to prevent the dashboard from failing on rbd mirroring settings (, @travisn)
Correctly configure the ssl certificate for the RGW service (, @syncroswitch)
Allow configuration of the dashboard port (, @noahdesu)
Allow disabling of ssl on the dashboard (, @noahdesu)
General
Increase timeout for starting GCE instances (, @Defilan)
Fix the links to Slack (, @bassam)"
"ceph: set osd mem target correctly

Previously, the value was set to commonArgs, resulting in dead code,
since common arg isn't used after the append.

Signed-off-by: Odin Ugedal <odin@ugedal.com>
(cherry picked from commit 0e73bbe2f3f3718ad8b0df709a01f178c0122fe9)
ceph: properly propagate errors when deleting mds

When deleting mds deployment the error is logged, but not propagated
further down (it always returns nil). The two places using the function
checks the error, and acts upon it.

Signed-off-by: Odin Ugedal <odin@ugedal.com>
(cherry picked from commit 43baf63b86e5eee9b9058bc5ca228029b54c2651)
mgr: set public-addr flag for MGR

This fixes that the MGR is binding to the gateway IP instead of the
actual Pod IP, as seen in.
When hostNetwork: true is set the public-addrr is not set so custom
network configs can be used.

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit 6daf4087c794b90bf504bc8e7ffe04a0594f6df7)
ceph: remove default database size for OSDs

Since Rook is no longer creating partitions and leaving all that
work to ceph-volume, we should let ceph-volume choose the defaults
for the database size and use the max available. The default of 20GB
in fact doesn't even make sense since Ceph will only use the first 3GB
of that size and the other 17GB was wasted.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit b8e5e56dc137af7d2acc5c00922661f8983aef25)
set image version in manifests to v1.0.6

Signed-off-by: travisn <tnielsen@redhat.com>","Rook v1.0.6 is a patch release limited in scope and focusing on bug fixes.
Improvements
Ceph
Set public-addr flag for MGR (, @galexrt)
Remove the 20GB default for OSD db size and allow ceph-volume to use all available space (, @travisn)
Correctly set osd mem target for init-ed clusters (, @odinuge)
Properly propagate errors when deleting mds deployment (, @odinuge)"
"ceph: add external support for objectstoreuser

Now, the object store user is capable of creating s3 users on an
external Ceph cluster.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 84d1e28c9925f54013bf3ec325b2d4444aad060f)
ceph: small user delete refactor

Do not return error code, interpret it directly, put the error as part
of the output on failures.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 5f74e493efebaf56e16aa8868639152d1cb424a2)
ceph: added CephClusterReadOnly alert and updated utilization alerts

Added a new critical alert CephClusterReadOnly which notifies when the cluster becomes read-only
Updated the warning and critical alert to accomodate the new alert

Closes: BZ1809248
Signed-off-by: Anmol Sachan <anmol13694@gmail.com>
(cherry picked from commit 7cebf15a7ded3ba3e56e3892ad2549347edbd963)
ceph: fix the test of OSD

Fix the following bugs.

- CephVersion is not back to Octopus
- `cephadm' here is called with three arguments,
  ""info --query=property <devname>"". We should use 'args[2]' instead.

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit e2df534abec834d842c18c59abd0df87c029e594)
ceph: fix ignoring device specification with non-kname

Partition's DevLinks are empty in osd-prepare-pod. So, the device
specification with non-kname, for example devicePathFilter, doesn't
work.

Closes: https://github.com/rook/rook/issues/5504

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit f65bb923ed9da75aa5af5902b4c0ad386596c2d3)
ceph: updated PVC utilizaztion alerts

Updated warning and critical alerts for all the PVC's created by rook-ceph provisioners. Added the recommendation to expand the PVCs.

Closes: BZ1849717
Signed-off-by: Anmol Sachan <anmol13694@gmail.com>
ceph: save mon config even if failed to remove dead mon

During mon failover if the mon fails to be removed, the new mon
config was not being saved. The mon removal anyway is not retried
if it fails, so it should make a best effort to remove all the
resources related to the mon, and then always update the mon
config after the failover.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 0be6fdfa2d28a78347075c06975911f74e9a87fe)
ceph: during mon failover remove the backing pvc

If the mon is backed by a pvc, ensure the pvc is deleted when
the mon is failed over. The pvc is being left in a bound state
even though it will no longer be used in the cluster.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 1d370b1314a1b9c28ec90b788b136c03bd9bdc40)
ceph: fix exec output

The previous code was overriding the content of `out`, now we just
return after the error.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit fa32f5323de9f927d91b642088d26679681d99ed)
ceph: fix GetUser

Stop check for the output, but read it instead.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 1efd490900a1937e2d60d9c9e0a5ab0676142c91)
ceph: force delete stuck mons in every reconcile

The stuck mons were only being force deleted in the mon health checker.
After an operator restart, the health check may not be executed
for 20 minutes until after the timeout during the main reconcile
which is holding onto a lock for mon reconcile. Now the stuck mon
will be deleted during the reconcile as well.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 99f17d3a337239462e46e53aa7569d8f73882270)
ceph: fix the wrong document of tuneDeviceClass

The tuning parameter of slow device is defined as ""tuneDeviceClass"".
However, it's written in the document as ""tuneSlowDeviceClass"".

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
build: set manifest versions to v1.3.7

Set manifest versions to v1.3.7 for the release

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.3.7 is a patch release limited in scope and focusing on small feature additions and bug fixes.
Ceph
Force delete stuck mons in every reconcile instead of only in the health check (, @travisn)
During mon failover remove the backing pvc (, @travisn)
Fix for the devicePathFilter during OSD creation (, @satoru-takeuchi)
External support for object store users (, @leseb)
Added warning and critical alerts for all the Ceph PVCs (, @anmolsachan)
Added CephClusterReadOnly alert and updated utilization alerts (, @anmolsachan)
Cassandra
Update base image to alpine:3.12 (, @galexrt)"
"Mgr: fix prometheus annotations

This fixes https://github.com/rook/rook/issues/3204

Move prometheus Annoation logic before Deployment is initialized,
otherwise, podSpec is not uptodate

Signed-off-by: Dinar Valeev <k0da@opensuse.org>
Improve update 0.9 to 1.0 docs

 - Changed an instruction that used vi to a kubectl scale command

Signed-off-by: Danilo Riecken <danilo.riecken@teralytics.net>
Make the ownerreference name match the cluster name referenced

In order to cleanup all cluster resources in case of cluster deletion
all resources have an ownerreference to the cluster crd instance.
Because the name of the reference was incorrectly set to the name of the
namespace the cluster resources can unintentionally be deleted by the
kubernetes garbage collector after a kubernetes cluster anomaly.

Signed-off-by: René Kalff <r.kalff@intermax.nl>
(cherry picked from commit 25780878ebee5b1326c550b15fe06390c2e7f181)
Update the yaml and doc version to v1.0.5 for the release

Signed-off-by: travisn <tnielsen@redhat.com>","Rook v1.0.5 is a patch release limited in scope and focusing on bug fixes.
Improvements
Ceph
Set owner references properly to avoid unexpected K8s garbage collection (, @renekalff)
Add prometheus annotations properly to mgr deployment (, @k0da)"
"docs: update docs and yaml to v0.6.0
Unmarshal volume plugin dir from kubelet config response for 1.8

(cherry picked from commit faa2baee4b06b2384b8c41e6a7705f0c3b55176e)
tests: integration test for flexvolume path discovery

(cherry picked from commit 8ef8718efb237d205af37fd51e5c71543da02374)
tests: use a non default volume plugin dir path for k8s 1.8

(cherry picked from commit de7e6dbd56cfbf74f0e3a680c0434f6deb2fa92b)
Add existence checks for FlexVolume on Delete

This is a rather noisesome way of checking something which will only
happen during legacy conversion, so this may not be a desirable patch.

(cherry picked from commit 39e68a3c2b420f0b8b1abe46c101f966297a1a66)
rgw: skip deleting root pool when there are multiple object stores

(cherry picked from commit e7bd52a19935ea76f190c2a2e5e35eab03768e12)
docs: add replica count param to client walkthrough

(cherry picked from commit 825cc5b4706c09bf57dad1cc56ebd231acc8cee4)
api: recreate mon endpoint watcher when the result channel is closed

(cherry picked from commit 9da4d286d2be8ad58bc2c04195745eb1150dba62)
Ensuring volume lock is released when the same pod is requesting it

There is a case where a pod is trying to request a volume
attachment after the previous attachment failed. However even though this is
the same pod as the original attachment request, its UID could be different. This is normally caused when
the user manually deletes the pod and recreate it again. The name will be the same but the ID will be different

fixes https://github.com/rook/rook/issues/1214

(cherry picked from commit c1882d4760f5148d7c66dd4303e0990d5f6bfcfd)","Rook v0.6.1 is a patch release limited in scope and focusing on bug fixes.
Improvements
Non-default locations in Kubernetes 1.8 for the volume plugin directory will now correctly be discovered by the rook agents (@jbw976)
Fixed an issue where the rook-api pod would over time begin to consume 100% CPU (@jbw976)
Deletion of an object store will now be scoped to just the specified object store (@travisn)
Volume attachment locks will be cleaned up appropriately when a volume fails to attach for a pod and then the pod is deleted and recreated (@kokhang)
The dynamic volume provisioner in the Rook Operator no longer encounters a panic when a volume from before v0.6.0 is encountered (@Ulexus)"
"Ceph: Filesystem Pool Size are ignored

The old Filesystem's pool is not getting updated when changed with the new File system.
So, we added two helper functions namely generateDataPoolNames and generateMetaDataPoolName  that will generate the names of the pools and then change those pool's values using the SetPoolSize method.

Signed-off-by: RAJAT SINGH <rajasing@redhat.com>
(cherry picked from commit 013c5bbac37abf9925ee7684e5bfe42c6c234b89)
Ceph: revert mgr to minimal privilege

mgr should only include ""mon allow profile mgr"" instead
of ""mon allow *""

Fixes:
Reverts:
Signed-off-by: Umanga Chapagain <chapagainumanga@gmail.com>
(cherry picked from commit 362a9c78e0d7e30eaaf6098d81ba0fd5bc20bd9b)
ceph: update status on current version of resources

When updating the status on resources sometimes the update fails due to
the resource being an outdated version. This frequently occurs when
the same reconcile loop updates the status multiple times, or the finalizer
is added, or some other update to the resource. Upon the next reconcile
the error would generally go away since the status or finalizer didn't
need to be updated multiple times. But now the error is not expected
since the controller will retrieve the latest version of the resource
immediately before attempting to update it.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 269cfe1199ac6c1b99dae407482aa8eb0d96d74e)
ceph: skip reconcile events where the spec not updated

The controllers should ignore events for status updates. The reconcile
only needs to happen when the spec is updated or the resource is marked
for deletion. Otherwise, the controllers may stay in an update loop as
the reconcile events are triggered again every time there is a status
update during the reconcile.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit ff1ab64d8d00b10455983b22d2fce7e8f3da2b30)
ceph: helm add default value for the `nodeSelector`

Without the default value helm does not have chance
to infer the field type and fails during type check
when custom `nodeSelector` value is specified;

Closes: https://github.com/rook/rook/issues/5236
Signed-off-by: Ivan Kurnosov <zerkms@zerkms.com>
(cherry picked from commit b5e1e9f7e24d8b6101a788d4d84287e6345eac45)
doc: fix link in k8s-pre-reqs page

This fixes a markdwon link on the k8s-pre-reqs doc page.

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit edd272a7f131026f9576e3eb36612dd86191f6da)
Ceph: PV provisioning fails upon upgrade

CSI CephFS provisioner fails to provision a Persistent Volume after upgrading from Rook Ceph Operator 1.1.2 to 1.1.7.
This issue can be fixed by removing givePoolAppTag function whenever there is an appName cephFs.

Signed-off-by: RAJAT SINGH <rajasing@redhat.com>
(cherry picked from commit bb79f7bc2c44f56ef04518e89441db47786c1a22)
ceph: reduce verbose logging for ok-to-stop failures

When a daemon is not safe-to-stop the operator will print the full
stack trace rather than a simple error message that the daemon
cannot be stopped.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 668bca27b1781b4352d78ff873061a4ce37d2f58)
ceph: document example for skipping osd creation

When an OSD has been previously configured with ceph-volume, the
OSD will be skipped on the next installation if the device is not
fully wiped. Added an example to the docs to detect this case.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 4060167852c853c5efc1422c899caff271db2990)
Ceph: Update Helm Chart documentation

Add <unreachableNodeTolerationSeconds> parameter to Helm chart documentation

Signed-off-by: Juan Miguel Olmo Martínez <jolmomar@redhat.com>
(cherry picked from commit 08821f1d6107c440f3e5fea794bd99cffaf05d4c)
build: codegen needs to copy to pkg subfolder

The codegen output is moving the apis and client folders to the root
folder instead of under pkg.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit c2878f693ea0651ede90bf9da9d30cdf7e78baa6)
PSP: Add seccomp annotations

This commit adds seccomp annotations to the PSP shipped with Rook
Operator. In this way the operator when deployed will be more secure and
will only be allowed the syscalls defined the runtime's seccomp profile.

Signed-off-by: Suraj Deshmukh <surajd.service@gmail.com>
(cherry picked from commit 2f6205b2f64bc8ec4b860f78c1ff0ae0c8637eb3)
ceph: Add requireSafeReplicaSize in CephObjectStore CRD

Add requireSafeReplicaSize field in CephObjectStore CRD.

Closes: https://github.com/rook/rook/issues/5260
Signed-off-by: zoetrope <a.ikezoe@gmail.com>
(cherry picked from commit f00092de73c9836899186799fe67d6a6aae2e297)
ceph: add requireSafeReplicaSize to CRD

add requireSafeReplicaSize field to CRD in upgrade-from-v1.2-crds.yaml and ceph_manifets.go

Signed-off-by: zoetrope <a.ikezoe@gmail.com>
(cherry picked from commit babb55cc15ca108fd9bc5453746a62e1f1aa5c1c)
ceph: update defaults to the ceph v14.2.9 release

With the release of ceph v14.2.9 we set the default examples to this version.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 348690ea644808a8acc08ea564f25f425a9a9e25)
ceph: configure mgr modules in parallel of osds

The mgr modules take some time to configure during every reconcile loop.
The OSDs were waiting until the mgr module config was completed. Since
the mgr module config is optional or at least not critical to the rest
of the reconcile we can do it in parallel.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 9634574d5b1b0374ff165723094c9d8db5aa2bd0)
ceph: stop potential secret leak

If cluster info is not fully initialized we could leak some of the ceph
secrets in the operator logs.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 58b7b1e012f083c43d32305ff853c06c470b85c5)
ceph: make admin key optional for external cluster

Currently, we need to configure the Ceph external Admin keyi
in the Rook deployment to be able to connect to an external Ceph cluster.
If we wanted to run in a multi-tenant fashion
were several K8s/Rook clusters wanted to connect to the same external ceph cluster,
each K8s deployment would have the access to the External Ceph Admin key
and could potentially access or delete the Data
from pools that belong to other k8s/Rook Clusters.

Now the admin key is optional but the helper script create-external-cluster-resources.sh
will help create the necessary keys/users to connect to that cluster.

Closes: https://github.com/rook/rook/issues/4917 and https://github.com/rook/rook/pull/5227
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 7c994441c3a96e8071ee4fc8703b2e0a6c1d6844)
ceph: allow toolbox script to skip watching mons

The toolbox script is used for configuring the toolbox. If the
mons are to fail over while the toolbox is running, the new
list of mons needs to be updated. However, if run temporarily
as a one-time job, the script only needs to initialize the
ceph.conf and then exit.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit c024f01d9a7f74aa5b561a1b0925e5c443c48bdc)
docs: fix secret env keys on ObjectBucketClaim

The documentation on the Ceph ObjectBucketClaim CRD
erroneously states that the generated Secret resource
contains keys `ACCESS_KEY_ID`, `SECRET_ACCESS_KEY`.

According to ceph-object.md, and when mounting the secret
into a container via secretRef, or inspecting it with kubectl,
the variables have an `AWS_` prefix.
Like so: `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`.

This commit adds the `AWS_` prefix to both keys.

Signed-off-by: Richard Patel <me@terorie.dev>
(cherry picked from commit 66feafa9a5e85b6feeacf22815e4fa3f4e6289f3)
ceph: lookup of the cluster cannot rely on namespace name

The name of a CephCluster is commonly the same as the namespace,
but not always. When looking up the ceph cluster we can look for
the first one in the namespace rather than requiring the name
to be the same as the namespace.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 8d72e788c1ac844388f74e9d914cadccf50edeeb)
CSI: update cephcsi to v2.1.0

cephcsi v2.1.0 is released and doesnot need any deployment
template changes. This PR updates the cephcsi image
version to v2.1.0

Signed-off-by: Madhu Rajanna <madhupr007@gmail.com>
(cherry picked from commit 5684c4cc373ead1abe159a7bf38e46ab158b1d66)
ceph: restore the cluster-test.yaml example

The cluster-test.yaml example is useful for small test clusters
where only one mon is required and certain settings can be disabled
when not running in production.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 9d01f92d2cc487481b369f07589774f7676f452e)
ceph: update helm chart manifests

Currently, helm chart is little outdated and has differences with
example/common.yaml.
This commit modifies both manifests to use same resources.

Signed-off-by: binoue <banji-inoue@cybozu.co.jp>
(cherry picked from commit 18cde4596c3cf37b5250a97fc57eec35dd5803c8)
ceph: metadatadevice to not be added to osd data device list

When the metadataDevice is specified, it was a regression that it was
being interpreted also as a data device. ceph-volume was failing
when the metadataDevice was added as both a data and metadata device.
So we ensure it is not added to the list of data devices.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 99dc363ab6e0b9386a5a33726fe68a482683f0fc)
release: set the manifest versions to v1.3.2

With the latest patch release we set the manifest version to v1.3.2

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.3.2 is a patch release limited in scope and focusing on bug fixes.
Ceph
MetadataDevice was failing the OSD creation (, @travisn)
Helm chart updates to be in sync with yaml manifests (, @binoue)
Update Ceph CSI driver to v2.1.0 (, @Madhu-1)
Restore the cluster-test.yaml example (, @travisn)
Properly reconcile CephCluster if named differently from namespace (, @travisn)
Enable running a toolbox job with the toolbox script (, @travisn)
Remove need for admin key for external cluster configuration (, @leseb)
Configure mgr modules in parallel of OSD reconcile (, @travisn)
Set default manifests to configure Ceph v14.2.9 (, @travisn)
Add requireSafeReplicaSize in CephObjectStore CRD (, @zoetrope)
Add seccomp annotations to the PSP (, @surajssd)
Revert mgr keyring to minimal privilege (, @umangachapagain)
Codegen needs to copy to pkg subfolder (, @travisn)
CephFS provisioner fails to provision a Persistent Volume after upgrading (, @rajatsingh25aug)
Add default value for the nodeSelector in the helm chart (, @zerkms)
Skip reconcile events where the spec is not updated (, @travisn)
Add support for updating filesystem pool replicated size (, @rajatsingh25aug)
Docs: Troubleshooting an OSD that can't be created on a previously configured device (, @travisn)
Docs: Fix secret env keys on ObjectBucketClaim (, @terorie)"
"nfs: do not restrict search domain to localhost

Adding the search domain localhost causes lookup failures.

Many DNS servers have a wildcard entry *.localhost which returns
127.0.0.1. Adding a ""search localhost"" to resolv.conf appends a
"".localhost"" for every host lookup for which the DNS server returns
127.0.0.1 which causes failures further down the execution path.

example: with localhost in the search domains
 # ping google.com
PING google.com.localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.071 ms

Closes: https://github.com/rook/rook/issues/11870
Signed-off-by: Sachin Prabhu <sprabhu@redhat.com>
(cherry picked from commit 08d83a33cde7f8788920edb00464e15e3d6b396a)
nfs: set nsswitch.conf to lookup local files

When using sssd, the /etc/nsswitch.conf should also include local files
for lookups. This is required when looking up uid 0 and the root user
which are not handled by ldap or other sources.

Closes: https://github.com/rook/rook/issues/11925
Signed-off-by: Sachin Prabhu <sprabhu@redhat.com>
(cherry picked from commit d3636aaf3e65781d9d6008f001abe8a542430579)
docs: mention about reconciliation issue in hpa docs

During reconciliation of cephobjectstore, Rook operator resets the value
of replica count by the HPA and HPA brings back it up when it notices
the desired count for replica change.

Signed-off-by: Jiffin Tony Thottan <jthottan@redhat.com>
(cherry picked from commit 823c06da44749732c1ae1fe940a2969c1430a165)
core: disable exporter service

Create the exporter service only if exporter pods are created.
Signed-off-by: avanthakkar <avanjohn@gmail.com>
(cherry picked from commit 32b2445ee4f7e4dddb589f522ee301670b7d88d4)
helm: add an ingress for ceph-objectores

Signed-off-by: Cyril Jouve <jv.cyril@gmail.com>
(cherry picked from commit 100f8c1320693b24329cd948c2f99d2a8370c548)
core: skip OBC and Notification controllers

Skip running Object Bucket and Object bucket notification
controllers based on env variable.

Signed-off-by: sp98 <sapillai@redhat.com>
(cherry picked from commit e87338fbc48ca564929feb5dc3097fdaf8f69e34)
external: check for pool and cluster name is provided

While adding the support for dot and special rbd pools
the check for pool and cluster name check was removed,
Adding it back as it is needed
https://github.com/rook/rook/pull/12056

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit e02942ab779f5307c2e1b675289f16900341302b)
docs: clarify docs for wording or obsolete info

Update the getting started guide, prereqs, architecture,
and other basic docs with more concise wording and removed
some obsolete information. Some links are removed so they
don't distract the user from reading the critical information
that we are conveying in the rook docs.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit ecdeb7aa9f39299c8389ed41d2a238c59cc01b31)
ci: disable multi-cluster-mirroring

till we didn't resolve the multi-cluster-mirroring ci issue
lets keep it disable

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 423ad93fc080fdf355e446fc918cf357b354342a)
mgr: fix ceph dashboard login issue

Dashboard ac-user-create cmd was taking more time
then the usual ceph command to run,
So increased the timeout to run the cmd, and
now dashboard admin user is sucessfully created

Closes: https://github.com/rook/rook/issues/12113
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit ed61d25fc3800005dc714475523fa42b660d25fe)
test: add multus validation test routine to rook binary

Add a more involved multus validation test to the Rook binary. Because
this is intended to be end-user runnable, make sure operator-only
commands are hidden.

Build this into the rook binary instead of creating a separate binary
for ease, and because any binary built with the kube api becomes 40+
megabytes. We save quite a bit of space by including this in the Rook
binary, which is good for keeping container layers as small as possible.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 0f6e7ee921e98776c31b4b0912e69f093caeccfc)
core: update k8s module to lastet version

updating k8s dependencies like clien-go and
others to v0.26.4

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit ad068d966a9e63f8e1c8724bb8106c5683ef3aef)
nfs: pare down config file volume sources

Pare down the available volume sources for NFS config files so that the
CRD isn't unnecessarily huge. This allows us to recommend
`kubectl apply` again in the upgrade doc.

Size of the NFS CRD is reduced by approximately 60%.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 6500c11d57707f740808021ad83bb542ad2d3fe4)
build: update patch version to v1.11.5

For the patch release the docs and examples are updated to
v1.11.5

Signed-off-by: travisn <tnielsen@redhat.com>","Improvements
Rook v1.11.5 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
mgr: Retry creating ceph dashboard credentials (, @parth-gr)
nfs: Reduce size CephNFS CRD from unnecessary file volume sources (, @BlaineEXE)
core: Update k8s API references to more recent version (, @subhamkrai)
test: Add multus validation test routine to rook binary (, @BlaineEXE)
external: check that the pool and cluster name is provided (, @parth-gr)
core: Skip OBC controllers if not needed based (, @sp98)
Add an ingress for Ceph object stores (, @jouve)
core: Disable the exporter service (, @avanthakkar)
nfs: Fixes for mounting CephNFS using Kerberos auth (, @spuiuk)"
"core: use ROOK_CEPH_MON_HOST from config store in OSD pods too

Signed-off-by: avanthakkar <avanjohn@gmail.com>

Volume ""ceph-daemons-sock-dir"" is coming empty in case if dataDirHostPath,
which is the case for osd onPVC. Fix the volume creation by using the
ceph cluster spec dataDirHostPath, which allows to run socket commands
on osd containers.

(cherry picked from commit 541d091f9c71f17c59ff3c9a998ff3016c7ec7b2)
docs: update external cluster docs

1) removed the supported version column

2) updated the doc with support for v2 port an helm installation

3) Add support for rgw objectuser creation

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 56cd431377857a4e3f741cec9bc63c60c45485ad)
mgr: removing unnecessary rook-ceph-mgr rbac entries

These rbac changes were introduced as part of PR to enable
sidecar accessing mgr pods but in fact they are not necessary
as rook-ceph-mgr role had already the ability to update pods

Closes: https://github.com/rook/rook/issues/12336

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit 08754f61976c9e20856b195032861ba6ec621cf8)
core: typo in logs to print fullname of CephCluster

printing namespace along with name would make debugging easier

Signed-off-by: Tarun Gupta Akirala <takirala@users.noreply.github.com>
(cherry picked from commit df0ce26923fa3f126de048564d67f90f50566071)
docs: prevent to delete other clusters data on cluster deletion

Current cluster teardown document assumes that there is only one
Rook/Ceph cluster. If not, the instruction written in this document
might delete the data of other clusters.

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 20b7a30ca66cc95a001318ac00a8d806a187c1d1)
docs: update the integration test guide

The integration test guide is updated to be more accurate
and provide more hints that the CI is the recommended
place to troubleshoot the integration tests

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit fa5b758f9edeef0b7d62bb760b7b40ab194fcc84)
nfs: set correct kerberos domain in /etc/idmapd.conf

We add a new field domainName to the Kerberos section. The field is used
to setup /etc/idmapd.conf with the domain name. This allows idmapper to
map to kerberos credential to the correct uid/gid.

We add Spec.Security.Kerberos.DomainName to the CRD

Signed-off-by: Sachin Prabhu <sprabhu@redhat.com>
(cherry picked from commit 8705f2b37e617e81d4245b1eed647ef6e0a16c6f)
pool: add .mgr pool to the stretch cluster examples

The stretch clusters must create pools with a pool spec
that is valid for the stretch scenario, with 4 replicas
and failure domain and sub failure domain as needed
to match the topology. Otherwise, ceph will create a
default .mgr pool which will have replica 3 which is
invalid for the stretch scenario.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 11d83bfbec493a653dafd5789d9ee8139fb4e5e7)
helm: add EC Block Pool config in helm chart

allow for EC Block Pool configurations to be defined in the rook-ceph-cluster Helm chart

Signed-off-by: Javier <sjavierlopez@gmail.com>
(cherry picked from commit f6816abc977539446e33ed6387203e84c1d98955)
docs: improve external doc format

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 9a92756830e7521d9b343bad276b97c30b5cfc3f)
docs: suggest qeumu driver for minikube on apple silicon

Apple silicon does not support hyperkit, and virtualbox does not support
Apple silicon (yet). Suggest the QEMU driver for development on MacOS
with Apple silicon.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit a57d972aa187d0ac76e1a87d40da4a9be81c127b)
docs: remove the line generated by gen-crd-api-reference-docs

removing the line added by gen-crd-api-reference-docs to avoid commit
specification.md with only the reference to the git commit

Signed-off-by: Javier <sjavierlopez@gmail.com>
(cherry picked from commit 9b3e5b10e774056cdd64811b56f515b2bffca2ea)
build: update release version to v1.11.8

For the patch release update the docs and example manifests
to v1.11.8

Signed-off-by: travisn <tnielsen@redhat.com>","Improvements
Rook v1.11.8 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
helm: add EC Block Pool config in helm chart (, @Javlopez)
pool: Add .mgr pool to the stretch cluster examples (, @travisn)
nfs: Add Spec.Security.Kerberos.DomainName to the CRD to configure /etc/idmapd.conf (, @spuiuk)
mgr: Removing unnecessary rook-ceph-mgr rbac entries (, @rkachach)
core: typo in logs to print fullname of CephCluster (, @takirala)
core: empty ceph-daemons-sock-dir for osd onPVC (, @avanthakkar)
docs: prevent to delete other clusters data on cluster deletion (, @satoru-takeuchi)
docs: improve external doc format (, @parth-gr)
docs: Suggest qemu driver for minikube on apple silicon (, @BlaineEXE)"
"external: create ceph cluster namespace

We need to create the namespace with the import script,
As per the documentation

The import script creates the secrets and
cm which is later used by the operator for cluster creation.

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit f9f880e52852d88a8d25819ba99c3a41c443965c)
docs: update the external doc format

Cephobjectstore is not formated correctly
https://rook.io/docs/rook/v1.12/CRDs/Cluster/external-cluster/#connect-to-an-external-object-store

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 8a445ef0cb784c415df777967c0710ebe851d28d)
ci: add detached mode in tmate

with detached mode, we don't need to wait for the
tests to complete. Now, we can get inside tmate before
the tests start and we can monitor the tests.

By default, this mode will wait at the end of the job for
a user to connect and then to terminate the tmate session.
If no user has connected within 10 minutes after the post-job step started,
it will terminate the tmate session and quit gracefully.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit f171e1c037626c58590fba1aae1d06ff2385fd8c)
build(deps): bump wagoid/commitlint-github-action from 5.4.1 to 5.4.3

Bumps [wagoid/commitlint-github-action](https://github.com/wagoid/commitlint-github-action) from 5.4.1 to 5.4.3.
- [Changelog](https://github.com/wagoid/commitlint-github-action/blob/master/CHANGELOG.md)
- [Commits](https://github.com/wagoid/commitlint-github-action/compare/v5.4.1...v5.4.3)

---
updated-dependencies:
- dependency-name: wagoid/commitlint-github-action
  dependency-type: direct:production
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
(cherry picked from commit d5f5f0b64ec8118a3a20038d894043894f5898eb)
object: update ceph cosi driver image to v0.1.1

Update the ceph cosi driver image to v0.1.1, so that it can
work on both amd and arm platforms.

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 1bf33f125e156f4c81967a88e70aabb389c63591)
core: force delete rook-ceph-exporter pod

Force delete rook-ceph-exporter pod that is stuck in terminating
state due to unavailability of node.

Signed-off-by: sp98 <sapillai@redhat.com>
(cherry picked from commit dd90ef5db24bdea0654ebf04fbf6044ab070fd78)
osd: configure backend store

Configure osd backend store from the cephCluster spec

Signed-off-by: sp98 <sapillai@redhat.com>
(cherry picked from commit c13d34f8d3d42eb4b9c474f0062dd6f7106c8c92)
object: do not add objectstore endpoint to zone when sync is disabled

Gateways that do not run the sync threads should not be accessible from one of
the Zone endpoint. If this is the case, the synchronization might stop working.

When the CephObjectStore has the option
`spec.gateway.disableMultisiteSyncTraffic` set to `true`, we must ensure that
the objectstore endpoint is not present in the Zone endpoint.

Signed-off-by: Lucas Henry <polyedre@disroot.org>
(cherry picked from commit 564afef4c7b1d8b6840a63917f42c69d68cc1cd9)
build: cosi driver is missing from olm list

adding cosi driver list in olm list as it is
being missed in csv crd list generated by
other project.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 884a5c1c1813dd8e4e15a13b187f76f4b9cc7387)
test: collect kube-system logs for debugging

added kube-system namespace also to collect
logs from to debug the smoke suite issue

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 0ed91458dc39f0a294fdc5a4e6d631e4b81192f9)
test: fix upgrade suite for 1.27.x version

the upgrade suite for version 1.27.x is failing
due
```
debug 2023-07-24T19:11:20.264+0000 7f3395a82c80 -1 error: monitor data filesystem reached concerning levels of available storage space (available: 5% 4.4 GiB)
you may adjust 'mon data avail crit' to a lower value to make this go away (default: 5%)
```
so adding mon setting to start on `compact` also adding
other setting present in cluster-test.yaml.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit e8e8a4673ad364313a424100bf3149c59a809e39)
core: node fencing, skip pv when pv is not backed by csi

when node fencing is triggered and a negative case where
one deployment pod consuming pv not provisioned by csi
and another deployment pod with rbd rwo are on the same
node and node fencing is triggered.

In this case rook operator panics since it is trigger to get
field `pv.Spec.CSI.Driver` which will be nil.

Also, skip static pv as there is no `imageName` in the spec
rbd status command will fail.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 72386eb1d06cd7cf567ff020ac98af5c476efc4d)
nfs: mount krb5.conf and krb5.keytab in the sssd container

This will enable us to use GSSAPI in sssd for authentication when
connecting to the remote LDAP server.

Signed-off-by: Sachin Prabhu <sprabhu@redhat.com>
(cherry picked from commit 0a151e913d465c743aebd2bc35d01b7b7486ccfb)
nfs: fix null pointer deref in generateSssdSidecarResources()

0a151e913 results in a bug which causes null pointer dereference when
Kerberos is not setup. This causes a failure in Unit test
TestReconcileCephNFS_addSecurityConfigsToPod

Signed-off-by: Sachin Prabhu <sprabhu@redhat.com>
(cherry picked from commit 6cf4627ccd05ca90393c5e93bba8d91694fd6f11)
multus: revise kube config/client loading

The previous client loader routine assumed KUBECONFIG would be set in
CLI environments. Instead, now take this approach:

1. If KUBECONFIG is set, that is the de-facto override that informs the
   tool it is being run in a CLI environment.
2. Otherwise, try creating a client from the default kube config file.
3. If that fails, assume the tool is running in a Kubernetes Pod.

This will continue supporting dev/test environments so that building the
rook container is not necessary for development. It also allows support
for highly opinionated environments (like deployed by OpenShift CSVs)
where it's not possible to install the Rook operator without also
deploying a CephCluster.

Signed-off-by: Blaine Gardner <blaine.gardner@ibm.com>
(cherry picked from commit cc9514ad6ca417e20c2d7b9575ce8a8ca11f3ff8)
osd: use cp -a command for copying init-containers

remove copy-binaries cmd and related code

Signed-off-by: Sheetal Pamecha <spamecha@redhat.com>
(cherry picked from commit d86fa2abbc79c1ba0546d59c386f71602eef3679)
external: added an optional flag for enabling v2 mon port

Added a new flag `--v2-port-enable` to enable the v2 mon port.

Signed-off-by: Nikhil-Ladha <nikhilladha1999@gmail.com>
(cherry picked from commit 5daddbe379c4eb67b1c9637606aa2e696a8c8b90)
external: set RequireMsgr2 if v2 port is configured

Currently if we use the msgr2 port,
cs-cluster-config-json looks like
""monitors"":[""192.59.109.11:3300"",""192.59.109.13:6789"",""192.59.109.12:6789""]

The first monitor is passed by python script and rest are
Discovered by rook operator, so if the first mon is using the v2 port
lets update the other mons also by setting up the RequireMsgr2 flag

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 2c4897f88c41acace9465e54ff8251c044b43e27)
ci: allow commit prefixes for doc and tests

Allow for doc(s) and test(s) commit prefixes to be either
singular or plural. This is always a confusing point when
adding the commit prefix, so let's just allow both.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 3d7924dc2262d20320597b64078eee78ca68b010)
tests: toolbox uses same ceph image as the test

The test is currently only using the ceph version that is
included with toolbox.yaml, which may be different
from the version of the ceph cluster being tested.
Now the version will be replaced to match the desired
ceph test version.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 600068ea21447b0345c9a2033a21f82a799b8d65)
tests: multi cluster suite toolbox version

The toolbox image tag was always being set from
even when the image was not set in the test. If the image
is not set, skip replacing the image name to use the default
test version.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit c17724b536eaabb19be8d086eca9448ee29905fd)
docs: add note in upgrade guide about cephfs driver's breaking change

CephCSI CephFS introduced a breaking change in v3.9.0.
This commit adds a note in upgrade guide regarding the same.

refer: https://github.com/ceph/ceph-csi/blob/v3.9.0/docs/ \
       ceph-csi-upgrade.md/#upgrading-cephfs

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit a2113684e46c463f7f991ef97f570cc93ce44a78)
ci: run object suite in master and release branches

The object suite was being skipped in master and release
branches. Since the object suite was only running in PRs
it was not noticed if there were any issues in the master
branch or release branches. Now we run it in these branches
in addition to the PRs.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 8fd46a46d3a1be8d032acf02591779476c58fd3d)
build: update release version to v1.12.1

For the patch release update the examples and docs

Signed-off-by: travisn <tnielsen@redhat.com>","Improvements
Rook v1.12.1 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
docs: Add note in upgrade guide about cephfs driver's breaking change (, @Rakshith-R)
osd: Use cp -a command for copying init-containers binary (, @Sheetalpamecha)
external: added an optional flag for enabling v2 mon port (, @Nikhil-Ladha)
external: set RequireMsgr2 if v2 port is configured (, @parth-gr)
multus: Revise kube config/client loading (, @BlaineEXE)
nfs: Fix null pointer deref in generateSssdSidecarResources() (, @spuiuk)
external: Create cluster namespace for the external cluster (, @parth-gr)
object: Update ceph COSI driver image to v0.1.1 (, @thotz)
object: Do not add objectstore endpoint to zone when sync is disabled (, @polyedre)
nfs: mount krb5.conf and krb5.keytab in the sssd container (, @spuiuk)
core: Force delete rook-ceph-exporter pod on a down node (, @sp98)
rbd: Skip PV during node fencing when PV is not backed by Ceph-CSI (, @subhamkrai)
build: COSI driver is missing from OLM list (, @subhamkrai)
ci: add detached mode in tmate (, @subhamkrai)"
"ci: update mon_data_avail_warn percentage

I see the mon_data_avail_warn is set to 500M
but acording to ceph doc this should be in percentage
And by default this percentage is 30%,
So re assigned to 10% for the CI

Closes: https://github.com/rook/rook/issues/11130
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit d392129cdde8a17e02b7d48b6bf88bebd90a4e9f)
docs: document expectations for releases

The release schedule and maintenance approach has been
left as undefined until now to give flexibility to the
maintainers to release as needed. The community is
asking for clarity around the planned release schedule
so it is time to document the procedures.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit fc035c7a5bf1871aaf6d2fba3a49f22705f02d29)
docs: add point about physical disks visualization in dashboard

New point to explain when is available this information in the Ceph dashboard

Signed-off-by: Juan Miguel Olmo Martínez <jolmomar@redhat.com>
(cherry picked from commit 1ee481cf432547bd2819ae1f96c0ba3b50ea9ce0)
operator: don't remove existing pools for mgr/prometheus/rbd_stats_pools

Rook currently knows rbd pools only if they defined through CephBlockPool, so it overrides the config
mgr/prometheus/rbd_stats_pools which may have already been set for pools external to Rook. Check config
before running set command and if there some existing pools append them to enableStatsForCephBlockPools.

Signed-off-by: Avan Thakkar <athakkar@redhat.com>
(cherry picked from commit e8b74207dd051829f18b7924412b1d449cd71fb5)
core: increase liveness probe timeout to 5s

stability issues have been observed with 1s.
socket latency is expected whenever CPUs are
under minor pressure. Increasing value to
5s should cover most small-medium scale envs.

Resolves BZ: 2126566

Signed-off-by: Randy J. Martinez <randy@cephtips.com>
(cherry picked from commit ac9df66b761bd76bfe54f385805a5c6736511bd6)
osd: osdSafeToDestroy check should be after osd out

currently, osdSafeToDestroy check is done before
marking osd out which prevents ceph from rebalancing.
With this changes, we are moving check for
osdSafeToDestroy after osd is marked out.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 77f9e0d5b69c4a3880f82c905d8377e49e918f05)
csi: add setmetadata and clustername flag to omap

The omap generator sidecar is the one who
sets the pvc name and clustername in the metadata
if the pv is re-attached to a new pvc or if the
clustername changes, for that reason we need to
set these flags on the omap generator sidecar
also.

Signed-off-by: Madhu Rajanna <madhupr007@gmail.com>
(cherry picked from commit ffdfeb5becb1181ab6c6401d117fa0ef478d2dbd)
external: fix endpoint_dial check for rgw endpoint

the validate rgw endpoint tls cert returns the certificate instead
of returning whether it exist or not,
So updatd the flow how to use it

Closes: https://github.com/rook/rook/issues/11060
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit fb7b67c3f421a5d8427b859b660adf5970867ef3)
core: enabling logCollector by default for coredump

enabling logCollector by default will enable the coredump
generation in case a process terminates with a segmentation fault.

Signed-off-by: gauravsitlani <gauravsitlani@riseup.net>
(cherry picked from commit cc02399c4cbcaf086eddf4025f1646711fc49600)
operator: remove obsolete flex driver properties

The flex driver was deprecated and fully purged long ago,
and now finally we are purging the related properties
from the operator deployment that are no longer applied
anywhere.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 67582fe0da10f0be15fc6513c507502400d6fccc)
csi: update csi to latest release

This updates the cephcsi to latest 3.7.2
release and also updates sidecar to the latest
release in some missing files.

Note:- sidecar images are upto date in most of
the places, in some places it was missing, This
PR updates it in missing place.

Signed-off-by: Madhu Rajanna <madhupr007@gmail.com>
(cherry picked from commit 729f2a8b324c1c0294f2bce0307d2687240244f5)
docs: updated note syntax in markdown files

The Note label is updated in several places in the docs for improved rendering.
Multiple markdown files have been updated.

Closes:

Signed-off-by: Yashasvi Chaurasia <yashasvi12977@gmail.com>
(cherry picked from commit 05e7ddc4cbbbcf0254ea2c42261e15c37bcf2f27)
docs: use krew restore-quorum command for disaster scenario

The new krew plugin command restore-quorum will automate the process
to restore quorum from a single healthy mon. No longer do we need
the absolutely tedious, messy, manual steps from the rook docs.
The krew plugin will take care of all the complexity automatically
as of the v0.4.0 release

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 3e60b95fd6c658868176d834c2ae3b52894e2d2c)
object: fix logic for rgw period commit detection

The `periodWillChange()` implementation to detect map keys to ignore.
Previously, we relied on the `GoString()` method to output the same
format always to determine the current path to the
map[string]interface{} node, but that may change depending on the underlying
implementation of go-cmp.

Instead, parse the go-cmp `Path` step by step and construct a JSON path
to the node in a stable format.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 53208307819fb3af10f71fe5c861109a51076a3f)
build: update the go modules to the latest

The security scan is failing due to a go dependency
so we update the go modules and all dependencies to
the latest available.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit ba6adc60e1ab9304403606193124d9cd5e07b47e)
build: update release version to v1.10.4

For the patch release update the examples and docs to
v1.10.4

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.10.4 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
build: Update the go modules to the latest versions (, @travisn)
core: Enabling logCollector by default for coredump collection (, @gauravsitlani)
docs: Use Krew restore-quorum command for mon quorum disaster scenario (, @travisn)
csi: Update Ceph-CSI to v3.7.2 (, @Madhu-1)
operator: Remove obsolete flex driver properties (, @travisn)
csi: Add setmetadata and clustername flag to omap (, @Madhu-1)
external: Fix endpoint_dial check for rgw endpoint (, @parth-gr)
osd: During OSD purge mark the osd out before other checks (, @subhamkrai)
core: Increase liveness probe timeout to 5s (, @randymtz)
operator: Don't remove existing pools for mgr/prometheus/rbd_stats_pools (, @avanthakkar)
docs: Add point about physical disks visualization in dashboard (, @jmolmo)
docs: Document expectations for releases (, @travisn)
ci: Set mon_data_avail_warn percentage in test cluster to 10% (, @parth-gr)
object: Fix logic for rgw period commit detection (, @BlaineEXE)
ci: Enable more NFS tests in the CI (, @Rakshith-R)"
"osd: add kmip encryption support

The cluster-wide encryption feature now
supports KMIP (Key Management Interoperability Protocol)
kms.
KMIP is an extensible communication protocol that defines
message formats for the manipulation of cryptographic keys
on a key management server.

For more information, refer:
https://en.wikipedia.org/wiki/Key_Management_Interoperability_Protocol

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit f21c12234d88a0b438d725228e73319ed084dc9d)
docs: add doc for kmip encryption support

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 0ba2ab120687d015e4930ce915add00961446ad8)
docs: clarify storage prereqs in quickstart guide

The quickstart guide prerequisites have diverged from the storage
requirements on the prereqs doc page, now they are in sync again.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit d5f100def1b2576785dbae6d1a6d1b59245838d5)
csi: add topology provisioning support

This commit adds topology provisioning
support. This makes modification to rbac,
csi deployment and daemonset.

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 3c5a2f41426790d5e356c9e27798dcc46f3648fc)
rgw: delete zone/pools for multisite configuation

Allow option to delete the zone/pools created by ceph object zone CR.

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit c98628eb0fffdbd5d82b0b161bb25ac6673e88c5)
external: do not add info=read cap if ceph version doesn't support it

The rgw ip validation feature was needing to update the rgw user
cap to add info=read permission, but this permission is only backported
till ceph pacific, so we added a check that only add this cap
when ceph version support it,
But this cap was also adding with the other caps, so removed it from there
Now it will only add this cap if ceph version support it

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 54425803b6cb6fa1e0896cc1e81850631b02e15b)
ci: add debug flag to identify any failing yaml origin

Signed-off-by: Deepika Upadhyay <deepika@koor.tech>
(cherry picked from commit ccbff1be9507080640af673b848eeade453193e1)
pool: initialize only rbd application pools

`rbd pool init` cmd initializes pool for rbd images.
This commit makes modification to init only
rbd application pools, since it is not required
by other pools like "".nfs"","".mgr"" & ""mgr_devicehealth"".

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit c02f3194d14c26142c50dc6ed81aa438386fdff8)
build: update goceph module to v0.17

Updating go-ceph module into latest version v0.17

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit d3d760e90152011d3648918019728ed245e5a708)
monitoring: fix pool growth warning grouping

Predict linear will continue to predict on exporter data from old pods.
We can take the max value for every hour in the 2 day window before we
linearly predict to get the most conservative estimate. This will only
affect the hour in which a new mgr pod is started.

Fixes

Signed-off-by: Jamison Lofthouse <jamison.lofthouse@gmail.com>
(cherry picked from commit f553034351b81f6e2e83d7b61f24ff21c12a5d4e)
ci: disallow to create encrypted osd on lv

Rook doesn't support encrypted OSD on LV. Without disallowing
this configuration, ceph-volume results in failure.

Closes: https://github.com/rook/rook/issues/10782

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 7969450589c37ad5e23cc4ae848b6e8ae6fa8afb)
ci: disallow to create osd on lv with metadata by accident

OSD on LV with metadata device is not supported. So we once we made
a fix to disallow this configuration. However, it's insuffucient
because we forgot to reset `matched` flag.

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 39cc6059f19c36761b8c0465a2b167d69a4c8b6e)
build: stop printing verbose rbac generation details

The rbac generation prints a lot of info that is not necessary
unless troubleshooting the rbac build, so we can comment it
out by default.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 839920ff804e86df1c602da14d5fba267babafbd)
nfs: add kerberos client security support

Add support for enabling kerberos for client authentication.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 005000212ced0dfbab1f34eaaacd79353cf93511)

# Conflicts:
#	design/ceph/ceph-nfs-ganesha.md
osd: disallow to create encrypted osd on partition

Rook doesn't support encrypted osd on partition. So we should
skip partitions as candidates of the new encrypted osds.

Closes: https://github.com/rook/rook/issues/10911

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 591fc5f68b8c597a17f7e765f298554bc2cc173f)
ci: update arm host to pick up correct self-hosted machine

The self-hosted arm64 machine has a new label ubuntu-20.04-arm64 to
avoid the conflict with other ubuntu-20.04 labels from
general github actions. We only want the daily arm job
to use the self-hosted runner.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 55c72a3674f15340d58c0f02757af3118850ebf4)
external: fix import errors for python2

remove duplicate import urllib.parse which is handled below
with try and except no need to import separately. Also, change
the way to get the python version.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 9a952df419f8d9273e695bff3557986f82e6e166)
docs: add upgrade steps for multi-tenant custer

Currently for external clustr multitenancy is only applicable for new
deployments, but adding doc change so multi-tenancy can be achieved for
upgraded cluster also

Closes: https://github.com/rook/rook/issues/10678
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 0ad1b52005abd2f83685a9503c39d318546556f9)
docs: add logical volume to storage options

Rook supports osd on logical volume in host-based clusters. Let's add it
to the list of valid device types.

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit b52e6a0da8b7deeca0af346d348b8a68b30c6c79)
core: use assimilate-conf command to run commands

this commit uses the ceph feature assimilate-conf to set
multiple configurations for ceph global/pods at one file and
use that in command to set the required configuration in one
line command.
for example:
`ceph config assimilate-conf -i <input file> -o <output file>`

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit cfc5f19f927c534c787bb94ed0174dedb4d8e360)
ci: add mon_data_avail_warn to canary ci test

ceph cluster on ci mostly have health error
mon disk low on size,
so overriding the min aval capacity to 0 from 30% default so this
error can be removed

Closes: rook

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit df8493d77b0f6510faa1a58fce2af9f611a888b0)
build: fix intermittent gen-rbac failure

The crds generation for the helm crds is intermittently hitting a build
error due to multiple builds generating the crds at the same time.
We avoid this race condition by first writing the crds to a temp file
then move the file to the helm crd resources file.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 7863d3161c80e96f0370f0908f2ca657394078b9)
csi: customize plugin volumes and volumemounts

This option open-up volumes and volumemounts
for user customization of the rbd,cephfs,nfs
plugin daemonset.

Signed-off-by: Madhu Rajanna <madhupr007@gmail.com>
(cherry picked from commit 80a96f8f32f383f6d757888419a0d6ee79bf5975)
operator: silence 'cm is handled by another watcher' DEBUG messages

I guesstimate that around 50% of the operator log volume when set to log
level `DEBUG` are messages about cm's which aren't relevant to rook.

E.g.:

```
2022-09-16 23:03:05.430839 D | ceph-cluster-controller: hot-plug cm watcher: only reconcile on hot plug cm changes, this ""ingress-controller-leader"" cm is handled by another watcher
2022-09-16 23:03:05.643255 D | ceph-cluster-controller: hot-plug cm watcher: only reconcile on hot plug cm changes, this ""fleet-agent-lock"" cm is handled by another watcher
2022-09-16 23:03:05.799526 D | ceph-cluster-controller: hot-plug cm watcher: only reconcile on hot plug cm changes, this ""cattle-controllers"" cm is handled by another watcher
```

Yes, it is `DEBUG` and noise is expected. However, there is no message
about checking the status of the cm's rook actually needs to watch and
these messages don't seem very useful. I have been resorting to piping
the operators logs through `| grep -v 'hot-plug cm watcher'` to cut down
the noise.

Signed-off-by: Joshua Hoblitt <josh@hoblitt.com>
(cherry picked from commit 0763f91f93c6bff7f515517b0b9acf486eec0a1e)
docs: clarify Object Pool CRD is same as Block Pool CRD

Signed-off-by: Sheetal Pamecha <spamecha@redhat.com>
(cherry picked from commit 4dd8ee95204fa501a68e7296c8d42e5c5c36d011)
docs: fix indentation in CephCluster on PVC example yaml

Copy pasting current code block results in an YAML parsing error and
this change fixing that error by adding a space where its needed

Signed-off-by: Tarun Gupta Akirala <takirala@users.noreply.github.com>
(cherry picked from commit b068cba3dde232cc55462680a5e97c8a4d36bef1)
csi: make sure we reset CSIParam booleans to default

On removing or setting params to false in operator config map, make sure
to set CSIParam to their appropriate defaults, since we are not restarting the
operator we cannot just assume these params/variables/flags are defaulted,
everytime we need to makesure some defaults are specified.

This is what happens without these changes:
* Set CSI_ENABLE_METADATA to true, this will tune CSIParam.CSIEnableMetadata
  to true from false
* Create a PVC and check the metadata is added to the rbd/cephfs volumes
* Now Set CSI_ENABLE_METADATA to false, we assume CSIParam.CSIEnableMetadata
  will be set to false, but that is not happening because the earlier value
  of `CSIParam.CSIEnableMetadata = true` still persist.
  (we are not restarting operator to assume value of CSIParam.CSIEnableMetadata
   to be reset to false)

This happens with CSI_ENABLE_OMAP_GENERATOR and many other flags too,
fixing them all with these changes.

Thanks to Madhu for debugging the issue and testing it along.

Credit: Madhu Rajanna <madhupr007@gmail.com>
Signed-off-by: Prasanna Kumar Kalever <prasanna.kalever@redhat.com>
(cherry picked from commit bf3a3aa92ebe44ca6328a9735c495e434f198608)
nfs: fix nfs if multus is enabled

Closes: https://github.com/rook/rook/issues/10812
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit ddea97ebde633fe13c53be5d2e5faf8cb98b86e9)
core: update loadclusterInfo with multus check

if Multus is enabled the clusterinfo should be updated with
network as multus as to run the ceph cmds in remote
executor

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 26584fc6e5a7e01bfaa24e7bc3a5c9913f400a44)
ci: move to ubuntu 2004 completely

github-hosted runner ubuntu-18.04 will be removed by Dec. 1st, 2022.

https://github.blog/changelog/2022-08-09-github-actions-the-ubuntu-18-04-actions-runner-image-is-being-deprecated-and-will-be-removed-by-12-1-22/

So, let's change the all runnners to ubuntu-20.04.

We need to uninstall `snapd` because `snapd` prevents kernel from
unmounting `/mnt` completely.

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 5c2d325cc40f23da6d1a2f59535f1bc7c00e372f)
osd: allow raw partitions to be picked up by discover daemon

Signed-off-by: dkeven <dkvvven@gmail.com>
(cherry picked from commit dc95af5c33f30f7541617c603f46745e57a1c988)
nfs: allow users to include additional files in the SSSD sidecar

The sssd.conf may refer to additional files, like a CA bundle or TLS
certificates. These files need to be made available in the SSSD sidecar.
With the new `sssdGenericFiles` reference to a VolumeSource and a
`MountPath`, a provided `sssd.conf` can use the additional files.

Signed-off-by: Niels de Vos <ndevos@redhat.com>
Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 79adad7dc09f1f9b0a9a9122ac1d9d049ce91e63)
build: update the release version to 1.10.2

For the patch release update the example manifests and docs
to v1.10.2

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.10.2 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
nfs: Allow users to include additional files in the SSSD sidecar (, @BlaineEXE)
osd: Allow raw partitions to be picked up by discover daemon (, @dkeven)
nfs: Fix nfs if multus is enabled (, @parth-gr)
csi: Ensure CSI settings are applied with each update to configmap (, @pkalever)
operator: Silence verbose watcher debug messages (, @jhoblitt)
csi: Customize plugin volumes and volumemounts (, @Madhu-1)
core: Use assimilate-conf command to run commands (, @subhamkrai)
external: Fix import errors for python2 (, @subhamkrai)
osd: Disallow to create encrypted osd on partition (, @satoru-takeuchi)
build: Stop printing verbose rbac generation details (, @travisn)
monitoring: Fix pool growth warning grouping (, @jdloft)
build: Update goceph module to v0.17 (, @thotz)
nfs: Add kerberos client security support (, @BlaineEXE)
ci:  Disallow to create encrypted osd on lv and osd on lv with metadata device (, @satoru-takeuchi)
pool: Initialize only rbd application pools (, @Rakshith-R)
csi: Add topology provisioning support (, @Rakshith-R)
external: Do not add info=read cap if ceph version doesn't support it (, @parth-gr)
rgw: Delete zone/pools for multisite configuration (, @thotz)
osd: Add kmip encryption support (, @Rakshith-R)
ci: Move to ubuntu 20.04 runner completely (, @satoru-takeuchi)
ci: Fix intermittent gen-rbac failure (, @travisn)"
"ceph: add ability to set resource limit for OSDs based on device classes

Currently it is not possible to set resource limits based on device classes
for different OSDs. Now adding an ability to use predefined keys for main
cluster spec Resource section to reflect resource limits for different OSDs
with different device classes.

Closes: https://github.com/rook/rook/issues/8007
Signed-off-by: Denis Egorenko <degorenko@mirantis.com>
ceph: add rbac for mgr to create service monitor

When there are two mgr daemons, a sidecar of the mgr will update the
service monitor depending on the active mgr daemon. When there is only
a single mgr, the operator will create the service monitor. Now, we
add rbac for the mgr to create these resources.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 66dba4fd411ffd7be4c7f3a3fbc5715ffc8ebf2c)
ceph: update csi sidecar images to latest release

This commit updates all the kubernetes sidecar
images to latest available release version.

Signed-off-by: Madhu Rajanna <madhupr007@gmail.com>
(cherry picked from commit 08997434ac5b9eaa7cac299dab5b429dd9ac9cd6)
ceph: remove --force when creating filesystem

we should not use --force when creating filesystem(fs)
as it will recreate fs which will leads to data loss
when `preserveFilesystemOnDelete` is set to 'true'.

this commit removes --force argument when create fs.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 5d5bdbbbdae0cf9e6af6c9b0e83d1d20d194e62b)
ceph: set device class for already present osd deployments

Add ability to set device class for existing osd deployments,
based on its crush map device class.

Related-Issue: rook
Signed-off-by: Denis Egorenko <degorenko@mirantis.com>
(cherry picked from commit 6dbb9026749c4da27ac678f12e97e3861daed731)
docs: clarify resource documentation

Move MDS related information from the Cluster to the Filesystem document.
Document how resource requests influence Ceph configuration keys.

Signed-off-by: Pedro Lopes <paol@draic.org>
(cherry picked from commit 9d4820ec56de8fd69bfbb39fcfd74fc4f5e9ee7a)
ceph: activate osd container should use correct dataDirHostPath

The active osd container was always using /var/lib/rook for the
configuration of the OSD. If the dataDirHostPath is anything other
than the default, the config would show up in the wrong place.
Changing this back to the dataDirHostPath does not appear to affect
any upgrade scenarios as the activate container will simply start
extracting the config to the correct place.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit dd3b4738bd6c16ec85b0f30b3f1ecd14da07bd57)
ceph: initialise httpclient for bucketchecker and objectstoreuser

For the TLS communication for AdminOps Api, httpclient is required and
filled with TLS certs, currently it is set to nil pointer in
`buckethealthchecker` and `cephobjectstoreuser`.

Thanks @Krast76 finding the issue even proposing the fix.

Fixes:
Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 867474e4055cc6006ac52c58497ba823f5e5e59f)
ceph: update cronjob from v1beta1 to v1

this commit update cronjob from v1beta1 to v1

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit f82fc46b9726ef1bfd2cc07bf83c03006d28e99a)
ceph: use cacert if no client cert/key are present

We have seen issues with fullchain.pem files containing one self-signed
certificate. At the same time, the failing configuration was not
providing any client certificates or keys.

The error from curl was `""self signed certificate in the chain""`.

The openssl binary is not available so we cannot even c_rehash the
certificate directory when using `--capath`, however this worked already
with a fully signed fullchain.pem along with a client certificate and
key. So we cannot only use `--cacert` which will break that use case.

This is becoming really obscur on why using `--cacert` solves this
problem. I just can't wait to use the `vault` binary, that's all I can
say...

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit eb0c986196833a63ea98692bd7a3925c93179bf8)
ceph: mons in stretch cluster assign to node

When the mons are using the dataDirHostPath and not a volumeClaimTemplate,
they need to be permanently assigned to a node. The node assignment
was missing in stretch clusters when the dataDirHostPath was being
used. This resulted in mons that were moving to other nodes for example
during a node drain, which would cause the mon to lose its backing store.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit a7066770f7cdf22c94c96b1a20d3b7d3a4c54a74)
core: sort multus annotation strings when applying

In pkg/operator/k8sutil/network.go:ApplyMultus(), sort the string
annotations before applying them so that Rook will avoid the situation
where a Deployment or Pod will need updated repeatedly even when no
Multus network configuration has changed.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 0b40faa79ca8e94c2d061dc719e9cd9127115591)
ceph: only require rgw-admin-ops user when an endpoint is provided

If there is no rgw endpoint provided, let's not try to create the user.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 7439c08b314660115ecf7805368bc0be280a152d)
ceph: read and validate CSI params in Go routine

This commit moves SetParams and ValidateCSIParam func
into go routine/lock, since it modifies/reads global CSIParam
variable.

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 66c9ccab86bef57e761e4ea0a6bb8d01bfe50294)
ceph: do not leak key encryption key

When evaluating the potential ""warning"" key from the json output we were
not hiding stdout (1) from the output, so the key was leaked. Also the
warning check for the key was not perfect, it only checked for the
command to succeed, but we should introspect it since the ""warning"" key
is always present unlike the ""error"" one.
We now only print the warning or the error is present.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit bcd2511a7269ceb72c5c4a255fa760de85dea1e1)
ceph: run CLI output with Info logging

In e8f9cfcb714685d93017be279d9ffdfc3847acca, the logging was replaced by
Debug which is probably a mistake given the intent of the commit to
enable debug logging on the prepare job.
However, this code is only triggered when running a ceph-osd with the
rook binary, so we must run Info and run Debug since Debug is not
activated.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit da56354aa3c18ff3b88848aaea9c1849c79f18d5)
ceph: evict a mon if colocated with another mon

In a production cluster we never should have two mons running on
the same node. However, if two mons have ended up on the same node,
whether from a bug or some other unintentional event, the operator
will evict one of them and failover to a new mon. This only applies
when allowMultiplePerNode is false.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit b1c1e296ddb852711fbc43181745f5613a26d4c1)
ceph: update csi node-driver-registrar to latest release

This commit updates csi node-driver-registrar to latest
release v2.2.0.
https://github.com/kubernetes-csi/node-driver-registrar/releases

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 2baf50771e395da63e6398368b67a237b2c84776)
build: update release version to v1.6.6

For the patch release we update the example manifests

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.6.6 is a patch release limited in scope and focusing on small feature additions and bug fixes.
Ceph
Update csi sidecar images to latest release (, @Madhu-1)
Update csi node-driver-registrar to latest release (, @Rakshith-R)
Evict a mon if colocated with another mon (, @travisn)
Enable logging in legacy LVM OSD daemons (, @leseb)
Do not leak key encryption key to the log (, @leseb)
Read and validate CSI params in a goroutine (, @Rakshith-R)
Only require rgw-admin-ops user when an RGW endpoint is provided (, @leseb)
Avoid unnecessary OSD restarts when multus is configured (, @BlaineEXE)
Use cacert if no client cert/key are present for OSD encryption with Vault (, @leseb)
Mons in stretch cluster should be assigned to a node when using dataDirHostPath (, @travisn)
Support cronjob v1 for newer versions of K8s to avoid deprecated v1beta1 (, @subhamkrai)
Initialise httpclient for bucketchecker and objectstoreuse (, @thotz)
Activate osd container should use correct host path for config (, @travisn)
Set device class for already present osd deployments (, @degorenko)
No need for --force when creating filesystem (, @subhamkrai)
Expose enableCSIHostNetwork correctly in the helm chart (, @Madhu-1)
Add RBAC for mgr to create service monitor (, @travisn)
Update operator internal controller runtime and k8s reference version (, @subhamkrai)"
"docs: add jumbo frames note to common issues

Resolves

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 6c90d6687559adfda2e1e408cbc4fc3c1e7aa301)
build: update build to go v1.16.12

A Go net/http bug documented here
https://github.com/golang/go/issues/50058 could potentially affect users
who enable Rook's webhook.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
docs: add section for disruptionManagement (backport 9522)

Adding section `disruptionManagement` which was
removed unintentionally in PR 8381.

Signed-off-by: subhamkrai <srai@redhat.com>
osd: correct bluestore compression min blob size for ssd

Update bluestore compression min blob size for ssd to 8192.
It was typo which was added long time back.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit d87be97a50ef67c1696e96eb44ff06d624352d6e)
mgr: update services when active mgr changes

When the active mgr changes, there may be user-created services
that also need to have their selector updated to point to the
new active mgr. Now the operator will update any service in the
rook operator namespace that has the label app=rook-ceph-mgr
to point to the active mgr.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 11127f54ca6be21c93da16b664fc57058632f341)
build: update release version to v1.7.11

With the patch release the example manifests and docs are updated to v1.7.11

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.7.11 is a patch release limited in scope and focusing on small feature additions and bug fixes to the Ceph operator.
mgr: Update services with the app=rook-ceph-mgr label when the active Ceph mgr changes (, @travisn)
osd: Correct bluestore compression min blob size for ssd (, @subhamkrai)
build: Update to go v1.16.12 (, @BlaineEXE)"
"ci: use stringData instead of data for secret

The ""data"" field only accepts base64 strings and our env var is not. So
let's use stringData to prevent an error from the API server:

```
""v1"" cannot be handled as a Secret: illegal base64 data at input byte 29
```

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit edfd120d6aa41eac18d69e50d166e3d4bbb3c417)
core: append filesystem property on disk

When detecting the device property the filesystem was not passed but
used later to validate if the device should be taken or not. Now we read
the filesystem info from ""lsblk"" and populate it in the device type.

Closes: https://github.com/rook/rook/issues/9470
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 8c1bf0f3f0460e5fcb699d5c911978330cdc8729)
core: add more debug info to the prepare pod

When running the device property commands, let's also log their results
for better debugging/visibility.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 77b2e10c140e4b4dea44b7dc28900f6fb8f15258)
core: add mountpoint detection to the prepare pod

Amount various filters let's add a mountpoint property and skip the
device if its filesystem is mounted.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 8328ec6d313b20362d33031eb8d0c4992307b1ce)
osd: allow the osd to take a long time to start

The startup probe for the OSD has been too aggressive to kill the OSD
in case the OSD is taking some time to start. The OSD may be self-optimizing,
scrubbing, or some other internal operation before it is ready to start.
Rather than disable the startup probe completely, the default is now
to retry for two hours in case the OSD is performing those operations.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 28e721d8773187c4a8fa5bb2cbc87d6c87eb274b)
operator: set 'rook-version' in mon k/v store

Ceph upstream telemetry (which Rook users could optionally enable via
Ceph CLI or Dashboard) does not easily identify if a cluster is managed
by Rook. Identifying Rook clusters is possible only if users also enable
the rook mgr module, which is optional and not often used.

To get better upstream insights into Ceph clusters managed by Rook, set
a new 'rook-version' field in Ceph's generic k/v store. This field can
be used to determine if a cluster is managed by Rook by its presence.
It additionally provides information about the Rook version used to
manage the cluster, which is another piece of potentially useful
information.

Regarding Ceph cluster identification via telemetry:
Ceph telemetry is anonymous and uses a different ID from the Ceph
cluster ID. Identifying the Rook version in telemetry does not add
directly identifying information. Therefore, there should be little
risk that adding the Rook version field will decrease anonymity of Ceph
clusters via telemetry.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 94b622c3021bb1f8b83c6188e79930e34cf9e04b)

# Conflicts:
#	pkg/operator/ceph/cluster/cluster.go
operator: rename telemetry rook-version to rook/version

The Rook and Ceph teams settled on using slashes to separate Rook
telemetry items into a hierarchy in https://github.com/rook/rook/pull/10254.
Rename the config-key used to `rook/version`, and create a `telemetry`
package to define the telemetry key constants.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 6888d545d298ea450dd49f6267dafd7d8750df11)

# Conflicts:
#	pkg/operator/ceph/cluster/cluster.go
osd: remove broken argument

During the tini's binary removal you overlooked that scenario and
introduced a bug in the OSD startup line.
We were passing the binary path as an argument, which is obviously wrong
and makes the OSD crash at boot.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit f79de7d69aaef42ba4be95ab73ae8f31c1da2065)
build: disable docs build in 1.8 branch

With the full rework of the docs framework, we cannot support automated
updating of docs from branches where the doc framework has not been
backported. We are largely done with the 1.8 releases, so we can just
disable publishing the docs for the 1.8 branch. If further updates
are required in the docs, we can update the legacy docs directly in
the rook.github.io repo.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
build: update examples and base image to use ceph v16.2.9

In release 1.8, the operator base image has been changed to
ceph v16.2.9

Signed-off-by: parth-gr <paarora@redhat.com>
build: update release version to v1.8.10

For the patch release update the examples and docs to
v1.8.10

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.8.10 is a patch release limited in scope and focusing on small feature additions and bug fixes to the Ceph operator.
core: Improve detection of filesystem properties for disk in use (, @leseb)
osd: Remove broken argument for upgraded OSDs on PVCs in legacy lvm mode (, @leseb)
osd: Allow the osd to take two hours to start in case of ceph maintenance (, @travisn)
operator: Report telemetry 'rook/version' in mon store (, @BlaineEXE)"
"csi: fix stagingpath

Kubernetes 1.24 and newer use a different path for staging the volume.
That means the CSI-driver is requested to mount the volume at an other
location, compared to previous versions of Kubernetes.

The backward compatibility should be taken care by the CSI driver.

See-also: kubernetes/kubernetes
Signed-off-by: Prasanna Kumar Kalever <prasanna.kalever@redhat.com>
(cherry picked from commit 2627f32d51751279e871c027e5df85e91c4319f5)
mon: fix typo in log message for msgr2

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit ecbc438d7a2759c3364a021fbba1180b4455b953)
mon: disable insecure global ids for new deployments

In new deployments we always want to disable the insecure global id.
If the mgr deployment is newly created, we know it's a new cluster
and the mons are in quorum, so we can go ahead and disable the
insecure global IDs.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 28957b3ff1f9f082a0c4a4fcfc3f5d525c811aa0)
helm: use correct namespace for provisioner in cephobjectstore template (fixes)

Signed-off-by: Markus Schmidleitner <markus.schmidleitner@ocilion.com>
(cherry picked from commit 36a93745553f624f92b0dfbe59f8492677635de7)
test: delete object sc before upgrade tests ()

Signed-off-by: Markus Schmidleitner <markus.schmidleitner@ocilion.com>
(cherry picked from commit 00689476df41e7e88003700fd4c8faddfff8c9bb)
docs: added upgrade note ()

Signed-off-by: Markus Schmidleitner <markus.schmidleitner@ocilion.com>
(cherry picked from commit 506c266f2f8384e3097f438bdfb0bd1ee8a746e4)
ci: rename TestCephSettings.EnableCSINFS to TestNFSCSI

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 928dd46593b248a7935edca37957b3e4b7c9864e)
ci: explain why ""nolock"" mountOption is needed for nfs

""nolock"" mountOptions has been added to prevent the following error in ci:
Output: mount.nfs: rpc.statd is not running but is required for remote locking.
mount.nfs: Either use '-o nolock' to keep locks local, or start statd.

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 621dd2a15942701ec9f366388204acb0823870ff)
ci: skip nfs csi e2e to avoid flaky e2e

Skip nfs csi e2e until https://github.com/rook/rook/issues/10518
is resolved to avoid flakiness.

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 16d34e142584b122e3bb282b0485098051ee3eba)
ci: make sure PVC is deleted before proceeding for file test

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 034c4756d3110269d2436243778cf8ec4a7ae212)
manifest: use `Recreate` strategy for operator upgrade

Use `Recreate` strategy instead of `RollingUpdate` for
rook-ceph-operator deployement upgrade

Signed-off-by: Santosh Pillai <sapillai@redhat.com>
(cherry picked from commit 693c2d9306514f4babeb688a8dd86f555cc6b69f)
docs: refactor cluster crd doc for subtopics

The cluster CR doc is extremely long and in need of refactoring.
Now we have four new sub-topics for a host-based cluster,
PVC-based cluster, stretch cluster, and an external cluster.
Each of those topics has its own description and examples.
The main cluster CR topic still contains the details about
all the possible cluster CR settings.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 34ca5d661bfa202d1a9071a43dec9fac308f4288)
csi: add support for subvolumegroup and rados namespace

Using subvolume group and rados namespace for external deployment
was complicated and not documented,
Automating the process for the users, so they just need to pass
the respective names by cli flag for creation

Closes: rook

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit c9a864ccdb683f45e231e10250e2b72eef44a654)
Signed-off-by: parth-gr <paarora@redhat.com>
helm: use recommended value for helm managed-by label

This changes the `app.kubernetes.io/managed-by` label to use the helm
`{{ .Release.Service }}` for it's value.
This is recommended by the Helm labels and annotations standard labels
doc page, see https://helm.sh/docs/chart_best_practices/labels/#standard-labels

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit 455508ea149891752847e30bf90e6edeee8c7441)
build: set release version to v1.9.7

For the patch release the examples and documentation are updated
to v1.9.7.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.9.7 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
helm: Use recommended value for helm managed-by label (, @galexrt)
manifest: Use Recreate strategy for operator upgrade (, @sp98)
external: Add support for subvolumegroup and rados namespace (, @parth-gr)
docs: Refactor cluster crd doc for subtopics (, @travisn)
helm: use correct namespace for provisioner in cephobjectstore template (, @bitfisher)
mon: Disable insecure global ids immediately for new deployments (, @travisn)
csi: Update staging path to support K8s 1.24+ (, @pkalever)"
"docs: add details about HPA via KEDA

By default HPA can use details about memory or CPU consumption for
autoscaling, but also it can use custom metrics as well. There are alot
provides supports HPA via customer and one of them is KEDA project. Here
it is done with help of Prometheus Scaler

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit d32c837e35d679671d901e3fb4771d0903a68727)
monitoring: allow overriding monitoring labels

The templates for the mgr-generated ServiceMonitor and PrometheusRule objects included the labels
prometheus and team, making it impossible to override them as user.

This adds a new method `OverwriteApplyToObjectMeta` to pkg/apis/rook.io.Labels,
which, contrary to the existing `ApplyToObjectMeta` method, overwrites existing
labels.

Backport of PR
Signed-off-by: Mara Sophie Grosch <littlefox@lf-net.org>
nfs: only set the pool size when it exists

For CRD not using the new nfs spec that includes the pool settings,
applying the ""size"" property won't work since it is set to 0. The pool
still gets created but returns an error. The loop is re-queued but on
the second run the pool is detected so no further configuration is done.

Closes: https://github.com/rook/rook/issues/9205
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit c3accdcc3aa7b7900d3fbddcf9cd7e56d7c1206c)
nfs: always run default pool creation

Previously, if the pool was present we would not run the pool creation
again. This is a problem if the pool spec changes, the new settings will
never be applied.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit f3142847d391e075b59ab3a100227e74f57f2bcc)
monitoring: update label on prometheus resources

Updating the promethes reources (PrometheusRule and ServiceMonitor) is
done by fetching the current resource from the server and updating the
spec on it. This commit makes it also apply the labels, so users can
update them via rook CRDs.

Closes: https://github.com/rook/rook/issues/9241
Signed-off-by: Mara Sophie Grosch <littlefox@lf-net.org>
(cherry picked from commit 733878b1eb27dda0f9804d02ad7b5a2c3941cd85)
core: fix openshift security context

The MKNOD capability was missing and due to recent addition some pod now
only require this cap as well as privileged.
The cap must be explicitly exposed so it can be requested by a pod.

Closes: https://github.com/rook/rook/issues/9234
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit b38f430c261598f9bd87e865c4576e2053e8396b)
object: fix rgw ceph config

use Zone and ZoneGroup instead of storename for rgw_zone and rgw_zonegroup

Signed-off-by: Olivier Bouffet <olivier.bouffet@infomaniak.com>
osd: check if osd is ok-to-stop before removal

If multiple removal jobs are fired in parallel, there is a risk of
losing data since we will forcefully remove the OSD. It's also simply
true if a single OSD is not safe to destroy, there is also a risk of
data loss.

So now, we check if the OSD is safe-to-destroy first and then proceed.
The code waits forever and retries every minute unless the
--force-osd-removal flag is passed.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 7402c2cce681103248202e0d09f85d7cc1159642)
helm: allow further configurability of ingress version

The ingress api version changed when it went to v1, and this has caused some upheaval
throughout the kubernetes ecosystem. This commit uses a common method of deciding which
ingress api to use, and allows the optional override of the kubernetes version
presented to helm using the helm build-in capabilities.
also add an ingress into the helm integration tests so any regressions to how ingresses
are handled in the future are caught easier.

Closes

Signed-off-by: Tom Hellier <me@tomhellier.com>
(cherry picked from commit ba44602)
Signed-off-by: Tom Hellier <me@tomhellier.com>
cephfs-mirror: try to mitigate peer import error

Some users have reported issues while adding the token, this is not
always reproducable so perhaps it's a typo when importing the token and
adding trailing spaces.

Closes: https://github.com/rook/rook/issues/9151
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit d1cdba420a3bc2f717e989e946e13692051eac0d)
core: add the ability to execute ceph commands with a combined output

Sometimes Ceph uses a different standard output to return errors or
merges standard error to standard out. So let's allow some commands to
return both in the output.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 7f7a72d941a419329b194dc8018452684c6d7e14)
cephfs-mirror: use combined output to possibly catch peer import error

By adding a combined output to the executor we might be able to fetch more
error messages.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit d8a8b05c1f78a2906ab9e59e6843ab5cfb473324)
osd: update existing OSDs with deviceClass

If we apply useAllNodes to false for the current deployment,
the OSDs should get updated with the individual nodes values and config,
The deviceClass was not updating to the existing OSDs because there was
bug in the check.
The check osdInfo.DeviceClass == """" which should be
checked like this osdInfo.DeviceClass == ""None""

Updated the code so OSDs can make use of the devices present

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit cbe505d12221af6aeb2d23aa1e5b1892ad46e664)
build: add pv-migrator binary to rook image in 1.7.8 branch

Adding  add pv-migrator binary to rook image directly
in 1.7.8 branch as discussed.

Signed-off-by: subhamkrai <srai@redhat.com>
core: adding migrator.yaml for pv-migrator tool

Adding migrator.yaml file which will required
to run migrator pod.

Signed-off-by: subhamkrai <srai@redhat.com>
helm: addition of mountOptions into storage class configuration

It should be possible to configure the storage classs mount options, this follows
the helm code used by the ceph-csi project for their ceph-csi-rbd and ceph-csi-cephfs
helm charts.

Signed-off-by: Tom Hellier <me@tomhellier.com>
(cherry picked from commit caa2c8323b9c06a835b62ea022f9e2376110a1de)
helm: use a more explicit value for ingress

The networking.k8s.io/v1 api defines the backend differently
to networking.k8s.io/v1beta1 and extensions/v1beta1

(cherry picked from commit 2ca93e5)
Signed-off-by: Tom Hellier <me@tomhellier.com>
docs: add guide doc for flex migration

Adding guide doc for migrating rbd flexvolume to ceph-csi.

Signed-off-by: subhamkrai <srai@redhat.com>
docs: last nits of flex-migrator yaml

Missed few nits of flex-migrator,doing it here
as discussed.

Signed-off-by: subhamkrai <srai@redhat.com>
build: set the release version to v1.7.9

Update examples and documentation to v1.7.9.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>","Improvements
Rook v1.7.9 is a patch release limited in scope and focusing on small feature additions and bug fixes to the Ceph operator.
This release includes the new migration tool from flex to CSI. The conversion is required before clusters can be upgraded to v1.8 where flex volumes will not be supported.
docs: Guide for migrating from flex to csi volumes  (, @subhamkrai)
build: Add pv-migrator tool to rook image in 1.7.x branch (, @subhamkrai)
helm: Addition of mountOptions into storage class configuration (, @TomHellier)
osd: Update existing OSDs with deviceClass (, @parth-gr)
cephfs-mirror: Various fixes for random bootstrap peer import errors (, @leseb)
helm: Allow configurability of ingress version (, @TomHellier)
osd: Check if osd is safe-to-destroy before removal from the osd purge job (, @leseb)
object: Configure object store with correct zone name for multisite (, @olivierbouffet)
monitoring: Update label on prometheus resources (, @LittleFox94)
core: Add expected capabilities to OpenShift security context (, @leseb)
nfs: Only set the pool size when it exists and always run default pool creation for NFS (, @leseb)
monitoring: Allow overriding monitoring labels (, @LittleFox94)
helm: Use a more explicit value for ingress for K8s 1.18 (, @TomHellier)
object: Create system user with correct realm for external cluster (, @olivierbouffet)
docs: Add details about HPA via KEDA (, @thotz)"
"core: add func ExpandPVCIfRequired in k8sutil pkg

ExpandPVCIfRequired will expand PVC if and only if current PVC size is
less than the desired PVC size.

Signed-off-by: Nitin Goyal <nigoyal@redhat.com>
(cherry picked from commit 2e8f513197834ca1231f6b492cd6d661c7d89923)
ceph: expand Mon Pvc's

Expand Mon Pvc's if storage request has increased for the Mons in the
cephcluster crd.

Signed-off-by: Nitin Goyal <nigoyal@redhat.com>
(cherry picked from commit 3575c3bf7801e09507f2ee2bf9e83cd67035815f)
ceph: stop using updatePVCIfChanged and start using ExpandPVCIfRequired

delete updatePVCIfChanged method on ""Cluster"" from osd package and use
the common one ExpandPVCIfRequired from k8sutil pkg

Signed-off-by: Nitin Goyal <nigoyal@redhat.com>
(cherry picked from commit 99bc72d79f474a9e9f26cb1def1417ecce36f7b2)
docs: fix ceph pacific related descriptions

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit c8700bdae35a02827abdfb5596bbdd352b7a7956)
ceph: service server cert support for rgw

Service serving certificates are intended to applications that require
encryption in openshift. These certificates are issued as TLS web server
certificates. Currently RGW supports TLS authentication with help of
certs passed as secrets, in this case we add following details as
`service.annotations` in the Objectstore Gateway Spec :
```
service:
  annotations:
    service.beta.openshift.io/serving-cert-secret-name: <name for
autogenerated secret>
```

More details about service serving cert can be found at :
https://docs.openshift.com/container-platform/4.6/security/certificates/service-serving-certificate.html

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit aea21d9c84c35da3fbe711c0c551316b31c11fb7)
test: adding unit test for service serving cert

include unit tests for the new apis and functionality introduced by the feature
Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 809a8d174c5e6011dd9de0bedeeaf2ea5980e833)
docs: add documentation for service serving cert

Add necessary changes in object-openshift.yaml, ceph-object-store-crd.md for service serving cert support for RGW

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit af86fbed72d203658f9c62d0e11b90b655560157)
ceph: unity timeout values of commands

There is no strong reason to have different timeout values.

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 709e8d5ba89eee84f6e7c853686524f66d2ffda3)
docs: workaround preserveUnknownFields upgrade

When upgrading Rook clusters created before v1.5,
`kubectl apply -f crds.yaml` fails due to the existence of
the usupported `spec.preserveUnknownFields`. Add text documenting how to
work around this issue in the Ceph upgrade docs.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit c90f3c3721b0e1a79ab969243f17788b10eca623)
ceph: moved multus support out of experimental

moved multus support out of experimental.

Signed-off-by: rohan47 <rohgupta@redhat.com>
(cherry picked from commit a654bc777b30281b7d3b32310a3993e8423906d5)
ceph: detect the osd topology affinity during upgrade

The nodeAffinity for portable OSDs is needed to ensure the OSDs are
tied to the same zone or other failure domain where the OSD was
prepared and where it is expected to run. During upgrade the topology
affinity was not being detected since the osd prepare job is skipped
in that case. Now the topology will be detected from the running
OSD daemon pod's node.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 08f896e8652910fc8ac2b8c81fb603d047610177)
docs: remove ""this is long video b""

On Node Port service section, output of the `kubectl -n rook-ceph get service` command had a unwanted string ""this is long video"" that I've removed it.

Signed-off-by: m.ghasempour <mso.ghasempour@digikala.com>
(cherry picked from commit 0b638c1c525e0840a2e25eb9e08ab6f5db8da430)
ceph: clarify log message to continue with upgrade if needed

The ceph upgrade blocks if the ceph heatlh is HEALTH_ERR. If the user
wants to force the upgrade despite the health error, they will need
to set skipUpgradeChecks: true in the cephcluster CR. This message
will hopefully make that setting more discoverable.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 6f61d95dc3812664033f3c5bab3e16d08aead78a)
ceph: add api to fetch cacert for RGW server

Rook operator sends S3 to RGW server for bucket operations performed by healthchecker,
bucketprovisioner etc. Add api to fetch cacert if the TLS enabled for RGW.

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 7a5928d2c56729fdee6b88be46612a8ea80b4ce7)
ceph: support for OBC operations on enabled TLS RGW endpoint

OBC operations will fail if RGW only enabled HTTPS. With this change, OBC operations
will use needed TLS certs to succeed the operation.

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit f9c7634d888ac75a986ac40dd519bf5fafa1f289)
ceph: ensure object store endpoint is initialized for user

when store.Status was not initialized it caused
crashes when assigning store.Status.Info[""endpoint""]
to objContext.Endpoint.

This commits makes sure store.Status is not Nil
before setting objContext.Endpoint and
objContext.SecureEndpoint in the ObjectStoreUser
controller.

Closes: https://github.com/rook/rook/issues/6916
Signed-off-by: Ali Maredia <amaredia@redhat.com>
(cherry picked from commit c9fee1f883c225b9f443e7426802e3fc2fe8fe7a)
ci: use latest pacific for mirroring test

So we can get https://github.com/ceph/ceph/pull/40985 and have a more
stable CI. Once v16.2.2 is released we can revert this.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 6a97721576e03f4ae361e3bac867002b3e344da5)
ceph: modify ValidateConnectionDetails() in kms

The ValidateConnectionDetails() contains `clusterSpec` assuming `SecuritySpec` only
part to `cephCluster` CRD. But we may need to validate same for `SecuritySpec` in
`cephObjectStore` CRD. Hence modifying the signature of the api.

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 8e5c6c126c2f7a3c9cdc9551ea5ddad34b8f07ea)
ceph: check for kv engine version for SSE RGW

The ""https://docs.ceph.com/en/latest/radosgw/vault/"" says RGW supports only version v2 of
kv engine, so pod won't start if the admin didn't provide ""VAULT_BACKEND"" in security.kms.ConnectionDetails

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 3ef3e8b72e4ea768ab584214012f5312f993a193)
ceph: add security spec to object store spec

Add `SecuritySpec` to specify kms details for rgw in `ObjectStoreSpec` than using existing
`SecuritySpec` used for `ClusterSpec`. The vault secret engines conflict with OSD and RGW
kms encrytpion

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit a5a5661e5ffa88e9c9b40fb6456fa44104a5908c)
docs: update the vault kms documentation for RGW

This changes documentation from `ceph-cluster-crd.md` to `ceph-object-store-crd.md`.

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 73b43c5e736b4f012cb866baae4f7d4a0260901a)
test: add seperate test for rgw vault integration

RGW supports only v2 version of kv engine, current integration test is written for kv v1,
hence seperating existing test into two.

Signed-off-by: Jiffin Tony Thottan <thottanjiffin@gmail.com>
(cherry picked from commit 3cacd8db32b711d8999969702550a909b85f35e4)
ceph: complete missing steps of upgrading mds

Upgrading mds requires extra steps than simply
replacing ceph image. see https://docs.ceph.com/en/latest/cephfs/upgrading/
for reference.

Signed-off-by: shenjiatong <yshxxsjt715@gmail.com>
(cherry picked from commit 58f6b495af82826127830d12084f0016febfdcf9)

# Conflicts:
#	PendingReleaseNotes.md
ceph: reset max_mds and allow_standby_replay in deferred function

set fsPreparedForUpgrade to true for upgrading mds, to
make sure that max_mds is set back to active count
after all mds agent gets upgraded

Signed-off-by: shenjiatong <yshxxsjt715@gmail.com>
(cherry picked from commit 81f888260be2515aea86515fd78445ca28c44036)
ceph: make sure standbys are stopped

wait and make sure standbys are stopped before
continuing to upgrade the primary mds daemon.

Signed-off-by: shenjiatong <yshxxsjt715@gmail.com>
(cherry picked from commit 41f775ec17c59b0551490bd0c1a7d99d2f289aaf)

# Conflicts:
#	PendingReleaseNotes.md
docs: add static pv and static pvc creation info

This commit adds information about static pv and static pvc
creation and links a document with more information.

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit e88bff4afd2b95193da3b5341fa55eae3e75e9c5)
docs: common-issue link updated in ceph-upgrade doc

The ceph-common-issue doc link in ceph-upgrade document was broken
Fixed the link by changing the directory path

Closes: https://github.com/rook/rook/issues/7794
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 78f5a2495d8d3fda789014db26413cc7b941db18)
ceph: upgrade mds fix typos

fix some nits on error wraps and logging

Signed-off-by: shenjiatong <yshxxsjt715@gmail.com>
(cherry picked from commit 21bb12a20da911c064e309edc7b3505e749d411c)
core: persist VolumeClaimTemplate metadtata

Allow metadata on VolumeClaimTemplates in StorageClassDeviceSets to be
persisted. The latest changes to controller-gen allows us to embed
objectmeta for embedded types.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit d260b81e97ba11a6e85b50dba00fbc8f062f6be1)
ceph: add phase to cephfilesystems crd

add a Phase to columns that should be printed

Signed-off-by: shenjiatong <yshxxsjt715@gmail.com>
(cherry picked from commit e1fd23933f955dd1c789c33c3e3ac0d18a9237c6)
ceph: allow null values for pool settings

The schema in v1.6 is more strict and we are seeing errors in the csv
upgrades where nullable values are not allowed for the pool settings.
We now allow the nullable settings again to fix the upgrade scenario.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit f22d8d4dc94ce0f73599aa84493017a058dd1caa)

# Conflicts:
#	cluster/examples/kubernetes/ceph/crds.yaml
ceph: fix external mode setup

Because of the recent CRD changes made, the mon count had a minimum of
1, making the configuration of the external cluster impossible. The
operator would fail to add the finalizer:

```
2021-04-29 16:57:38.429451 E | ceph-cluster-controller: failed to reconcile. failed to add finalizer: failed to add finalizer ""cephcluster.ceph.rook.io"" on ""test-external"": CephCluster.ceph.rook.io ""test-external"" is invalid: spec.mon.count: Invalid value: 0: spec.mon.count in body should be greater than or equal to 1
```

We now fixed the CRD as well as adding the CR status.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 15a12577f56e448d43b5988b5357121a5a5f7353)
ceph: remove unused volumesource schema from cephcluster

The VolumeSource type was only used internally when loading
the storageClassDeviceSets. The volumeSource element is never
expected to be specified in the CephCluster CR, so it is now
removed from the schema. The VolumeSource type is renamed to
deviceSet for clarity.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit ce50eb240794e1f8a2a494e75d853444009cb8e8)
ceph: set the device class on raw mode osds

The deviceClass was only being set for LVM mode OSDs and was
missed for the raw mode for non-PVC. Now the deviceClass will be set
for all expected scenarios.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit d5374f11a10abc0e41ce7b06e641d037bede20e9)
ceph: update snapshot APIs from v1beta1 to v1

This commit updates external-snapshotter version to
v4.0.0 which supports snapshots v1.
Rook now defaults to enabling RBD and CephFS snapshotter
for K8s >= v1.17 and disabling it for K8s <= v1.16.
Supporting changes in documents and examples yaml files
are made.

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 7987e1b8a2ae6e68100b77d3f2427caba8e39166)
ceph: retry once before mon failover if mon pod is unscheduled

Events like node drain can take more than 10-15 minutes. If the node is not update the default monTimeOut of 10 minutes, then rook will attempt to fail over the mon. This failover won't work as the node is still down.
This PR retries once before the mon failover if the mon pod is not scheduled

Signed-off-by: Santosh Pillai <sapillai@redhat.com>
(cherry picked from commit f38829b57d0c14e28a203a8b7dd4325036d03eaf)
ceph: update images to v16.2.2

Ceph v16.2.2 is released with dated tag v16.2.2-20210505. Update Ceph
images to match with or without date as appropriate.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 5245ceaf06a17f5cea6fe2ca8eb14c7eb53c2078)
ceph: update erasure coded profile command

currently, recreating erasure codedpPool with
different Settings show error and creation
failed.

Adding `--force` to the erasure coded profile
command works file with above condition.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 0ef7308d74b66f9a64ca9ad5426c3756cf447209)
ceph: preserve volume claim template annotations during upgrade

The upgrade of the csv is failing to the latest schema when
the crushDeviceClass is specified and when the volumeClaimTemplate
annotations do not preserve the unknown fields. To fix the upgrade,
we preserve the fields even though it should not be necessary
from the strict schema.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 08d720f450cdaa3dc62b8562868e7cadc45033ce)
ceph: fix intermittent volume unit test

The unit test TestConfigureCVDevices was failing intermittently
due to comparing the first element of the slice of two elements.
The slice ordering is not guaranteed, which caused a failure
intermittently. The test only compares the critical values in the test
and no need to check elements of the slice.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 55dc1d2ba546975895b2805e48bd51a2365bc64b)
build: fix sed command for linux

The following command ended up being missinterpreted on linux,
generating a wrong file named ceph.clusterserviceversion.yaml'\''
with broken quotes.
Making it an array ensures the command and the args are parsed
correctly. Tested on both linux and macos.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 49f2f0b441a3b835b180bcd4ef8fc3cc9209067e)
build: fix parallel build

We now the generate the CRDs as well as the CSV on a single GOARCH only:
amd64. This helps us avoiding builds colliding with each others.

Closes: https://github.com/rook/rook/issues/7655
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 0f7128ece9af055989f6e3ef240ac950f748c450)
ceph: allow setting primary-affinity to osd

A user with unbalanced system (e.g., some OSDs use a partition which
resides on a device along-side OS partition) may want to have a
fine-grained control on the overall load of specific OSD. While osd
weight affects write-load, primary-affinity affects read-load.

This patch allow user to define osd's primary-affinity (similar to
'DeviceClass' and 'InitialWeight'), which is sent to the osd (via mon)
as part of deployment sequence, using 'ceph osd primary-affinity' command.

Valid values are within the range [0.0, 1.0). If not set, default value
is 1.

ROOK issue: https://github.com/rook/rook/issues/7773

Signed-off-by: Shachar Sharon <ssharon@redhat.com>
(cherry picked from commit 2a3cfc693b51409d407d1d7391424006c124181d)
core: enhancement in debug logs

When DEBUG logging is enabled in the operator, there are a number of overwhelming messages in the log that are very overwhelming and don't seem useful, which makes debug mode difficult to use
Updated and Cutted down the messages that are not useful in debug mode

Closes: https://github.com/rook/rook/issues/7499
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit bb23622b72b639ea992613d271ae5ea7b97a3da5)
ceph: multicluster test cleanup of external cluster first

The multicluster test was never removing the finalizer of the external
cluster since the core cluster was being removed first. Now we remove
the external cluster first to ensure the finalizer will be removed
properly instead of forcefully by the test.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 2b2a1f66c42fe049900437d09b397c45be849942)
ceph: run ceph tests in jenkins if requested

If the [test ceph] text is included in the PR description,
go ahead and run the ceph tests in Jenkins instead of always
skipping them

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 5a8b8c7217971f75348e7f0f36e2abb06e4943b6)
build: set the patch release to v1.6.2

Update the release version and example manifests to v1.6.2

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.6.2 is a patch release limited in scope and focusing on small feature additions and bug fixes.
Ceph
Set base Ceph operator image and example deployments to v16.2.2 (, @BlaineEXE)
Update snapshot APIs from v1beta1 to v1 (, @Rakshith-R)
Documentation for creating static PVs (, @Rakshith-R)
Allow setting primary-affinity for the OSD (, @synarete)
Remove unneeded debug log statements (, @parth-gr)
Preserve volume claim template annotations during upgrade (, @travisn)
Allow re-creating erasure coded pool with different settings (, @subhamkrai)
Double mon failover timeout during a node drain (, @sp98)
Remove unused volumesource schema from CephCluster CRD (, @travisn)
Set the device class on raw mode osds (, @travisn)
External cluster schema fix to allow not setting mons (, @leseb)
Add phase to the CephFilesystem CRD (, @jshen28)
Generate full schema for volumeClaimTemplates in the CephCluster CRD (, @BlaineEXE)
Automate upgrades for the MDS daemon to properly scale down and scale up (, @jshen28)
Add Vault KMS support for object stores (, @thotz)
Ensure object store endpoint is initialized when creating an object user (, @alimaredia)
Support for OBC operations when RGW is configured with TLS (, @thotz)
Preserve the OSD topology affinity during upgrade for clusters on PVCs (, @travisn)
Unify timeouts for various Ceph commands (, @satoru-takeuchi)
Allow setting annotations on RGW service (, @thotz)
Expand PVC size of mon daemons if requested (, @iamniting)"
"ci: enable snyk flag not to build vcs

The snyk check is failing because the -buildvcs flag
is defaulting to true. Let's disable this flag to
get the check passing.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 9197966ed4c8686050c3157025c9ad7d7b975417)
core: on crash pod ensure rook version label is not set

ceph crash pod gets rook version label added unintentionally, which is only for deployment label.
changes include:
1, make a copy of the labels for pod spec from deployment labels just before adding rook version label.
2, add unit test to make sure it works as designed.
This fix along with pr 11674 is to stop ceph daemons pod restarting unnecessarily after upgrading rook operator.

Signed-off-by: Ben Gao <bengao168@msn.com>
(cherry picked from commit ed6ed25257364f81ce9176123b6cb1bd9f85c368)
docs: change old version hint in docs

Resolves https://github.com/rook/rook.github.io/issues/144

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit a5131d730906ef652f2f8bb3ee0501985b589ddb)
file: check if fs exists before checking dependencies

Signed-off-by: zhucan <zhucan.k8s@gmail.com>
(cherry picked from commit 46c2bef9bc30cadd392a8a2478f913057ad63e8a)
object: make OBC genUserID unique across clusters

Rook's implementation of OBC's GenerateUserID could generate colliding
user IDs for multisite clusters where each site is configured with the
same namespace/name of CephObjectStore. Add the Ceph cluster FSID to the
generated name to ensure the names won't conflict for multiple sites.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 2733375ca4effcb4a5132aaf5471cd837bde9b2c)
docs: fix documentation indentation

It seems that this `deviceFilter` list item is indented too far.

This PR deindents it one level.

Signed-off-by: AJ Schmidt <ajs4392@gmail.com>
(cherry picked from commit da0ed4d21f96ed1e5fd7cc6ba5a9c039c3723f23)
manifest: add missing quote

Signed-off-by: Vincent Kling <v.kling@vinniict.nl>
(cherry picked from commit bd857cc5c5225eb1c9e9350d1a9503921cfff015)
ci: update golangci lint version

The golangci-lint ci action is failing in the 1.10
branch because it needed to be updated to the latest
version.

Signed-off-by: travisn <tnielsen@redhat.com>
ci: update golangci-lint version as it fails for some k8s version in 1.10

Closes: https://github.com/rook/rook/issues/11896

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 8e317ee074bd0cf6555b7c42e6403f713325cfb7)
Signed-off-by: parth-gr <paarora@redhat.com>
ci: fix golangci-lint issue in 1.10 specific which are already done in 1.11

Signed-off-by: parth-gr <paarora@redhat.com>
osd: handle global or node-local device class configuration correctly

Rook uses global or node-local device class configuration if device-level
configurations doesn't exist. However, after introducing device-class
level resource configuration, rook set the default value of device class.
So global or node-level device class configuration has never been used
after that.

Closes: https://github.com/rook/rook/issues/11871
Closes: https://github.com/rook/rook/issues/11826

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 3e34ebeff84c9aa2a5dec9e89076f20784e2230c)
build: update the release version to v1.10.13

For the patch release update the docs and examples to
v1.10.13.

Signed-off-by: travisn <tnielsen@redhat.com>","Improvements
Rook v1.10.13 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
osd: Handle global or node-local device class configuration correctly (, @satoru-takeuchi)
manifest: Add missing quote (, @DjVinnii)
object: Make OBC genUserID unique across clusters (, @BlaineEXE)
file: Check if the filesystem exists before checking dependencies (, @zhucan)
core: On crash pod ensure rook version label is not set (, @gaord)"
"mgr: role rook-ceph-mgr is lack of patch verb to compete ceph request

ceph orch command uses patch method to update cephcluster. Adding patch to verbs list of rook-ceph-mgr(Role) to make it work. It was allright with deploy/charts/rook-ceph-cluster/charts/library/templates/_cluster-role.tpl to justify the changes quite a bit.

Signed-off-by: Ben Gao <bengao168@msn.com>
(cherry picked from commit 84296a997ae0b8bf008e08e534748f7608992299)
external: dont do rgw validation if python version < 3

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit def9fd9056013be53dedd4c38ead34706aa49521)
csi: add default version to images if it is missing

Rook will now append internal default versions to custom
csi image variables passed down if version is missing in
them.
This will enable users using their private registries to
just pass different image names while rook takes care
of adding default versions to them.

Resolves:

Signed-off-by: Rakshith R <rar@redhat.com>
(cherry picked from commit 12fd87f40b33b687109a211bcf6ab60b151090e5)
core: fix CephFS status updates

CephFS object fails to do a initial status update.
Operator shows the following error message in logs,

'Error while updation: Operation cannot be fulfilled on
cephfilesystems.ceph.rook.io ""myfs"": the object has been
modified; please apply your changes to the latest version
and try again'

Function 'updateStatus' now returns the new/updated
CephFilesystem object if successfully updated or nil.

Signed-off-by: Arun Kumar Mohan <amohan@redhat.com>
(cherry picked from commit 7e87c67536917a0ea6f0dbe3b18e54d34ff64f4c)
docs: add export path example for NFS CSI

Add an example of getting the export path for an NFS PVC to the NFS CSI
docs.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 935b1375900e9b72eb364383e2b1eb0289e398d9)
operator: fix webhook loggin during deletion

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 30f21e4e7f41fda0d556aa017ad3daab2bd34d1b)
docs: fix lint error in doc generating python code

The latest python black stable release started flagging a newline
between a function `def` and the function body. Remove said newline.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 19fb3869903c6a6534beab8160698bc8e95dd14c)
helm: document installing different types of CephClusters

currently helm has only the config of cephclusterSpec
for a converged cluster, document installing pvc based,
strech based , external based cluster

Closes: https://github.com/rook/rook/issues/11480
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 20d7c00f60287b2431c50abb2c13731bd48cca9e)
docs: fix formatting issues

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit 8b6dbdc14d27b83cd4740fd217c58fecfc8605f3)
docs: fixing build instructions

Adding instructions to fetch the tags as they are used during
the build process. The current instructions only require the
user to clone the project which results in build errors later
on.

Closes: https://github.com/rook/rook/issues/11619
Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit bf15617b7ffb7b4e84faf3021a7ee901a2e5e01f)
mds: support mds with multus

to support mds with multus, we don't need
to add `--public-adr`, if multus is selected as
the network in cephCluster CR.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit a1a127f6ba7068b18f93d542272440732e51facb)
docs: add glossary page

Signed-off-by: gauravsitlani <gauravsitlani@riseup.net>
(cherry picked from commit 71c5969758f3db85a7582a9bc72f3e1bbdddbb43)
test: change ceph version of osd on pvc canary test to avoid failures

This is to fix the following CI failure.

ci: Canary tests on PVCs are failing when creating OSDs
https://github.com/rook/rook/pull/11600

We set the version of Ceph used for OSD on PVC to v16. It's the moving
target and was recently changed the target version. The new version
has a regression which results in the failure
of `ceph-volume raw prepare`. Although this will be fixed in Ceph
by the following PR, it's not backported to Quincy yet.

ceph-volume: fix a bug in lsblk_all()
https://github.com/ceph/ceph/pull/49171

Let's change the version to v17.2.3, which is the latest version
without the above-mentioned regression of Ceph.

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit f19c77a6fbc564b2727120989b89bc326ebef3fa)
helm: add labels and annotations to config overrides configmap

The default configmap does not have any labels or annotations
applied. If the helm chart is later updated to configure the
ceph config overrides, the configmap will fail to be created
by the chart since it doesn't have the needed label and helm
annotations so helm will know it can take over the resource
management.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit ab3209c1401d2f6b4ec2d08a5bcb438f584f86a0)
rgw: handle insecure flag skip for object bucket notification in the tls config

Signed-off-by: Liang Zheng <zhengliang0901@gmail.com>
(cherry picked from commit c0c4c3033455cdf7c4dfe34e3287abf1188db16c)
build: update the release version to v1.10.11

For the patch release update the docs and example manifests to
v1.10.11

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.10.11 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
rgw: Handle insecure flag skip for object bucket notification in the tls config (, @microyahoo)
operator: Fix webhook logging during deletion (, @subhamkrai)
helm: Add labels and annotations to config overrides configmap (, @travisn)
ci: Change ceph version of osd on pvc canary test to avoid failures (, @satoru-takeuchi)
mds: Support the Shared filesystem with multus (, @subhamkrai)
docs: Add glossary page (, @gauravsitlani)
docs: Add export path example for NFS CSI (, @BlaineEXE)
file: Retry CephFS Status updates (, @aruniiird)
csi: add default version to images if it is missing (, @Rakshith-R)
external: Skip RGW validation for python version 2 (, @parth-gr)
mgr: Add patch verb to RBAC for completing ceph requests in orch module (, @gaord)"
"core: unset all encryption configuration before setting

if the configuration is already set in the ceph
database, using `ceph config assimilate-conf`
will add the key and value if its missing but
it wont update the value if the key is already
present, To fix this problem we can remove the
key and add all the configurations once again.

Signed-off-by: Madhu Rajanna <madhupr007@gmail.com>
(cherry picked from commit 1139cefc94fa7a646f14fbbcf9f43468cdb1693b)
docs: update documentation for CRDs

update generation of documents for CRDs automatically

Signed-off-by: Javier <sjavierlopez@gmail.com>
(cherry picked from commit 4ef2c43b5557d5c40b4c42268b4b29e7ef9b14ee)
operator: fix package logger name for rookcli

Name was accidentally modified in PR.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit d38d4d7d1e7d44fd1c70aff2d0dcdc332832c1ba)
external: fix rgw multisite config check

the check validate_rgw_multisite was always checking for realm
updated it to check the specific config

fixed validate_rgw_endpoint pool validation

added missing realm zonegroup and zone while interacting with user resources

Co-authored-by: Sergio Pérez Fernández <sergioperez794@gmail.com>
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit c50c308abea7068545bfdf50ab52341b45371bb7)
operator: validate multus validation networks in cli

Even though this is validated in the validation process, validating in
the cli gives better user feedback and doesn't spam the user with
suggestions for the failure that aren't relevant.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 60bf33f39c6855368ec08dd3114d9a7a267424d0)
osd: allow to use filter device

this feature is to allow the use of filters using the deviceFilter flag
by skipping devices that do not match the filter

Closes:
Signed-off-by: Javier <sjavierlopez@gmail.com>
(cherry picked from commit 884d5e985545aecf9ad7a4c1d93cac651e3f888b)
test: increase integration-test timeout

increase timeouts in order to allow to have ready all the resources and
avoid failures in some pipelines due timeout

Closes:
Signed-off-by: Javier <sjavierlopez@gmail.com>
(cherry picked from commit cd711414bbd552837d1d10a04417b8a1a2208ce7)
operator: use KUBECONFIG context for cli if present

Use contents of KUBECONFIG var for creating Kubernetes client interface
if its present. This allows running rook CLI commands locally for
quicker development iteration.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit b72761c1a1974fd1fe00e3ac4522b3b464192ad1)
core: disable controller runtime metrics server

As we are not using the controller runtime
metrics we dont even need to start the server
as its just uses extra resouces and its not
much useful.

Signed-off-by: Madhu Rajanna <madhupr007@gmail.com>
(cherry picked from commit 6f30700f5e9c5f58fb4cfbd5686bf3ce37695bc8)
mgr: using dynamic mgr_role label to implement mgr HA

Closes: https://github.com/rook/rook/issues/11844

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit f00bd790a89ad9d81d7a3fc7810b8aed21bd679e)
mgr: default to active mgr label

The active and standby labels are updated on the mgr pods
by the mgr sidecar. In the case of a single mgr, there is
not sidecar, so the dashboard and other mgr services were
not available when there was a single mgr. Now the mgr
pod will default to the active mgr status label so that
the single mgr case will succeed. In the case of two mgrs,
the sidecar will immediately update the standby mgr to
remove the active status label.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 1fa3c5ae183383a411a0cfc325038459b4142989)
monitoring: configurable option to disable prometheus metrics

The prometheus mgr module and ceph exporter can now be optionally
disabled by the monitoring.metricsDisabled setting in the
CephCluster CR. These will not be disabled by default, rather
than the mgr module being disabled by default from v1.11.4.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 92a0ab37e3c19b444ab64dd4a80875883834f68a)
helm: servicemonitor for rook-ceph csi drivers

the ServiceMonitor depends on:
* monitoring.enabled (availability of prometheus-operator)
* csi.serviceMonitor.enabled, to create the ServiceMonitor
* csi.enableGrpcMetrics and csi.enableLiveness to enable their
  respective endpoints in the ServiceMonitor

Signed-off-by: Cyril Jouve <jv.cyril@gmail.com>
(cherry picked from commit 6b0a8cadfc4fcfb51f6f60937563f0128e7e12d7)
core: add termination grace period for exporter pods

Shorten the termination time for exporter pod before it
gets deleted to avoid crashing of pod.
Signed-off-by: avanthakkar <avanjohn@gmail.com>
(cherry picked from commit 8a8eb863d0465209c366cdeb36f95cd489a5480f)
monitoring: no service monitor by default for exporter

The exporter is enabled by default, but the service monitor
can only be enabled if prometheus CRDs are available. The
monitoring.enabled must be set to true as the flag that
prometheus is available and the service monitor should
be created.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit 1b80767877ecff1772d5c733367ecd16b0f1a29e)
docs: update ruleNamesapce to rulesNamespaceOverride

there were some places where rulenamesapce was present updated to rulesNamespaceOverride

Closes: rook
Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 060bd00281172e4763c3c3cb14cc421d78d2b01e)
external: fix rgw check if no multisite flag is passed

if there is no multisite config pass, it will still checks for
the zones and zones group and not able to query anything

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit ec2681f82b0d9767283140113a73b79ce7740a13)
osd: supoprt expand lvm osd on pvc

The expansion of OSD on PVC is only supported in raw mode OSD.
It's nice to support lvm mode osd too.

Closes: https://github.com/rook/rook/issues/10835

Signed-off-by: Satoru Takeuchi <satoru.takeuchi@gmail.com>
(cherry picked from commit 13e4464fed972069c0dacfad562545532666dbbf)
build: update release version to v1.11.6

For the patch release update the docs and example manifests
to v1.11.6

Signed-off-by: travisn <tnielsen@redhat.com>","Improvements
Rook v1.11.6 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
osd: Support expanding lvm osd on pvc (, @satoru-takeuchi)
monitoring: Skip creating the service monitor for the exporter if monitoring is not enabled (, @travisn)
docs: Generate documentation for CRDs (, @Javlopez)
core: Add termination grace period for exporter pods (, @avanthakkar)
csi: servicemonitor for rook-ceph csi drivers (, @jouve)
monitoring: Configurable option to disable prometheus metrics (, @travisn)
mgr: Default to active mgr label if only one mgr is running (, @travisn)
osd: Allow scanning devices with filter (, @Javlopez)
core: Disable controller runtime metrics server (, @Madhu-1)
mgr: Use mgr_role dynamic label to tag the active ceph manager (, @rkachach)
operator: use KUBECONFIG context for cli if present (, @BlaineEXE)
external: fix rgw multisite config check (, @parth-gr)
operator: validate multus validation networks in cli (, @BlaineEXE)
operator: Fix package logger name for rookcli (, @BlaineEXE)
ceph: Unset the encryption configuration before updating the setting (, @Madhu-1)"
"core: on crash pod ensure rook version label is not set

ceph crash pod gets rook version label added unintentionally, which is only for deployment label.
changes include:
1, make a copy of the labels for pod spec from deployment labels just before adding rook version label.
2, add unit test to make sure it works as designed.
This fix along with pr 11674 is to stop ceph daemons pod restarting unnecessarily after upgrading rook operator.

Signed-off-by: Ben Gao <bengao168@msn.com>
(cherry picked from commit ed6ed25257364f81ce9176123b6cb1bd9f85c368)
osd: add container ports only if mcs is enabled

Add container ports for OSD container only when multi cluster service is
enabled in the cluster spec.

Signed-off-by: sp98 <sapillai@redhat.com>
(cherry picked from commit 12bbc9b1a8a1eb20bba09ad5a602c98f73db6b46)
docs: change old version hint in docs

Resolves https://github.com/rook/rook.github.io/issues/144

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit a5131d730906ef652f2f8bb3ee0501985b589ddb)
file: check if fs exists before checking dependencies

Signed-off-by: zhucan <zhucan.k8s@gmail.com>
(cherry picked from commit 46c2bef9bc30cadd392a8a2478f913057ad63e8a)
external: add realm support for external cluster

if a cluster won't use the deafult realm and try to
execute the python script it will fail to vaildate rgw
as the rgw-admin-user would be created on default realm
So creating user in specific realm if the realm name is passed

Signed-off-by: parth-gr <paarora@redhat.com>
(cherry picked from commit 96ea7817f8160067788bf71c844da378c9775d11)
object: make OBC genUserID unique across clusters

Rook's implementation of OBC's GenerateUserID could generate colliding
user IDs for multisite clusters where each site is configured with the
same namespace/name of CephObjectStore. Add the Ceph cluster FSID to the
generated name to ensure the names won't conflict for multiple sites.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 2733375ca4effcb4a5132aaf5471cd837bde9b2c)
ci: fix multus ci

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit d983f3620e97ab360e476b16d462fe617173a4f8)
manifest: fix whitespace issues

Signed-off-by: gauravsitlani <gauravsitlani@riseup.net>
(cherry picked from commit 75ec7bffc0980224461bf146894d2256f3c2242c)
docs: fix documentation indentation

It seems that this `deviceFilter` list item is indented too far.

This PR deindents it one level.

Signed-off-by: AJ Schmidt <ajs4392@gmail.com>
(cherry picked from commit da0ed4d21f96ed1e5fd7cc6ba5a9c039c3723f23)
ci: fix fs multicluster mirroring

Signed-off-by: gauravsitlani <gauravsitlani@riseup.net>
(cherry picked from commit 88df0d879408df5a7e047b6140df0c8a6a80226d)
monitoring: remove alerts that don't apply to rook

When the alerts were updated from the ceph repo, the cephadm
alerts were removed, now we also remove two other alerts that
don't apply to rook clusters. The pool growth warning alert
and prometheus job missing alerts need to be removed
as also seen in https://github.com/rook/rook/pull/10109.

Signed-off-by: travisn <tnielsen@redhat.com>
(cherry picked from commit fd25eeecf129debc7c3a457e5171d9c42938d19d)
Revert ""mgr: wait for the mgr pod to be running""

This reverts commit 4d1017f80508c227f8955d0cf8063b43ebe4690b.

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit c31832095d23f579400183d4f8a79b16d3a0b9e6)
Revert ""ci: fix MultiClusterDeploySuite CI""

This reverts commit b4644289783a437241fea4eaac7906ea11a1ce85.

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit 0c652d28e2809e4228dd161c739861cc440357d1)
Revert ""mgr: addressing review comments""

This reverts commit 9f37439a07b7d6ffed668ea93d096460155baffb.

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit adc79d4ee412388d23114a602cd4228746087956)
Revert ""mgr: remove mgr sidecar""

This reverts commit ff75ec96b7af164027da51bd8e865a8247ff9000.

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit 456a0c328c25f44170727936219cfa75dbcbaa58)
Revert ""mgr: use k8s readiness probe to implement mgr HA""

This reverts commit dc76f81feaf3bc7a2a87f2cdbe006355050a14a9.

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit 0ae7867dd1e19b1ca3e8d6d63d68d2957d8795e9)
core: add env var to exporter for ceph config

The exporter requires the mon config and keyring.
Use the CEPH_ARGS env var to specify the config
instead of expecting a ceph.conf to be generated
by another component on the host path.

Co-Authored-By: Travis Nielsen <tnielsen@redhat.com>
Signed-off-by: Avan Thakkar <athakkar@redhat.com>
(cherry picked from commit b6013d9b11208046e63f6f1a80acb0df5a1383c1)
build: update release version to v1.11.1

For the patch release the examples and docs are updated
to v1.11.1

Signed-off-by: travisn <tnielsen@redhat.com>","Improvements
Rook v1.11.1 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
ceph: Fix host networking by only adding OSD ports when required for multi-cluster config (, @sp98)
core: Ceph exporter requires ceph config where OSDs are not running (, @avanthakkar)
monitoring: Remove prometheus alerts that don't apply to rook (, @travisn)
mgr: Revert readiness probe and go back to the original sidecar HA implementation (, @rkachach)
manifest: Align whitespace in example cluster.yaml (, @gauravsitlani)
external: Add realm support for external cluster (, @parth-gr)
object: Make OBC genUserID unique across clusters (, @BlaineEXE)
file: Check if a filesystem exists before checking dependencies during deletion (, @zhucan)
core: On crash pod ensure rook version label is not set (, @gaord)"
"ceph: updating the dependencies for operator SDK v1.0.0

Updating the dependencies' versions to match with the newer Operator SDK
version v1.x

Signed-off-by: Arun Kumar Mohan <amohan@redhat.com>
(cherry picked from commit 421f340c1c82960d3bc8f2ddafabe76ddb4d7ae3)
ceph: changes made by running `make codegen` target

Signed-off-by: Arun Kumar Mohan <amohan@redhat.com>
(cherry picked from commit 9ff98995a3d433371856c6a5681ee333b2c489e2)
ceph: manual changes needed for kubernetes api updates

Fetched latest lib-bucket-provisioner changes as well.

Signed-off-by: Arun Kumar Mohan <amohan@redhat.com>
(cherry picked from commit 65d16bfc946750b83d4ff5f61535e46fdce07db5)
ceph: changes for 'sigs.k8s.io/sig-storage-lib-external-provisioner/v6'

Signed-off-by: Arun Kumar Mohan <amohan@redhat.com>
(cherry picked from commit ded16f779d78d95ddb8704045646566ef6cbb3cc)
ceph: changes after the latest multus CSI updates

Signed-off-by: Arun Kumar Mohan <amohan@redhat.com>
(cherry picked from commit f5fc08b8e603f2416a619ea24c5435c6e992f2b5)
ceph: apply finalizer before updating object status

We must add the finalizer right after the object creation otherwise the
seerver will later return an error on update that the object has been
modified. Indeed, it has been by the task that updates the status when
the object is first created.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 97be23e3745d151cbaa02fb0fc4d06bc9b6a7451)
ceph: remove ""createInstance"" function

Since we moved to the controller-runtime, events are processed one by
one and so are reconciles. This means we won't have multiple
orchestrations happening at the same time. Thus removing this code.

Also removing one unused variable.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 10dd8e118499860fd92e39582f3ebab153433ea2)
ceph: export isDoNotReconcile function

Since the predicate for the CephCluster object will soon move into its
own predidacte we need to export isDoNotReconcile so that it can be
consummed by the ""cluster"" package.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 9b9f45b7927a5ea7d6811534f54bdbcfdf671092)
ceph: add dedicated predicate for CephCluster object

Since we want to pass a context to it, let's extract the logic into its
own predicate.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 70c6752e0e927b794aad0c40780451a5c2787d81)
ceph: ability to abort orchestration

We can now prioritize orchestrations on certain event. Today only two
events will cancel on-going orchestrations (if any):

* request for cluster deletion
* request for cluster upgrade

If one of the two are caught by the watcher we will cancel the on-going
orchestration.
For that we implemented a simple approach based on check points, where
we will check for a cancellation request in certain part of the
orchestration. Mainly before each mons/mgr/osds orchestration loops.

This solution is not perfect, but we are waiting for the
controller-runtime to release its 0.7 version which will embed context
support. With that we will be able to cancel reconciles more precisely
and rapidly.

Operator log example:

```
2020-11-24 13:54:59.499719 I | op-mon: parsing mon endpoints: a=10.109.126.120:6789
2020-11-24 13:54:59.499719 I | op-mon: parsing mon endpoints: a=10.109.126.120:6789
2020-11-25 12:59:12.986264 I | ceph-cluster-controller: done reconciling ceph cluster in namespace ""rook-ceph""
2020-11-25 13:07:33.776947 I | ceph-cluster-controller: CR has changed for ""rook-ceph"". diff=  v1.ClusterSpec{
        CephVersion: v1.CephVersionSpec{
                Image:            ""ceph/ceph:v15.2.5"",
-               AllowUnsupported: true,
+               AllowUnsupported: false,
        },
        DriveGroups: nil,
        Storage:     {UseAllNodes: true, Selection: {UseAllDevices: &true}},
        ... // 20 identical fields
  }
2020-11-25 13:07:33.777039 I | ceph-cluster-controller: reconciling ceph cluster in namespace ""rook-ceph""
2020-11-25 13:07:33.785088 I | op-mon: parsing mon endpoints: a=10.107.242.49:6789,b=10.109.71.30:6789,c=10.98.93.224:6789
2020-11-25 13:07:33.788626 I | ceph-cluster-controller: detecting the ceph image version for image ceph/ceph:v15.2.5...
2020-11-25 13:07:35.280789 I | ceph-cluster-controller: detected ceph image version: ""15.2.5-0 octopus""
2020-11-25 13:07:35.280806 I | ceph-cluster-controller: validating ceph version from provided image
2020-11-25 13:07:35.285888 I | op-mon: parsing mon endpoints: a=10.107.242.49:6789,b=10.109.71.30:6789,c=10.98.93.224:6789
2020-11-25 13:07:35.287828 I | cephclient: writing config file /var/lib/rook/rook-ceph/rook-ceph.config
2020-11-25 13:07:35.288082 I | cephclient: generated admin config in /var/lib/rook/rook-ceph
2020-11-25 13:07:35.621625 I | ceph-cluster-controller: cluster ""rook-ceph"": version ""15.2.5-0 octopus"" detected for image ""ceph/ceph:v15.2.5""
2020-11-25 13:07:35.642688 I | op-mon: start running mons
2020-11-25 13:07:35.646323 I | op-mon: parsing mon endpoints: a=10.107.242.49:6789,b=10.109.71.30:6789,c=10.98.93.224:6789
2020-11-25 13:07:35.654070 I | op-mon: saved mon endpoints to config map map[csi-cluster-config-json:[{""clusterID"":""rook-ceph"",""monitors"":[""10.107.242.49:6789"",""10.109.71.30:6789"",""10.98.93.224:6789""]}] data:a=10.107.242.49:6789,b=10.109.71.30:6789,c=10.98.93.224:6789 mapping:{""node"":{""a"":{""Name"":""minikube"",""Hostname"":""minikube"",""Address"":""192.168.39.3""},""b"":{""Name"":""minikube"",""Hostname"":""minikube"",""Address"":""192.168.39.3""},""c"":{""Name"":""minikube"",""Hostname"":""minikube"",""Address"":""192.168.39.3""}}} maxMonId:2]
2020-11-25 13:07:35.868253 I | cephclient: writing config file /var/lib/rook/rook-ceph/rook-ceph.config
2020-11-25 13:07:35.868573 I | cephclient: generated admin config in /var/lib/rook/rook-ceph
2020-11-25 13:07:37.074353 I | op-mon: targeting the mon count 3
2020-11-25 13:07:38.153435 I | op-mon: checking for basic quorum with existing mons
2020-11-25 13:07:38.178029 I | op-mon: mon ""a"" endpoint is [v2:10.107.242.49:3300,v1:10.107.242.49:6789]
2020-11-25 13:07:38.670191 I | op-mon: mon ""b"" endpoint is [v2:10.109.71.30:3300,v1:10.109.71.30:6789]
2020-11-25 13:07:39.477820 I | op-mon: mon ""c"" endpoint is [v2:10.98.93.224:3300,v1:10.98.93.224:6789]
2020-11-25 13:07:39.874094 I | op-mon: saved mon endpoints to config map map[csi-cluster-config-json:[{""clusterID"":""rook-ceph"",""monitors"":[""10.107.242.49:6789"",""10.109.71.30:6789"",""10.98.93.224:6789""]}] data:a=10.107.242.49:6789,b=10.109.71.30:6789,c=10.98.93.224:6789 mapping:{""node"":{""a"":{""Name"":""minikube"",""Hostname"":""minikube"",""Address"":""192.168.39.3""},""b"":{""Name"":""minikube"",""Hostname"":""minikube"",""Address"":""192.168.39.3""},""c"":{""Name"":""minikube"",""Hostname"":""minikube"",""Address"":""192.168.39.3""}}} maxMonId:2]
2020-11-25 13:07:40.467999 I | cephclient: writing config file /var/lib/rook/rook-ceph/rook-ceph.config
2020-11-25 13:07:40.469733 I | cephclient: generated admin config in /var/lib/rook/rook-ceph
2020-11-25 13:07:41.071710 I | cephclient: writing config file /var/lib/rook/rook-ceph/rook-ceph.config
2020-11-25 13:07:41.078903 I | cephclient: generated admin config in /var/lib/rook/rook-ceph
2020-11-25 13:07:41.125233 I | op-mon: deployment for mon rook-ceph-mon-a already exists. updating if needed
2020-11-25 13:07:41.327778 I | op-k8sutil: updating deployment ""rook-ceph-mon-a"" after verifying it is safe to stop
2020-11-25 13:07:41.327895 I | op-mon: checking if we can stop the deployment rook-ceph-mon-a
2020-11-25 13:07:44.045644 I | op-k8sutil: finished waiting for updated deployment ""rook-ceph-mon-a""
2020-11-25 13:07:44.045706 I | op-mon: checking if we can continue the deployment rook-ceph-mon-a
2020-11-25 13:07:44.045740 I | op-mon: waiting for mon quorum with [a b c]
2020-11-25 13:07:44.109159 I | op-mon: mons running: [a b c]
2020-11-25 13:07:44.474596 I | op-mon: Monitors in quorum: [a b c]
2020-11-25 13:07:44.478565 I | op-mon: deployment for mon rook-ceph-mon-b already exists. updating if needed
2020-11-25 13:07:44.493374 I | op-k8sutil: updating deployment ""rook-ceph-mon-b"" after verifying it is safe to stop
2020-11-25 13:07:44.493403 I | op-mon: checking if we can stop the deployment rook-ceph-mon-b
2020-11-25 13:07:47.135524 I | op-k8sutil: finished waiting for updated deployment ""rook-ceph-mon-b""
2020-11-25 13:07:47.135542 I | op-mon: checking if we can continue the deployment rook-ceph-mon-b
2020-11-25 13:07:47.135551 I | op-mon: waiting for mon quorum with [a b c]
2020-11-25 13:07:47.148820 I | op-mon: mons running: [a b c]
2020-11-25 13:07:47.445946 I | op-mon: Monitors in quorum: [a b c]
2020-11-25 13:07:47.448991 I | op-mon: deployment for mon rook-ceph-mon-c already exists. updating if needed
2020-11-25 13:07:47.462041 I | op-k8sutil: updating deployment ""rook-ceph-mon-c"" after verifying it is safe to stop
2020-11-25 13:07:47.462060 I | op-mon: checking if we can stop the deployment rook-ceph-mon-c
2020-11-25 13:07:48.853118 I | ceph-cluster-controller: CR has changed for ""rook-ceph"". diff=  v1.ClusterSpec{
        CephVersion: v1.CephVersionSpec{
-               Image:            ""ceph/ceph:v15.2.5"",
+               Image:            ""ceph/ceph:v15.2.6"",
                AllowUnsupported: false,
        },
        DriveGroups: nil,
        Storage:     {UseAllNodes: true, Selection: {UseAllDevices: &true}},
        ... // 20 identical fields
  }
2020-11-25 13:07:48.853140 I | ceph-cluster-controller: upgrade requested, cancelling any ongoing orchestration
2020-11-25 13:07:50.119584 I | op-k8sutil: finished waiting for updated deployment ""rook-ceph-mon-c""
2020-11-25 13:07:50.119606 I | op-mon: checking if we can continue the deployment rook-ceph-mon-c
2020-11-25 13:07:50.119619 I | op-mon: waiting for mon quorum with [a b c]
2020-11-25 13:07:50.130860 I | op-mon: mons running: [a b c]
2020-11-25 13:07:50.431341 I | op-mon: Monitors in quorum: [a b c]
2020-11-25 13:07:50.431361 I | op-mon: mons created: 3
2020-11-25 13:07:50.734156 I | op-mon: waiting for mon quorum with [a b c]
2020-11-25 13:07:50.745763 I | op-mon: mons running: [a b c]
2020-11-25 13:07:51.045108 I | op-mon: Monitors in quorum: [a b c]
2020-11-25 13:07:51.054497 E | ceph-cluster-controller: failed to reconcile. failed to reconcile cluster ""rook-ceph"": failed to configure local ceph cluster: failed to create cluster: CANCELLING CURRENT ORCHESTATION
2020-11-25 13:07:52.055208 I | ceph-cluster-controller: reconciling ceph cluster in namespace ""rook-ceph""
2020-11-25 13:07:52.070690 I | op-mon: parsing mon endpoints: a=10.107.242.49:6789,b=10.109.71.30:6789,c=10.98.93.224:6789
2020-11-25 13:07:52.088979 I | ceph-cluster-controller: detecting the ceph image version for image ceph/ceph:v15.2.6...
2020-11-25 13:07:53.904811 I | ceph-cluster-controller: detected ceph image version: ""15.2.6-0 octopus""
2020-11-25 13:07:53.904862 I | ceph-cluster-controller: validating ceph version from provided image
```

Closes: https://github.com/rook/rook/issues/6587
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit ad24990473a876ba014b11ef61f8d63d46190ec0)
ceph: fix metadata device passed by-id

The code was assuming that devices were passed by the user as
""/dev/sda"", this is bad! We all know people should be using paths like
/dev/disk/by-id so we must support them.

Closes: https://github.com/rook/rook/issues/6685
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 5d9612c2ae3539f5a135c6b5f555ced1a4ddc135)
ceph: fix pod labels set on csi components

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit b04f88237218582efa9b6ceefd1706c755e99a3b)
ceph: ignore unscheduled ceph daemons while cleaning up

Before cleaning up the cluster, we wait for all the daemon pods to be cleaned up. This fails when
a daemon is in pending state and has no NodeName. This PR ignores daemon pods that are not scheduled on any node.

Signed-off-by: Santosh Pillai <sapillai@redhat.com>
(cherry picked from commit 753bdb3526ab56e6c6ce51215a6b97099bda7df9)
core: fix label merge

This makes it so the label merging function returns a new Labels object
with the merged content instead of modifying the existing one, which
would cause previously merged labels to be returned for a different set
of input labels.

Signed-off-by: Alexander Trost <galexrt@googlemail.com>
(cherry picked from commit 48d21947c2fade80c943cc666973f6559cb4c242)
ceph: use debug message for snap schedule

We don't need to print this every 60s in the operator log.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit aca5a8cc5347e5d273ceaf86eb1f2e8bd373bd3d)
ceph: update examples and base image to v15.2.7

With the release of the latest octopus v15.2.7 we update the base
of the operator image and set the examples to use the same release
to pick up the security and other bug fixes.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 0a35a08f2fe582ea17a09d24ed2b948e633feaec)
ceph: add log collector

We can now collect logs directly into a side-car container.
A new CRD spec has been added:

spec:
  logCollector:
    enabled: true
    periodicity: 24h

Every 24h we will rotate log files for each Ceph daemon.

Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit c6a87203ca50d3e95ba413ae5cd98dddc323eadc)
docs: update vault kms integration doc

correct the name policy mentioned

Signed-off-by: Jiffin Tony Thottan <jthottan@redhat.com>
(cherry picked from commit a92a58e23eab6ace8cb55c99a143a4929c47e550)
ceph: add more debug logging to obj bucket claims

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit e75dcac8a3555e2ba7439bddcace6f1c80e96800)
ceph: rgw service selector should not change

If the selector changes on the rgw service, during upgrade the
clients will briefly not be able to connect to the rgw pods.
After all the pods are updated with any new labels, the connections
would be restored, but we want to avoid that temporary outage.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 8913a14ce4fc22fe3d2824116b2e31bf31fc80ec)
ceph: include csi by default in the csv

It has been a couple of releases since we started deploying Rook along
with Ceph-CSI by default. So let's include Ceph-CSI natively in our CSV
generation.

Closes: https://github.com/rook/rook/issues/6659
Signed-off-by: Sébastien Han <seb@redhat.com>
(cherry picked from commit 9a5421f53ae3c9911beb61a76a1c17e49abb6d0e)
ceph: update object bucket provisioner library

The library for object bucket provisioning is updated to fix errors
during provisioning.

Signed-off-by: Blaine Gardner <blaine.gardner@redhat.com>
(cherry picked from commit 3b4ee6c8e3af5fe5f2a5f27fca1e045da7e319e8)
build: update manifest versions to v1.5.2 for the release

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","v1.5.2 is taken down due to a potential data loss with OBCs in
Improvements
Rook v1.5.2 is a patch release limited in scope and focusing on small feature additions and bug fixes.
Ceph
Enable collecting Ceph logs from the host in case the pods restarted multiple times (, @leseb)
Support OSD metadata device passed by-id (, @leseb)
Ability to abort and restart orchestration when the cluster CR is modified (, @leseb)
Object bucket provisioning error handling (, @BlaineEXE)
Object workloads failed briefly during Rook upgrades until RGW pods updated (, @travisn)
Update Ceph manifests and operator base image to v15.2.7 (, @travisn)
Avoid duplicate labels when merging custom labels (, @galexrt)
Properly apply custom labels on CSI components (, @galexrt)
Uninstall cleanup ignores pending Ceph daemon pods (, @sp98)
Update the Controller Runtime version to 0.6 (, @aruniiird)"
"core: fix missing env in svg cleanup job

SVG cleanup job uses the cephSubvolumeGroup env name
from spec.Name. But sometimes it can be empty. In that
case rook should use the CR name.

Signed-off-by: sp98 <sapillai@redhat.com>
(cherry picked from commit 33ce8f0c8e31ba7f5acf24c7854465ff32eca437)
core: remove owner refs in resource cleanup jobs

Removed owner reference from Radosnamespace and
subVolumeGroup cleanup resources.

Signed-off-by: sp98 <sapillai@redhat.com>
(cherry picked from commit c98fc8691881a9af1a077df923ef6544c7c5de3d)
docs: document how to have StorageClass consume Rados Namespace

closes: https://github.com/rook/rook/issues/13214

Co-authored-by: Travis Nielsen <tnielsen@redhat.com>
Co-authored-by: Blaine Gardner <b.blaine.gardner@gmail.com>
Signed-off-by: Michael Adam <obnox@samba.org>
(cherry picked from commit 8e7ac95f9747e926d483e860b9323e4748dde0ff)
docs: fix broken link to network config

Signed-off-by: NymanRobin <robin.nyman@est.tech>
(cherry picked from commit 30e6a7349b4cee037247f3634631b4c0701e7bf1)
mon: fix bind addr when IPv6 and msgr2 are enabled

When IPv6-only network mode is enabled and when mons are configured to
listen only on msgrV2 port, Rook has to add the port to the mon
--public-bind-addr in order to force mons to stop listening on the
msgrV1 port. This can cause problems for IPv6 clusters where adding
':<port>' to the end of an IP addr looks like a valid IPv6 address.

In IPv6 mode, Rook needs to set this to '[<ip>]:<port>' with the
brackets to be a non-ambiguous IPv6 address.

In IPv4 mode, Rook needs to keep its existing behavior. IPv4 mode should
also continue to be the defualt assumption if the network config isn't
specified.

If 'dualStack: true' is specified, Rook is informed that the environment
is dual stack, but Rook doesn't know which IP family to expect from the
pod IP. In this scenario, it is safest for Rook not to apply the port,
since assuming either IPv4 or IPv6 format could be incorrect. In this
scenario, mons may still listen on msgrV1 ports, but this is preferable
to an environment where mons perpetually crash.

Signed-off-by: Blaine Gardner <blaine.gardner@ibm.com>
(cherry picked from commit 573a47e736979c7e604eb0536084668bf21efec7)
ci: fix codespell ci by skipping some words

fixing 'secert' to `secret` and adding workds like
`NotIn, addin` to skip work list.

Signed-off-by: subhamkrai <srai@redhat.com>
(cherry picked from commit 85c25bbc6eb07c356970b8e75212b6224cb6d517)
osd: reduce safe-to-destroy retry timeout to 15s

This reduces the safe-to-remove retry interval from 1m to 15s.

Closes

Signed-off-by: Brian Dowling <bjd-dev@simplicity.net>
(cherry picked from commit ef0ed93134267f7b5dbe852fabb58ad028f506eb)
docs: add a note for NixOS and containerd

Add a note to remove LimitNOFILE setting in containerd service configuration.

This setting causes multiple issues such as slow `ceph status` commands (and failing healthchecks),
various timeouts, and mons failing/timing out.

Upstream containerd already removed the setting. NixOS hasn't incorporated the change.

This note can be removed once https://github.com/NixOS/nixpkgs/pull/313507 makes it to a stable release.

Signed-off-by: Onur Cakmak <occ@occ.me>
(cherry picked from commit d1e139cdb3b6232a1b9025743d9d30c94cea4825)
mgr: setting balancer mode from cluster spec

This PR adds a `settings` option in the `Module` struct
which can help users to futher customize the `balancer`
module with a differet mode.

Signed-off-by: sp98 <sapillai@redhat.com>
(cherry picked from commit 1ad37ecce9fd4f36cba708ae68465babf455baca)
osd: configure cluster full settings when osds fill up

When the clusters reach full, nearfull, or backfill full thresholds
ceph will raise health warnings and stop allowing IO or backfill
depending on the threshold. These settings require special ceph
commands instead of being generic ceph config. Allow these settings
to be set from the CephCluster CR in the spec.storage
section.

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit e479b051bca142ee3b2352159e22b574240a9acc)
build: set release version to v1.14.5

For the patch release update the examples and documentation
to v1.14.5

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.14.5 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
mon: Fix the bind address when IPv6 and msgr2 are enabled (, @BlaineEXE)
osd: Configure cluster full settings related to OSDs filling up (, @travisn)
core: Remove unnecessary owner refs in resource cleanup jobs (, @sp98)
mgr: Set balancer mode for the balancer mgr module in the CephCluster CR (, @sp98)
osd: Reduce safe-to-destroy retry timeout to 15s (, @bdowling)
docs: Document how to define a StorageClass to consume a RADOS namespace (, @obnoxxx)
core: Fix missing env in subvolume group cleanup job (, @sp98)"
"core: set default ceph version to v18.2.2

With the release of Reef v18.2.2 we update the default
recommended version of Ceph to fix the prometheus issues
seen with v18.2.1

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>
(cherry picked from commit 026d745f8a133f4726a4611199423a84cf0223f5)
exporter: applying labels from monitoring section to ceph-exporter

the labels listed under the 'monitoring' section are currently only
being applied to the rook-ceph-mgr ServiceMonitor. This change extends
those labels to also include the rook-ceph-exporter ServiceMonitor.

Fixes: https://github.com/rook/rook/issues/13774

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit 10e26709c45441352ee9a36a9faa4e5e95fade52)
doc: adding a doc example for ceph-exporter labels

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit ab5b269bc48a3b868b43f125a0d74607e5f4a71c)
monitoring: increasing metrics scraping interval from 5s to 10s

let's increase the monitoring interval to match the default interval
used by Prometheus when deployed by Ceph: 10s

Closes: https://github.com/rook/rook/issues/13883

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit daec93eaaa65add60296a67c8fb3bdde8cbf9350)
monitoring: set metrics scraping interval to 10s in examples files

Signed-off-by: Redouane Kachach <rkachach@redhat.com>
(cherry picked from commit 4b9e77af1e4dff3a890f57042b13f9c8de37f3fc)
build: update release version to v1.13.7

For the patch release update the example manifests and docs
to v1.13.7

Signed-off-by: Travis Nielsen <tnielsen@redhat.com>","Improvements
Rook v1.13.7 is a patch release limited in scope and focusing on feature additions and bug fixes to the Ceph operator.
core: Set default ceph version to v18.2.2 (, @travisn)
monitoring: Increase default metrics scraping interval from 5s to 10s (, @rkachach)
exporter: Apply labels from monitoring section of CephCluster to ceph-exporter (, @rkachach)"
"Update PyPI recipe on github actions
Bump cloudpickle from 1.5.0 to 1.6.0

Bumps [cloudpickle](https://github.com/cloudpipe/cloudpickle) from 1.5.0 to 1.6.0.
- [Release notes](https://github.com/cloudpipe/cloudpickle/releases)
- [Changelog](https://github.com/cloudpipe/cloudpickle/blob/master/CHANGES.md)
- [Commits](https://github.com/cloudpipe/cloudpickle/compare/v1.5.0...v1.6.0)

Signed-off-by: dependabot-preview[bot] <support@dependabot.com>
Bump pytest-xdist from 2.0.0 to 2.1.0

Bumps [pytest-xdist](https://github.com/pytest-dev/pytest-xdist) from 2.0.0 to 2.1.0.
- [Release notes](https://github.com/pytest-dev/pytest-xdist/releases)
- [Changelog](https://github.com/pytest-dev/pytest-xdist/blob/master/CHANGELOG.rst)
- [Commits](https://github.com/pytest-dev/pytest-xdist/compare/v2.0.0...v2.1.0)

Signed-off-by: dependabot-preview[bot] <support@dependabot.com>
Fix plotting single prediction forecast point
Add favicon to docs
Update stallion tutorial","Fixes
Fix bug where predictions were not correctly logged in case of decoder_length == 1.
Additions
Add favicon to docs page"
"Bump pytorch-lightning from 1.0.5 to 1.0.6

Bumps [pytorch-lightning](https://github.com/PyTorchLightning/pytorch-lightning) from 1.0.5 to 1.0.6.
- [Release notes](https://github.com/PyTorchLightning/pytorch-lightning/releases)
- [Changelog](https://github.com/PyTorchLightning/pytorch-lightning/blob/1.0.6/CHANGELOG.md)
- [Commits](https://github.com/PyTorchLightning/pytorch-lightning/compare/1.0.5...1.0.6)

Signed-off-by: dependabot-preview[bot] <support@dependabot.com>
Bump matplotlib from 3.3.2 to 3.3.3

Bumps [matplotlib](https://github.com/matplotlib/matplotlib) from 3.3.2 to 3.3.3.
- [Release notes](https://github.com/matplotlib/matplotlib/releases)
- [Commits](https://github.com/matplotlib/matplotlib/compare/v3.3.2...v3.3.3)

Signed-off-by: dependabot-preview[bot] <support@dependabot.com>
Improved model and data docs
Bump sphinx from 3.3.0 to 3.3.1

Bumps [sphinx](https://github.com/sphinx-doc/sphinx) from 3.3.0 to 3.3.1.
- [Release notes](https://github.com/sphinx-doc/sphinx/releases)
- [Changelog](https://github.com/sphinx-doc/sphinx/blob/3.x/CHANGES)
- [Commits](https://github.com/sphinx-doc/sphinx/compare/v3.3.0...v3.3.1)

Signed-off-by: dependabot-preview[bot] <support@dependabot.com>
Add support for GRU cells in DeepAR
Added tests for DeepAR GRU
Added docstrings to deepar.sub_modules
Run actions based on master and in master
Run tests on forks
Run linters on fork, annotate only master
Fix for timeseries warning
Fix formatting
Bump pytorch-lightning from 1.0.6 to 1.0.7

Bumps [pytorch-lightning](https://github.com/PyTorchLightning/pytorch-lightning) from 1.0.6 to 1.0.7.
- [Release notes](https://github.com/PyTorchLightning/pytorch-lightning/releases)
- [Changelog](https://github.com/PyTorchLightning/pytorch-lightning/blob/1.0.7/CHANGELOG.md)
- [Commits](https://github.com/PyTorchLightning/pytorch-lightning/compare/1.0.6...1.0.7)

Signed-off-by: dependabot-preview[bot] <support@dependabot.com>
Clarify conda installation
Fix: need sequence lengths of pack rnn sequence on CPU
Better KeyError for NaNLabelEncoder
Re-encode group ids by dataset to identify series
Ensure encoding of group ids is only done if needed","Added
Using GRU cells with DeepAR ()
Fixed
GPU fix for variable sequence length ()
Fix incorrect syntax for warning when removing series ()
Fix issue when using unknown group ids in validation or test dataset ()
Run non-failing CI on PRs from forks ()
Docs
Improved model selection guidance and explanations on how TimeSeriesDataSet works ()
Clarify how to use with conda ()
Contributors
JakeForsey"
"Do not print out `remote/HEAD` refs

Note: we filter these in the graph view as well
Decouple branches from their descriptions

We only read and display the descriptions in the dashboard.  We also
need two independent git calls.

Decouple here so we can cache the result of `get_branches` in the store.
Cache `branches` in the store
Suppress upstream if up-to-date with local branch
Stop if HEAD has only semver tags
More versatile parsing of the decoration string
Explicitly handle the empty string case
Spelling
Slight refactor into different functions
Fix status dashboard tests to not throw ugly

They were green actually but the unmocked git calls added noise to the
logs.
Remove unused `reset_cursor` methods

Unused since 1a6d43c7 (Remove `nuke_cursors` argument)
Implement reactive branch dashboard
Cache branch descriptions in the store
Beware nulls in the store and provide defaults
Extract reactive bits into `ui.ReactiveInterface`
Do a deepcopy of the state for later comparison

In the tags dashboard we have a deeper/nested state object.  Prepare for
that and do a deep copy to check for a changed state.
Put `cursor_is_on_something` onto `ui.Interface`
Ensure cursor lands on the active branch for new views

With a cold cache opening a new branches dashboard is too async for
`on_new_dashboard` to makes sense.

Move the cursor fix to the `keep_cursor_on_something` hook instead.
Simplify selectors to navigate the branches dashboard
Add return type annotations to `ui.ReactiveInterface`
Make tags a reactive dashboard
Simplify `gs_tags_navigate_tag`'s selector
Invent proper return type `TagList`
Cache `local_tags` in the store
Cache `remotes` in the store
Directly store `long_status` and `short_status` in the store
Let the status bar subscribe to `short_status`
Remove `short_status` and `long_status` from `WorkingDirState`
Never unpack `status` into the store
Sort branches in python land
Simplify the `__init__`s

We already init in `refresh_view_state`.  We still need to fill in
`show_remotes` as that is set only once (""initially"").
Cleanup state refreshing

Since now all relevant state flows through the store (and we subscribe
to it), it is not necessary to call `update_state` manually.  We get
notified.
Optimize initial status render
Abort less obtrusive for typical runtime errors

Print short, user-friendly error message and traceback for runtime
errors.  These include ""View already detached"" errors, and typically
assertion errors.
Optimize initial tags dashboard render
Centralize initializing the global and local state
Automatically inject state values into the render functions
No null objects just missing keys

With the new status injection we automatically do not render a section
if its dependency is not ready.

In case of multiple dependencies we wait for all of them!
Add types to everything
Do not wait for the branch descriptions

Typically users don't do branch descriptions, and the `branches` we
likely have preloaded.  Hence do not wait for an immediate response.
Move remote tag fetching out of the render phase
Inject more state into `get_remote_tags_list`
Ensure a newline during first render

... before the help and before `remotes` has been populated
Fix remote tags filter

For the remote tags we only show tags we don't already show in the local
section.  We used to compare the `sha`s only here but of course there
can be multiple tags on the same commit.

We construct new tuples here just for the comparison because the local
tags also come with datetimes.  A simple `tag in seen` is therefore
not possible.
Do not clear ""remote_tags"" when hiding the section
Ensure to fetch remote tags after `remotes` has been populated

`maybe_populate_remote_tags` depends on `remotes` so order matters here,
especially for the initial render.
Special mark new and changes tags in the dashboard
Do not write to the state concurrently
Draw markers once all remotes have been fetched

The marks we draw evaluate *all* known remote tags.  Waiting for
settlement prohibits that we draw intermediate results.
Fix `gs_tags_show_graph` not going to annotated tags

For annotated tags we actually show the sha of that tag object in the
dashboard.  This sha is not present in the graph.  Instead of resolving
the commit sha just search for the `tag: ...`.
Clarify when we need a full render

After the hotfix 3266859a (Fix `blame` not rendering anything) we do a
fresh render whenever `regions` becomes empty which is not necessary
(and a bit confusing).  Rewrite that passage for clarity:

We need a full render whenever we have sections not currently drawn;
and also when we haven't drawn any sections at all in the previous
round.  The latter implies `not regions`.

In other words: Instead of `not regions` *or* `not current_region_names`
*and* would have been correct.

Add tests because I did this wrong 3 times now.
Fix navigation to the first section in the inline diff

For the first jumpable region, we try to show the BOF which is only
correct for views that have a header section at the top.

Inline diffs don't and so we shouldn't do anything particular as well.
Note that the historical file view (which is similar in that it shows a
whole file without headers) never did this as well.","This is a follow up to v2.38.0.  Tabbing through the dashboards should now finally be instantaneous.  And the new
recent commits sections had some optics fine tuning. See for a before/after pic,
Some minor fixes in the tags dashboard and a small improvement:  new, unpushed tags now have a * in front of them.
If you see a ! instead it means that sha's between the local and the remote tag do not match.
Fixed also a small scrolling annoyance when navigating an inline diff."
"Improve syntax file parsing

Fixes

For a lot of files `yaml.safe_load` fails if the lib does not support
the used yaml format.  It is also very slow to parse all syntax files.

Since we only use relatively simple information here, t.i. a single
key, we just run a regex and extract the useful information.
Parse "".tmLanguage"" syntax files for ""fileTypes""

Fixes

Note: for the least surprise we first parse the ""tmLanguage"" files,
followed by ""sublime-syntax"" so that the latter overrule the former.

Note: we don't have any way to tell which is the currently preferred
syntax.  We just use the last syntax we iterated over.
Guess the syntax by looking for an open view

Since we cannot actually know the correct syntax just by looking at
our map, we just choose the arbitrary `[-1]` last item, we try harder
to just take the syntax using an open view.

If we ever found such a syntax we also remember this choice.
Normalize paths coming from the status views

In the status view we show short relative paths to a file. These come
from git and thus have always ""/"" as the path separator.

Since we construt absolute paths here, we should also `normpath`.
Fallback to the standard ""markdown"" syntax for the help
Normalize line endings when reading help docs

The help docs are saved with mac line endings. We convert to plain
""\n"" newline characters because that's internally the format Sublime
uses and wants.","Improve syntax selection for the ""inline diff"" (gs_inline_diff) and ""historical file view"" (gs_show_file_at_commit)
Fix: Normalize line endings for ""GitSavvy: Help""
Fix: Reuse diff views when coming from the status dashboard (Windows)"
"Streaming pod count metric, and additionals ()

* Added new metric, and new flow for general metrics for streaming.
Added object properties to simplify adding conditionals.

* Fixed copy-paste issues .... bump version [skip ci]
streaming metrics for stateless pods ()

* removed status, register pod count metric only if a node is stateless

* fix stateType verification for target node

* fix property fetch for object

* removed 'status' from gauge metrics to avoid summing all values when not filtering by status
streaming metrics for stateless pods ()

* removed status, register pod count metric only if a node is stateless

* fix stateType verification for target node

* fix property fetch for object

* removed 'status' from gauge metrics to avoid summing all values when not filtering by status .... bump version [skip ci]
streaming metrics for stateless pods ()

* removed status, register pod count metric only if a node is stateless

* fix stateType verification for target node

* fix property fetch for object

* removed 'status' from gauge metrics to avoid summing all values when not filtering by status .... bump version [skip ci]","What's Changed
add option to specify consumer concurrency by @yehiyam in
update version db.hkube by @zivglik in
add errors to version not last by @zivglik in
test get pod by @zivglik in
add filter time and word name in get logs by @zivglik in
add jobid in worker by @zivglik in
Task execution problems, not fail right away by @golanha in
fix log orderBy to desc by @zivglik in
no create new version if error build by @zivglik in
allow creating a pipeline with no ttl by @golanha in
fix get all data from algo and pipeline by @zivglik in
Convert graphql objects in algo pipeline by @zivglik in
Convert graphql objects in algo pipeline by @zivglik in
update python wrapper to hkube-python-wrapper==2.5.0.dev3 by @hkube-ci in
insert each node version algorithem  after run by @zivglik in
Node version algorithem by @zivglik in
get pods output log path as environment variable by @golanha in
fix save algo with similar file by @zivglik in
Node version algorithem by @zivglik in
fix name keepOldVersions by @zivglik in
fix version to debug by @zivglik in
create version in start updater by @zivglik in
fix download name by @zivglik in
fix api cron promlem cors from ui localhost by @zivglik in
fix name download file  from ui by @zivglik in
fix download file pipeline by @zivglik in
Resource logging upgrade by @RonShvarz in
support elastic with brear by @golanha in
Added error or warning facilitation for unscheduled algs. by @RonShvarz in
Add versions to example algs with no version by @golanha in
streaming metrics for prometheus by @RonShvarz in
grafana trendline fix by @RonShvarz in
Streaming pod count metric, and additionals by @RonShvarz in
streaming metrics for stateless pods by @RonShvarz in
New Contributors
@RonShvarz made their first contribution in
Full Changelog: v2.4.47...v2.5.40"
"8.2.5 release
fix(thumbs): active class gets removed ()

when using library / framework components the classes get updated on events or
lifeycle hooks that are conflicting with the synchronous execution expectation
of the thumbs module
fix(vue): virtualUpdate event is not declared ()
chore: add copyright to scss and less styles

fixes
feat(core): add `changeLanguageDirection` method to change it to RTL/LTR after init

fixes
chore: update playground
8.2.6 release
8.2.6 release","Bug Fixes
thumbs: active class gets removed () (3267616)
vue: virtualUpdate event is not declared () (8b00333)
Features
core: add changeLanguageDirection method to change it to RTL/LTR after init (f5bb7af), closes
navigation: add navigationPrev and navigationNext events (d0c6365), closes"
"9.4.0
fix(core): fix issue with calling freeMode introduced in 9.4.0

fixes
9.4.1","Bug Fixes
core: fix issue with calling freeMode introduced in 9.4.0
(581eea8), closes"
"9.0.3
fix(autoplay): fixing autoplay undefined error ()

Co-authored-by: ilank <ilank@moonsite.co.il>
chore: lint
fix(pagination): fix pagination bullets children clicks

fixes
fix(zoom): fix gesture scale origin

fixes
fix(virtual): grab DOM slides only from wrapper children
9.0.4","Bug Fixes
autoplay: fixing autoplay undefined error ()
pagination: fix pagination bullets children clicks
(8bcff39), closes
virtual: grab DOM slides only from wrapper children
zoom: fix gesture scale origin
(c89b2dd), closes"
"build(deps): bump ssri from 6.0.1 to 6.0.2

Bumps [ssri](https://github.com/npm/ssri) from 6.0.1 to 6.0.2.
- [Release notes](https://github.com/npm/ssri/releases)
- [Changelog](https://github.com/npm/ssri/blob/v6.0.2/CHANGELOG.md)
- [Commits](https://github.com/npm/ssri/compare/v6.0.1...v6.0.2)

Signed-off-by: dependabot[bot] <support@github.com>
build(deps): bump url-parse from 1.4.7 to 1.5.1

Bumps [url-parse](https://github.com/unshiftio/url-parse) from 1.4.7 to 1.5.1.
- [Release notes](https://github.com/unshiftio/url-parse/releases)
- [Commits](https://github.com/unshiftio/url-parse/compare/1.4.7...1.5.1)

Signed-off-by: dependabot[bot] <support@github.com>
build(deps): bump lodash from 4.17.20 to 4.17.21

Bumps [lodash](https://github.com/lodash/lodash) from 4.17.20 to 4.17.21.
- [Release notes](https://github.com/lodash/lodash/releases)
- [Commits](https://github.com/lodash/lodash/compare/4.17.20...4.17.21)

Signed-off-by: dependabot[bot] <support@github.com>
build(deps-dev): bump postcss from 8.2.6 to 8.2.10

Bumps [postcss](https://github.com/postcss/postcss) from 8.2.6 to 8.2.10.
- [Release notes](https://github.com/postcss/postcss/releases)
- [Changelog](https://github.com/postcss/postcss/blob/main/CHANGELOG.md)
- [Commits](https://github.com/postcss/postcss/compare/8.2.6...8.2.10)

Signed-off-by: dependabot[bot] <support@github.com>
fix(CornerAnnotation): Fix position precision truncation

For small values, e.g.

  2.0540516842970646e-8

this was being truncated as

 2.054","Bug Fixes
CornerAnnotation: Fix position precision truncation (dce4a10)"
"fix(userInterface): Use unique CSS class identifiers
chore(Dependencies): Bump vtk.js to 6.4.5","Bug Fixes
userInterface: Use unique CSS class identifiers (09f0c85)"
"fix(Dependencies): Bump itk.js and vtk.js to latest

This addresses some important ImageIO bugs in itk.js.
fix(package-lock.json): Update
ci(TravisCI): Use Node.js version 10

To address:

  8.71s$ npm ci
  npm WARN prepare removing existing node_modules/ before installation
  npm ERR! code MODULE_NOT_FOUND
  npm ERR! Cannot find module 'validate-npm-package-name'
ci(Travis): Use npm install instead of npm ci

To address:
  npm WARN prepare removing existing node_modules/ before installation
  npm ERR! code MODULE_NOT_FOUND
  npm ERR! Cannot find module 'validate-npm-package-name'","Bug Fixes
Dependencies: Bump itk.js and vtk.js to latest (796a26e)
package-lock.json: Update (b4dca88)"
"fix(standalone): Try to fix standalone html
doc(iframe): Remove invalid iframe
fix(UI): Better look and feel","<a name""1.0.4"">
Bug Fixes
UI: Better look and feel (e845e3c6)"
"fix(ZarrMultiscaleSpatialImage): Constrain concurrency for large server

While we want to constrain the max concurrency when there are many more
logical processors on the client than on the server, we should also do
the same when there are many more logical processors on the server than
the client.
refactor(ZarrMultiscaleSpatialImage): consolidate maxConcurrency logic","Bug Fixes
ZarrMultiscaleSpatialImage: Constrain concurrency for large server (6689d94)"
"build(reference-ui): Bump package to 11.9.2
build(Dependencies): Bump semantic-release to 17.4.4
fix(Publish): Move build script execution to prepack

Move later to attempt to fix the Unpkg version from the semantically
released version.","Bug Fixes
Publish: Move build script execution to prepack (35b2a0e)"
"doc(WebSite): Update logo and md
fix(standalone): Publish standalone html file","<a name""1.0.2"">
Bug Fixes
standalone: Publish standalone html file (cfbca5e3)"
"build(deps-dev): bump karma from 5.2.3 to 6.3.16

Bumps [karma](https://github.com/karma-runner/karma) from 5.2.3 to 6.3.16.
- [Release notes](https://github.com/karma-runner/karma/releases)
- [Changelog](https://github.com/karma-runner/karma/blob/master/CHANGELOG.md)
- [Commits](https://github.com/karma-runner/karma/compare/v5.2.3...v6.3.16)

---
updated-dependencies:
- dependency-name: karma
  dependency-type: direct:development
...

Signed-off-by: dependabot[bot] <support@github.com>
fix(createViewerFromUrl): url undefined for image, labelImage
fix(isZarr): Support DANDI urls

Example:

  ""https://dandiarchive.s3.amazonaws.com/zarr/3d313fc2-0204-496d-bfa1-5c90951ee640/""

https://api.dandiarchive.org/api/dandisets/000108/versions/draft/assets/82a44599-7d1f-43d9-8be7-60e82cfdcb5a/","Bug Fixes
createViewerFromUrl: url undefined for image, labelImage (333477b)
isZarr: Support DANDI urls (70c634d)"
"doc(README): Add GitHub Action badge
chore(deps): Bump vtk.js
fix(Viewer): Make labelmap component proportional in volume rendering","Bug Fixes
Viewer: Make labelmap component proportional in volume rendering (d209eca)"
"Update README.md
Update README.md
Rename CookieMonsterDev.js.LICENSE copy.txt to CookieMonsterDev.js.LICENSE.txt
Show Payback Period x clicks
compile
Removed unnecessary lines of code
Push hotfix
Create dependabot.yml
Bump @types/chai from 4.2.16 to 4.2.17

Bumps [@types/chai](https://github.com/DefinitelyTyped/DefinitelyTyped/tree/HEAD/types/chai) from 4.2.16 to 4.2.17.
- [Release notes](https://github.com/DefinitelyTyped/DefinitelyTyped/releases)
- [Commits](https://github.com/DefinitelyTyped/DefinitelyTyped/commits/HEAD/types/chai)

Signed-off-by: dependabot[bot] <support@github.com>
Bump webpack from 5.32.0 to 5.36.2

Bumps [webpack](https://github.com/webpack/webpack) from 5.32.0 to 5.36.2.
- [Release notes](https://github.com/webpack/webpack/releases)
- [Commits](https://github.com/webpack/webpack/compare/v5.32.0...v5.36.2)

Signed-off-by: dependabot[bot] <support@github.com>
Bump ts-loader from 8.1.0 to 9.1.1

Bumps [ts-loader](https://github.com/TypeStrong/ts-loader) from 8.1.0 to 9.1.1.
- [Release notes](https://github.com/TypeStrong/ts-loader/releases)
- [Changelog](https://github.com/TypeStrong/ts-loader/blob/main/CHANGELOG.md)
- [Commits](https://github.com/TypeStrong/ts-loader/compare/v8.1.0...v9.1.1)

Signed-off-by: dependabot[bot] <support@github.com>
Updated ESLint to 7.25.0
Update to new repo location
Stop making report minified
Run tests before build
Expose building and upgrade data to global scope
Colour column of green option
Fix link to old repo
Fix issues with ""till next achievement""
Update Upgrades.js
Sorting fixes
Small optimization when creating temp array for sorting buildings
Bump webpack-cli from 4.6.0 to 4.7.0

Bumps [webpack-cli](https://github.com/webpack/webpack-cli) from 4.6.0 to 4.7.0.
- [Release notes](https://github.com/webpack/webpack-cli/releases)
- [Changelog](https://github.com/webpack/webpack-cli/blob/master/CHANGELOG.md)
- [Commits](https://github.com/webpack/webpack-cli/compare/webpack-cli@4.6.0...webpack-cli@4.7.0)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @types/chai from 4.2.17 to 4.2.18

Bumps [@types/chai](https://github.com/DefinitelyTyped/DefinitelyTyped/tree/HEAD/types/chai) from 4.2.17 to 4.2.18.
- [Release notes](https://github.com/DefinitelyTyped/DefinitelyTyped/releases)
- [Commits](https://github.com/DefinitelyTyped/DefinitelyTyped/commits/HEAD/types/chai)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/eslint-plugin from 4.22.0 to 4.22.1

Bumps [@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/eslint-plugin) from 4.22.0 to 4.22.1.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.22.1/packages/eslint-plugin)

Signed-off-by: dependabot[bot] <support@github.com>
Bump ts-loader from 9.1.1 to 9.1.2

Bumps [ts-loader](https://github.com/TypeStrong/ts-loader) from 9.1.1 to 9.1.2.
- [Release notes](https://github.com/TypeStrong/ts-loader/releases)
- [Changelog](https://github.com/TypeStrong/ts-loader/blob/main/CHANGELOG.md)
- [Commits](https://github.com/TypeStrong/ts-loader/compare/v9.1.1...v9.1.2)

Signed-off-by: dependabot[bot] <support@github.com>
Bump mocha from 8.3.2 to 8.4.0

Bumps [mocha](https://github.com/mochajs/mocha) from 8.3.2 to 8.4.0.
- [Release notes](https://github.com/mochajs/mocha/releases)
- [Changelog](https://github.com/mochajs/mocha/blob/master/CHANGELOG.md)
- [Commits](https://github.com/mochajs/mocha/compare/v8.3.2...v8.4.0)

Signed-off-by: dependabot[bot] <support@github.com>
Bump eslint from 7.25.0 to 7.26.0

Bumps [eslint](https://github.com/eslint/eslint) from 7.25.0 to 7.26.0.
- [Release notes](https://github.com/eslint/eslint/releases)
- [Changelog](https://github.com/eslint/eslint/blob/master/CHANGELOG.md)
- [Commits](https://github.com/eslint/eslint/compare/v7.25.0...v7.26.0)

Signed-off-by: dependabot[bot] <support@github.com>
Bump prettier from 2.2.1 to 2.3.0

Bumps [prettier](https://github.com/prettier/prettier) from 2.2.1 to 2.3.0.
- [Release notes](https://github.com/prettier/prettier/releases)
- [Changelog](https://github.com/prettier/prettier/blob/main/CHANGELOG.md)
- [Commits](https://github.com/prettier/prettier/compare/2.2.1...2.3.0)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/parser from 4.22.0 to 4.22.1

Bumps [@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/parser) from 4.22.0 to 4.22.1.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/parser/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.22.1/packages/parser)

Signed-off-by: dependabot[bot] <support@github.com>
Bump webpack from 5.36.2 to 5.37.0

Bumps [webpack](https://github.com/webpack/webpack) from 5.36.2 to 5.37.0.
- [Release notes](https://github.com/webpack/webpack/releases)
- [Commits](https://github.com/webpack/webpack/compare/v5.36.2...v5.37.0)

Signed-off-by: dependabot[bot] <support@github.com>
Bump eslint-plugin-import from 2.22.1 to 2.23.2

Bumps [eslint-plugin-import](https://github.com/benmosher/eslint-plugin-import) from 2.22.1 to 2.23.2.
- [Release notes](https://github.com/benmosher/eslint-plugin-import/releases)
- [Changelog](https://github.com/benmosher/eslint-plugin-import/blob/master/CHANGELOG.md)
- [Commits](https://github.com/benmosher/eslint-plugin-import/compare/v2.22.1...v2.23.2)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/eslint-plugin from 4.22.1 to 4.23.0

Bumps [@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/eslint-plugin) from 4.22.1 to 4.23.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.23.0/packages/eslint-plugin)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/parser from 4.22.1 to 4.23.0

Bumps [@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/parser) from 4.22.1 to 4.23.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/parser/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.23.0/packages/parser)

Signed-off-by: dependabot[bot] <support@github.com>
Bump ts-node from 9.1.1 to 10.0.0

Bumps [ts-node](https://github.com/TypeStrong/ts-node) from 9.1.1 to 10.0.0.
- [Release notes](https://github.com/TypeStrong/ts-node/releases)
- [Commits](https://github.com/TypeStrong/ts-node/compare/v9.1.1...v10.0.0)

Signed-off-by: dependabot[bot] <support@github.com>
Bump eslint-plugin-import from 2.23.2 to 2.23.3

Bumps [eslint-plugin-import](https://github.com/benmosher/eslint-plugin-import) from 2.23.2 to 2.23.3.
- [Release notes](https://github.com/benmosher/eslint-plugin-import/releases)
- [Changelog](https://github.com/benmosher/eslint-plugin-import/blob/master/CHANGELOG.md)
- [Commits](https://github.com/benmosher/eslint-plugin-import/compare/v2.23.2...v2.23.3)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/parser from 4.23.0 to 4.24.0

Bumps [@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/parser) from 4.23.0 to 4.24.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/parser/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.24.0/packages/parser)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/eslint-plugin from 4.23.0 to 4.24.0

Bumps [@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/eslint-plugin) from 4.23.0 to 4.24.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.24.0/packages/eslint-plugin)

Signed-off-by: dependabot[bot] <support@github.com>
Bump webpack from 5.37.0 to 5.37.1

Bumps [webpack](https://github.com/webpack/webpack) from 5.37.0 to 5.37.1.
- [Release notes](https://github.com/webpack/webpack/releases)
- [Commits](https://github.com/webpack/webpack/compare/v5.37.0...v5.37.1)

Signed-off-by: dependabot[bot] <support@github.com>
Bump eslint from 7.26.0 to 7.27.0

Bumps [eslint](https://github.com/eslint/eslint) from 7.26.0 to 7.27.0.
- [Release notes](https://github.com/eslint/eslint/releases)
- [Changelog](https://github.com/eslint/eslint/blob/master/CHANGELOG.md)
- [Commits](https://github.com/eslint/eslint/compare/v7.26.0...v7.27.0)

Signed-off-by: dependabot[bot] <support@github.com>
Bump ts-loader from 9.1.2 to 9.2.2

Bumps [ts-loader](https://github.com/TypeStrong/ts-loader) from 9.1.2 to 9.2.2.
- [Release notes](https://github.com/TypeStrong/ts-loader/releases)
- [Changelog](https://github.com/TypeStrong/ts-loader/blob/main/CHANGELOG.md)
- [Commits](https://github.com/TypeStrong/ts-loader/compare/v9.1.2...v9.2.2)

Signed-off-by: dependabot[bot] <support@github.com>
Simple refactor of calculation
Optimize & fix LeftTillNext calculation
Make current season green in Stats section
Update README.md
Add option for autosave timer bar
Bump typescript from 4.2.4 to 4.3.2

Bumps [typescript](https://github.com/Microsoft/TypeScript) from 4.2.4 to 4.3.2.
- [Release notes](https://github.com/Microsoft/TypeScript/releases)
- [Commits](https://github.com/Microsoft/TypeScript/compare/v4.2.4...v4.3.2)

Signed-off-by: dependabot[bot] <support@github.com>
Bump webpack from 5.37.1 to 5.38.1

Bumps [webpack](https://github.com/webpack/webpack) from 5.37.1 to 5.38.1.
- [Release notes](https://github.com/webpack/webpack/releases)
- [Commits](https://github.com/webpack/webpack/compare/v5.37.1...v5.38.1)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/eslint-plugin from 4.24.0 to 4.25.0

Bumps [@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/eslint-plugin) from 4.24.0 to 4.25.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.25.0/packages/eslint-plugin)

Signed-off-by: dependabot[bot] <support@github.com>
Bump eslint-plugin-import from 2.23.3 to 2.23.4

Bumps [eslint-plugin-import](https://github.com/benmosher/eslint-plugin-import) from 2.23.3 to 2.23.4.
- [Release notes](https://github.com/benmosher/eslint-plugin-import/releases)
- [Changelog](https://github.com/benmosher/eslint-plugin-import/blob/master/CHANGELOG.md)
- [Commits](https://github.com/benmosher/eslint-plugin-import/compare/v2.23.3...v2.23.4)

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/parser from 4.24.0 to 4.25.0

Bumps [@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/parser) from 4.24.0 to 4.25.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/parser/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.25.0/packages/parser)

Signed-off-by: dependabot[bot] <support@github.com>
Adding auto branch merge
Adding option to sort buildings by price until next achievement
Update and rename merge-branch.yml to publish-dev.yml
Update publish-dev.yml
Bump ts-loader from 9.2.2 to 9.2.3

Bumps [ts-loader](https://github.com/TypeStrong/ts-loader) from 9.2.2 to 9.2.3.
- [Release notes](https://github.com/TypeStrong/ts-loader/releases)
- [Changelog](https://github.com/TypeStrong/ts-loader/blob/main/CHANGELOG.md)
- [Commits](https://github.com/TypeStrong/ts-loader/compare/v9.2.2...v9.2.3)

---
updated-dependencies:
- dependency-name: ts-loader
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/eslint-plugin from 4.25.0 to 4.26.0

Bumps [@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/eslint-plugin) from 4.25.0 to 4.26.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.26.0/packages/eslint-plugin)

---
updated-dependencies:
- dependency-name: ""@typescript-eslint/eslint-plugin""
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump eslint from 7.27.0 to 7.28.0

Bumps [eslint](https://github.com/eslint/eslint) from 7.27.0 to 7.28.0.
- [Release notes](https://github.com/eslint/eslint/releases)
- [Changelog](https://github.com/eslint/eslint/blob/master/CHANGELOG.md)
- [Commits](https://github.com/eslint/eslint/compare/v7.27.0...v7.28.0)

---
updated-dependencies:
- dependency-name: eslint
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/parser from 4.25.0 to 4.26.0

Bumps [@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/parser) from 4.25.0 to 4.26.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/parser/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.26.0/packages/parser)

---
updated-dependencies:
- dependency-name: ""@typescript-eslint/parser""
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump prettier from 2.3.0 to 2.3.1

Bumps [prettier](https://github.com/prettier/prettier) from 2.3.0 to 2.3.1.
- [Release notes](https://github.com/prettier/prettier/releases)
- [Changelog](https://github.com/prettier/prettier/blob/main/CHANGELOG.md)
- [Commits](https://github.com/prettier/prettier/compare/2.3.0...2.3.1)

---
updated-dependencies:
- dependency-name: prettier
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Update sort to handle the case where the source data is out of order
Bump @typescript-eslint/parser from 4.26.0 to 4.26.1

Bumps [@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/parser) from 4.26.0 to 4.26.1.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/parser/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.26.1/packages/parser)

---
updated-dependencies:
- dependency-name: ""@typescript-eslint/parser""
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump webpack-cli from 4.7.0 to 4.7.2

Bumps [webpack-cli](https://github.com/webpack/webpack-cli) from 4.7.0 to 4.7.2.
- [Release notes](https://github.com/webpack/webpack-cli/releases)
- [Changelog](https://github.com/webpack/webpack-cli/blob/master/CHANGELOG.md)
- [Commits](https://github.com/webpack/webpack-cli/compare/webpack-cli@4.7.0...webpack-cli@4.7.2)

---
updated-dependencies:
- dependency-name: webpack-cli
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/eslint-plugin from 4.26.0 to 4.26.1

Bumps [@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/eslint-plugin) from 4.26.0 to 4.26.1.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.26.1/packages/eslint-plugin)

---
updated-dependencies:
- dependency-name: ""@typescript-eslint/eslint-plugin""
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Fixing Pop All Normal wrinkler tooltip
Bump typescript from 4.3.2 to 4.3.4

Bumps [typescript](https://github.com/Microsoft/TypeScript) from 4.3.2 to 4.3.4.
- [Release notes](https://github.com/Microsoft/TypeScript/releases)
- [Commits](https://github.com/Microsoft/TypeScript/compare/v4.3.2...v4.3.4)

---
updated-dependencies:
- dependency-name: typescript
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/eslint-plugin from 4.26.1 to 4.27.0

Bumps [@typescript-eslint/eslint-plugin](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/eslint-plugin) from 4.26.1 to 4.27.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.27.0/packages/eslint-plugin)

---
updated-dependencies:
- dependency-name: ""@typescript-eslint/eslint-plugin""
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump @types/chai from 4.2.18 to 4.2.19

Bumps [@types/chai](https://github.com/DefinitelyTyped/DefinitelyTyped/tree/HEAD/types/chai) from 4.2.18 to 4.2.19.
- [Release notes](https://github.com/DefinitelyTyped/DefinitelyTyped/releases)
- [Commits](https://github.com/DefinitelyTyped/DefinitelyTyped/commits/HEAD/types/chai)

---
updated-dependencies:
- dependency-name: ""@types/chai""
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump eslint from 7.28.0 to 7.29.0

Bumps [eslint](https://github.com/eslint/eslint) from 7.28.0 to 7.29.0.
- [Release notes](https://github.com/eslint/eslint/releases)
- [Changelog](https://github.com/eslint/eslint/blob/master/CHANGELOG.md)
- [Commits](https://github.com/eslint/eslint/compare/v7.28.0...v7.29.0)

---
updated-dependencies:
- dependency-name: eslint
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump webpack from 5.38.1 to 5.39.1

Bumps [webpack](https://github.com/webpack/webpack) from 5.38.1 to 5.39.1.
- [Release notes](https://github.com/webpack/webpack/releases)
- [Commits](https://github.com/webpack/webpack/compare/v5.38.1...v5.39.1)

---
updated-dependencies:
- dependency-name: webpack
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Bump @typescript-eslint/parser from 4.26.1 to 4.27.0

Bumps [@typescript-eslint/parser](https://github.com/typescript-eslint/typescript-eslint/tree/HEAD/packages/parser) from 4.26.1 to 4.27.0.
- [Release notes](https://github.com/typescript-eslint/typescript-eslint/releases)
- [Changelog](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/parser/CHANGELOG.md)
- [Commits](https://github.com/typescript-eslint/typescript-eslint/commits/v4.27.0/packages/parser)

---
updated-dependencies:
- dependency-name: ""@typescript-eslint/parser""
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Add Achievements section to Stats page
Update package-lock
Add info about next achievement in stats
Push to 2.031.9
Update CookieMonster.js","This update implements the following functions:
For developers: we now expose some data calculated by Cookie Monster to the global scope. You can access it through the CookieMonsterData object ()
The column with the most optimal building now has a green coloured indicator whenever colour coding is turned on ()
The current season in the seasons statistics section is now displayed with green text for easier identification ()
New option to show a timer bar that counts down till next autosave ()
New option to sort buildings based on the ""cost till next achievement"" ()
Added extra information about achievements in statistics page ()
This update fixes the following bugs:
HOTFIX: Fixed the possibility of clicking Golden Cookies multiple times with autoclickers ()
Fixed a bug where ignoring certain buildings in rare cases did not create a ""most optimal building"" ()
Fixed some issues related to ""left till achievement"" ()
Fixed some cases where upgrades and buildings were not correctly sorted ()
Fixed the tooltip of ""Pop all normal wrinklers"" displaying an incorrect reward when Shiny's are present ()"
"build(deps-dev): bump @rollup/plugin-typescript from 11.0.0 to 11.1.0 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps-dev): bump webpack from 5.76.1 to 5.78.0 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps-dev): bump @rollup/plugin-node-resolve from 15.0.1 to 15.0.2 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps): bump eslint-config-prettier from 8.7.0 to 8.8.0 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
fix: cannot extend DayPickerProps, DataAttributes interface ()
Bump v8.7.1","What's Changed
fix: cannot extend DayPickerProps, DataAttributes interface by @gpbl in
Full Changelog: v8.7.0...v8.7.1"
"build: bump v8.8.1
build(deps-dev): bump rollup-plugin-dts from 5.3.0 to 5.3.1 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps-dev): bump jest and @types/jest ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps-dev): bump @testing-library/dom from 9.3.0 to 9.3.1 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps-dev): bump tslib from 2.5.0 to 2.6.2 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps-dev): bump eslint-plugin-import from 2.27.5 to 2.28.1 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
docs: fix typo in Matcher example ()
build(deps-dev): bump @types/react from 18.0.38 to 18.2.21 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
build(deps): bump focus-trap-react from 10.1.1 to 10.2.1 ()

Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
fix(a11y): Remove rowgroup role from tbody element ()
build: bump v8.8.2","What's Changed
Bug fixes
fix(a11y): remove redundant rowgroup role from tbody element by @gpbl in
Other
docs: fix typo in Matcher example by @triptu in
Dependencies Updates
build(deps-dev): bump rollup-plugin-dts from 5.3.0 to 5.3.1 by @dependabot in
build(deps-dev): bump jest and @types/jest by @dependabot in
build(deps-dev): bump @testing-library/dom from 9.3.0 to 9.3.1 by @dependabot in
build(deps-dev): bump tslib from 2.5.0 to 2.6.2 by @dependabot in
build(deps-dev): bump eslint-plugin-import from 2.27.5 to 2.28.1 by @dependabot in
build(deps-dev): bump @types/react from 18.0.38 to 18.2.21 by @dependabot in
build(deps): bump focus-trap-react from 10.1.1 to 10.2.1 by @dependabot in
New Contributors
@triptu made their first contribution in
Full Changelog: v8.8.1...v8.8.2"
"feat: add excludeDisabled prop for range mode ()

* feat: add excludeDisabled for range mode

* Update test
build(deps-dev): bump @testing-library/dom from 10.3.1 to 10.4.0 ()
build(deps-dev): bump typedoc from 0.26.3 to 0.26.5 ()
build(deps-dev): bump eslint-plugin-react from 7.34.4 to 7.35.0 ()
Bump v9.0.2
build(deps-dev): bump ts-jest from 29.2.2 to 29.2.3 ()

Bumps [ts-jest](https://github.com/kulshekhar/ts-jest) from 29.2.2 to 29.2.3.
- [Release notes](https://github.com/kulshekhar/ts-jest/releases)
- [Changelog](https://github.com/kulshekhar/ts-jest/blob/main/CHANGELOG.md)
- [Commits](https://github.com/kulshekhar/ts-jest/compare/v29.2.2...v29.2.3)

---
updated-dependencies:
- dependency-name: ts-jest
  dependency-type: direct:development
  update-type: version-update:semver-patch
...

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: Giampaolo Bellavite <io@gpbl.dev>
build(deps-dev): bump eslint-plugin-prettier from 5.1.3 to 5.2.1 ()

Bumps [eslint-plugin-prettier](https://github.com/prettier/eslint-plugin-prettier) from 5.1.3 to 5.2.1.
- [Release notes](https://github.com/prettier/eslint-plugin-prettier/releases)
- [Changelog](https://github.com/prettier/eslint-plugin-prettier/blob/master/CHANGELOG.md)
- [Commits](https://github.com/prettier/eslint-plugin-prettier/compare/v5.1.3...v5.2.1)

---
updated-dependencies:
- dependency-name: eslint-plugin-prettier
  dependency-type: direct:development
  update-type: version-update:semver-minor
...

Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
playground: add reset button to selection
fix: alignment of grid elements ()

fix: alignment of grid not being properly aligned
fix: range mode not updating when selected prop changes ()

* fix: alignment of grid not being properly aligned

* fix: use range not updating when selected prop changes

* Remove console.log
Bump v9.0.3","This release fixes two issues found with the grid style and the range mode.
What's Changed
fix: alignment of grid elements by @gpbl in
fix: range mode not updating when selected prop changes by @gpbl in
Full Changelog: v9.0.2...v9.0.3"
"doc/tutorial/basics: some minor fixes

preparing for transformation to Hugo, mostlyl

Change-Id: Iac74644a5e781912fd1e45cc39f60baa05d27683
Reviewed-on: https://cue-review.googlesource.com/c/cue/+/3263
Reviewed-by: Marcel van Lohuizen <mpvl@golang.org>
cue: eliminate generation of block quotes

Issue

Change-Id: I73ac50d03372eccef55f510a582e8c49e7434d0a
Reviewed-on: https://cue-review.googlesource.com/c/cue/+/3262
Reviewed-by: Marcel van Lohuizen <mpvl@golang.org>
cue: fix bug in type inference

used wrong type inference function for numbers

Fixes

Change-Id: Ia215bffdf368ef2d96a19a8c7b2c7437c2af5d66
Reviewed-on: https://cue-review.googlesource.com/c/cue/+/3280
Reviewed-by: Marcel van Lohuizen <mpvl@golang.org>
cue/parser: allow full expressions for embeddings

This completes the implementation of the spec
allowing expressions for embeddings.

It also lifts the restriction in the spec.

Futher relaxing would be possible, but requires
lookahead.

Not that this is not unlike the Go ambiguity:
if foo == myStruct{} {
}
where parenthesis are required around the struct
literal.

Closes.

Change-Id: I629fc6e7a65612bbe754863ffd79a36b39a50dfe
Reviewed-on: https://cue-review.googlesource.com/c/cue/+/3300
Reviewed-by: Marcel van Lohuizen <mpvl@golang.org>
cue: fixes number groundness inference

When a integer was inferred from restricting
comparators with a difference greater than
1.

Also implemented restricting float ranges
when unified with integers.

Fixes

Change-Id: Ie64a0670392463cc5340ee9f3771ded9c6f2a15d
Reviewed-on: https://cue-review.googlesource.com/c/cue/+/3301
Reviewed-by: Marcel van Lohuizen <mpvl@golang.org>","A few bug fixes
There were a few small bug fixes that, even though old, were serious enough to warrant a new release.
This also finalizes the implementation of allowing full expressions for embeddings.
Changelog
e53305e cue/parser: allow full expressions for embeddings
0ac550c cue: eliminate generation of block quotes
7c9b88c cue: fix bug in type inference
fdd9b71 cue: fixes number groundness inference"
"v7.2.1.0

https://roxy-wi.org/changelog_2_1
v7.2.1.0
v7.2.1.0

Improve error handling in tools list and adjust status check command

Enhanced error handling in tools list loop within the 'common.py' file to provide more specific error messages. Additionally, the command for checking a tool's status was adjusted to remove unnecessary sudo usage. Also, updated the service check in the 'roxy.py' file from 'sshd' to 'rsyslog'.
v7.2.2.0

https://roxy-wi.org/changelog_2_2
v7.2.2.0

Add new deps
v7.2.2.0

Fix JS
v7.2.2.0

Fix tools status showing for Docker
v7.2.2.0

Delete debug output
v7.2.2.0

Fix bug with updating Roxy-WI
v7.2.2.0

Fix haproxy command","The Backup page is AJAX page now
Network status has been added to the System Info
The channels for alerting have separated page
A new version of HAProxy has been added for installation"
"v11.0.1
chore: bump deps
chore: move private lambda tests
chore: remove test.only
test: add test for generated api key ()
chore: move provider.apiGateway.apiKeys tests
chore: destructuring order nit
fix: remove unreachable condition
fix: timeout terminating process ()
test: add tests for timeout termination bug
v11.0.2","Bug Fixes
remove unreachable condition (ae1c8b3)
timeout terminating process () (552081c)"
"v11.1.1
chore: bump deps
chore: destructuring order nit
test: add scenario test for middy, issue ()

Co-authored-by: Henry McIntosh <thehenrymcintosh@gmail.com>
revert: remove unreachable condition, fixes
chore: remove unused @middy/http-error-handler
chore: bump deps
v11.1.2","Bug Fixes
revert: remove unreachable condition (770ed13) thank you @thehenrymcintosh"
"v3.4.0
Fix path to authorization handlers
v3.4.1","Bugfixes
--location -l option now works on authorization handlers."
"v3.15.2
use unprocessed request headers. fixes
v3.15.3","Bugfixes
Header keys passed to your handlers by the event object are now case-sensitive (i.e. are not lowercased anymore). See"
"v5.12.0
check for http event with private: true

fixes
Update deps
Linting/prettier
Fix private http events
v5.12.1","Bugfixes
randomly generated API key is not displayed if no API key is defined (thanks to @christophgysin)"
"v2.2.7
unsupported runtime warning and 404 route
Adds `node4.3` runtime
v2.2.8","Support for Nodev4 runtime. See
Warning on unsupported runtime. See
New catch-all route for 404s tells you what routes are valid."
"v9.1.6
refactor: declare fields, remove from constructor
refactor: declare fields, remove from constructor, part 2
fix: https protocol option default value
refactor: https protocol ternary consistency
refactor: load certs private method
refactor: use conditional spread
v9.1.7","Bug Fixes
https protocol option default value (57f7d87)
Maintenance Improvements
declare fields, remove from constructor (0e82819)
declare fields, remove from constructor, part 2 (364ef2c)
https protocol ternary consistency (2b2a8fa)
load certs private method (33e4e01)
use conditional spread (5dfe577)"
"v6.3.0
Fix typo
Command for running only unit tests
chore(tests): generateHapiPath unit tests
chore(tests): Add integration test for prefix option
fix: Handle star routes
v6.3.1","Bug fix:
Fix * routes handling
Enhancements:
NPM script for running only unit tests
generateHapiPath unit tests, prefix integration test"
"Update wrapping of key missing error

(cherry picked from commit bbb5a55a3539ebad062b4f6b7e1fc08111d91319)
Update video link

(cherry picked from commit 92737c6bf97ef2abf8e3fff1575abe92fd765207)
Remove my_model.py from init CLI command

(cherry picked from commit fef5fae6107f4ebdfe22048269ce0c0448191f3c)
Remove json from valid config file extensions

(cherry picked from commit 50a2528458016fb1d7cd3fac1ef0d9354f1ad118)
Fix constants bug

(cherry picked from commit b7e0aa48b8d9e68d6ebb51be06ff7800d3cb807e)
Support resource references in model target_vocab

(cherry picked from commit 597d844fca6f04404d51e7ec65afa7be64356fb6)
Check if model input is dict before accessing

(cherry picked from commit 80e091e3fa5268afdc9e67c653bf645b5e4749bd)
External constants support ()


(cherry picked from commit 096780a54b607f53764a69438d66747aaa80119d)
Update version to 0.4.1
Update API docs

(cherry picked from commit 99afb4a2fe2cebdda7a4fe0e2ff120dac9cfa243)
Update stable version to 0.4.1","New features:
Support external constants (1vn)
Bug fixes:
Remove my_model.py from init CLI command fef5fae (deliahu)
Fix constant data status bug b7e0aa4 (deliahu)
Support resource references in model target_vocab 597d844 80e091e (deliahu)"
"Update README.md
Update tensorflow resnet50 example README ()


(cherry picked from commit 15e5263ad1619ad7cd2241f52939a6878ccb63a4)
Add troubleshooting page for TF sessions used in predict method ()

Co-authored-by: David Eliahu <deliahu@users.noreply.github.com>
(cherry picked from commit 54d3d26817f17fc070249a7355d16e159f5c73d7)
Add troubleshooting docs for API request errors ()

(cherry picked from commit 25fa19223ae147b3fcea69638eb88e286a283dd7)
Update local model downloading new lines ()


(cherry picked from commit 07480995a34be8852e561265561dc30920a63b80)
Change max limit of processes per API replica ()


(cherry picked from commit 687dc8d692360565acea4d18982dde352e16287e)
Use info log level when TF model is still loading ()


(cherry picked from commit bf19cff209af6cffe137b6df02872e582be4a947)
Add missing extra-index-url & improve Inf docs ()


(cherry picked from commit 7b99d88961193a536f56edf00bc564387ec6cc42)
Check cluster-name tag when choosing load balancer for VPC Link integration ()


(cherry picked from commit 8ad7f726d8e0a2696204f13971c8c978675174da)
Delete API Gateway if cluster up fails ()


(cherry picked from commit b17c225f4dc129473b11576f9e3f8c5a71847a75)
Allow empty cluster config ()


(cherry picked from commit 86eaec7398b2255fc28522b09806cb730c357639)
Update README.md ()

(cherry picked from commit 6de67ad6b80fb079118c3304c80cc166a656d3ff)
Update install docs ()

(cherry picked from commit 1f2390e1c5751457016876588b3c8210a19d431d)
Update version to 0.18.1
Move cortex verification from serve.py to run.sh ()

(cherry picked from commit 5fb3d650a123ab9ae920660ad2a8ab2ceacee972)
Verify operator and image versions match first in run.sh ()

(cherry picked from commit 13adb3708280fd40dc1f059a067af2462d261380)
Update memory capacity calculation
Fix dynamic axes for ONNX models ()


(cherry picked from commit 53c0b37cea91011c72ee232272edf9faca41259e)
Add retries for resource tagging ()


(cherry picked from commit 8b5d3a379e80bf2743036ebc23cb7e0a81d495e0)
Remove unnecessary env var & reposition env var source ()


(cherry picked from commit 884332643c7240194bc7be0bdb5f225fd14c4ea7)
Update README.md

(cherry picked from commit ea5f4fec68a2812e9f627bcd3d97d08474b8e535)
Update stable version to 0.18.1","Bug fixes
Fix dynamic axes for ONNX models (RobertLucian)
Fix memory node capacity calculation for multi-api configuration files (deliahu)
Check cluster-name tag when choosing load balancer for VPC Link integration (deliahu)
New guides
Troubleshooting: API request errors (deliahu)
Troubleshooting: TensorFlow session in predict() (RobertLucian)
Misc
Delete API Gateway if cluster up fails (deliahu)
Move image version verification from serve.py to run.sh (vishalbollu)
Add retries for resource tagging during cluster up (deliahu)
Use info log level when TensorFlow model is being loaded (RobertLucian)
Increase max number of processes per API replica to 100 (RobertLucian)
Allow empty cluster config (deliahu)"
"v4.11.1
📌 versions: up @ant-design/compatible
📸 snapshots: snapshots updated
v4.11.2","snapshots: snapshots updated  189834e
versions: up @ant-design/compatible  388caea"
"v5.0.15
Update .umirc.js
💄 UI: fix PageHeaderWrapper tablist style
🔥 clean: remove unuse code
✅ tests: fix ci
✅ tests: fix ci
5.0.16","tests: fix ci  a3f83c5
tests: fix ci  f1c6320
clean: remove unuse code  9b43e13
UI: fix PageHeaderWrapper tablist style  7b1e29a
Update .umirc.js  2146395"
"Contesting Dupe Check Improvement
Cleanup unused class
Fixes errors when the fields arent there
Returns the correct hamsat user fields
Remove extra comma causing error
Fixed links not being visable
Fixes search dropdown not appearing after editing

Fixes
Fixes
Reformatted the code
[Dashboard|User] Control over what cards are shown on the dashboard
Get ready for version 2.6.7 stable","What's Changed
Dashboard - Side Cards are now selectable (See Notes) by @magicbug
Minor bug fixes and code formatting changes by @magicbug
Contest Logging Dupe Checking Bugfix/Improvement by @DH5DAX in
Add link for DOK districts by @phl0 in
API Workable hamsat passes (You need to provide API key in your account settings) by @phl0 in
Remove extra comma in the user edit save post code causing error by @PartTimeLegend in
Dashboard Cards
You will notice that the cards you used to see on the right side of the dashboard when you login have disappeared this is by design and you can now enable or disable ones that arent relevant to you in your account settings just click your callsign top right and select Account and its under Cloudlog Preferences.
New Contributors
@DH5DAX made their first contribution in
@PartTimeLegend made their first contribution in
Full Changelog: 2.6.6...2.6.7"
"Sync spec test suite - 2022-06-21
Ignore PHPStan readOnlyByPhpDoc rule for FakeEnum::key
Fix PHPStan errors for invalid @var tag
Add FakeEnum.php in PHPStan analyse excludePaths
Sync spec test suite - 2022-06-24
Re-enable the Spec tests for server side rendered amp-audio
Use https instead of http for links
Cache only valid responses
Make tests more flexible
Add test that only valid responses get cached
Always throw an error if the response code is not within the 200s
CI: run tests on PHP 8.2
Avoid dynamic properties in the `Document` class
Avoid dynamic properties in `BaseTransformerConfiguration`
Do not use deprecated `utf8_decode()` function in tests
Support PHP 8.1 in `composer.json`
Stop marking 8.1 tests as experimental
Revert ""Avoid dynamic properties in the `Document` class""

This reverts commit 525e91853ce74d56cdd656ee08dd5494ed3ad200.
Avoid dynamic properties in `Document`
Ignore PHPUnit cache file
Fix more getters
More fixes
More fixes
Update Element class
Undo change to composer.json
Fix incorrect `tagName` access in `MinifyHtml`
Remove now unneeded `isset()` check

Property `DOMElement::$tagName` is not nullable.
Use private members instead of properties array
Use delta for float comparison in testItCanGetNumericDimensions
Avoid unnecessary use of setter

Co-authored-by: Jonny Harris <spacedmonkey@users.noreply.github.com>
Revert ""Use private members instead of properties array""

This reverts commit 3d6cf8967ee09986837c1f5da4bc5ca9355ab96d.
Use properties array instead of using setter
Prevent invoking getter recursively for links property
Add warnings and update addInlineStyleByteCount
Set CURLOPT_FAILONERROR to get the correct curl error code

Otherwise Client Errors (>= 400) return curl error code 0. In case of 404 errors (CURLE_HTTP_NOT_FOUND) it would return 0, instead of 22.
See https://github.com/curl/curl/blob/5ccddf64398c1186deb5769dac086d738e150e09/docs/libcurl/opts/CURLOPT_FAILONERROR.3#L35-L37
Remove CURLE_HTTP_NOT_FOUND from retryable error codes
Add guard to check if passed url is non-empty-string
Add test cases get method
Remove curl CURLOPT_HEADER option as we need to pass TRUE if we want to include them
Update int with bool as CURLOPT_SSL_VERIFYPEER need to be passed as false if not required
Update int with bool
Update ternary with a bool property

Co-authored-by: Weston Ruter <westonruter@google.com>
Explicitly disable CURLOPT_HEADER
Update dealerdirect/phpcodesniffer-composer-installer requirement || ^1.0.0

Updates the requirements on [dealerdirect/phpcodesniffer-composer-installer](https://github.com/PHPCSStandards/composer-installer) to permit the latest version.
- [Release notes](https://github.com/PHPCSStandards/composer-installer/releases)
- [Changelog](https://github.com/PHPCSStandards/composer-installer/blob/main/.github_changelog_generator)
- [Commits](https://github.com/PHPCSStandards/composer-installer/compare/v0.7.1...v1.0.0)

---
updated-dependencies:
- dependency-name: dealerdirect/phpcodesniffer-composer-installer
  dependency-type: direct:development
...

Signed-off-by: dependabot[bot] <support@github.com>","Changes
Re-enable the Spec tests for server side rendered amp-audio by @ediamin in
Cache only valid responses by @dritter in
PHP 8.2 Improvements by @swissspidy in
Bugfixes
Fix PHPStan analysis errors by @ediamin in
Set CURLOPT_FAILONERROR to get the correct curl error code by @dritter in
Fix PHPStan errors by @thelovekesh in
Dependencies
Sync local fallback files by @github-actions in
Update dealerdirect/phpcodesniffer-composer-installer requirement from ^0.7.1 to ^0.7.1 || ^1.0.0 by @dependabot in
Meta
Sync spec test suite by @github-actions in
New Contributors
@swissspidy made their first contribution in
@thelovekesh made their first contribution in
Full Changelog: 0.11.2...0.11.3"
"all: Bump to version 3.2.0
gs: Forward status messages to upstream host
console,oauth: Add withComputedProps hoc
console: Update prop-type library
console: Renew rights group ui logic
console: Rename universal rights to pseudo rights
console: Fix initial value for right forms
console: Fix notification logic for right forms
console,oauth: Update shared messages
console: Fix add collaborator message
dev: Update locales
gs: Add separate interface for status messages
api: Change documented expected error code for unexposed root keys
js: Support nil root keys from crypto service
console: Add support link config
console,oauth: Extend env lib
console: Update prop-type library
console,oauth: Update env selectors
console,oauth: Add optional support button to footer
console: Add support button to console footer
console: Add prop-types to app view
dev: Update locales
util: Reorder ATECC608A types
util: Support ATECC608A-TNGLORA
util: Add default JoinEUI to device template
console,oauth: Refactor app config json structure
console,oauth: Update env structure
all: Fix reading config from files in order
all: Use OS working, home and user config directory for config lookup
api: Add optional file extensions to device template formats
all: Indicate .json file extension for Microchip manifests
oauth: Use config from request context
doc: Update list of supported versions
dev: Update release steps
as: Test frontend formatters
as: Test getting MQTT connection info
all: Test invalid data and signature of Microchip manifests
as: Test MQTT topic structure
gs: Improve test coverage
all: Cleanup and test password checks
all: Add initial template funcs for emails
all: Improve test coverage of pkg/email
all: Test pkg/email/smtp with local smtp server
all: Remove unused log.Must
all: Improve test coverage of pkg/log
all: Remove unused pkg/log/middleware/filter
console: Fix add collaborator message
util: Improve encoding/lorawan package test coverage
util: Improve crypto package test coverage
util: Fix crypto package test organization
all: Enable GS MQTT V2 listener by default and assign port
gcs: Use MQTT V2 for TTKG
cli: Add command to claim end devices
cli: Consistent casing in log warnings
all: Interpret TR005 QR code DevVCode as string
cli: Add application claim (un)authorize commands
api: Fix validation for QR code
all: Add RPC middleware to fallback to default port
ns: Remove nil-checks on specified field masks
api: Change authentication code value to string
util: Validate QR TR005 draft 2 DevVCode
util: Support escaped percentage sign
util: Support encoding end device data in QR codes
cli: Add generating QR codes for end devices
all: Regenerate messages
api: Promote Picture to its own file
api: Add end device QR code generator
all: Add QR code formats and registry
all: Register LoRa Alliance TR005 draft 2 QR code format
dev: Add qrg commit topic
qrg: Add QR code generator component
qrg: Start QR Code Generator component
cli: Use QR Code Generator service to generate QR codes
all: Regenerate messages
cli: Harmonize list format aliases
cli: Read JSON array input as separate objects
console,oauth: Add progress bar component
dev: Update protoc image version
dev: Update proto-related dependencies
util: Converge TLS configuration and check ambiguity
util: Cancel component on init error
util: Support loading TLS certificates from the key vault
all: Regenerate messages
all: Split TLS client and server configuration
all: Add ALPN next protos explicitly for TLS listeners
all: Add TODO for caching the root CA file
util: Add fallback port for https redirection
ns: Assume max data rate index is 5 for predefined channels
console: Add dispatch actions for starting event stream
console: Pass onRestart to events
console: Pass restart logic to notification
console: Display restart button in notification
console: Set error to undefined on start stream success
console: Add restart stream message
all: Make key vault and dependencies context aware
all: Handle key vault initialization errors
util: Rename event to chunk in streams
console: Rename event to chunk in event stream
util: Add component whitelist to path splitter
util: Improve device set helper function
util: Improve scope of makeRequests utility function
util: Add template format list service
util: Add template conversion stream service
util: Add device bulk create service
console: Add redux primitives for device template formats
all: Support fetching from blobs
all: Refactor interop client configuration
dev: Regenerate messages
util: Return fetchers directly in config
console: Add device template format selector
console: Update api tree
dev: Update locales
api: Add TLS setting to AS links
as: Use explicit TLS setting for external NS links
all: Support KEK label escaping
all: Add empty key vault
all: Add dial option discovery and helper
all: Regenerate messages
console,oauth: Add not found route component
console: Handle undefined routes for application sub views
console: Handle undefined routes for device sub views
console: Handle undefined routes for gateway sub views
console: Handle undefined routes for organization sub views
console: Add exact to routes for add views
console: Set action to undefined
all: Clarify get and export cert key vault operations
all: Document key vault certification operations
console,oauth: Hide progress bar estimation when done
console,oauth: Add scroll-to-bottom feature to code editor
console,oauth: Add pulse prop to status component
console,oauth: Add disabled prop for link button
console: Add change handler to fetch select
console: Add bulk create icon
console: Add bulk device create form component
console: Add bulk device creator container
console: Add bulk device add view
console: Update messages
console: Render bulk creation button conditionally
console: Restart organization event stream
all: Use explicit config sources and providers with fallback
all: Add TODOs to get rid of config fallbacks
dev: Add CHANGELOG.md
ci: Reference CHANGELOG.md in release notes
dev: Remove Release notes section from PR templates
doc: Document release note adding
all: Bump to version 3.2.1","Added
support-link URI config to the Console to show a ""Get Support"" button.
Option to explicitly enable TLS for linking of an Application Server on an external Network Server.
Service to list QR code formats and generate QR codes in PNG format.
Status message forwarding functions to upstream host/s.
Support for authorizing device claiming on application level through CLI. See ttn-lw-cli application claim authorize --help for more information.
Support for claiming end devices through CLI. See ttn-lw-cli end-device claim --help for more information.
Support for converting Microchip ATECC608A-TNGLORA manifest files to device templates.
Support for Crypto Servers that do not expose device root keys.
Support for generating QR codes for claiming. See ttn-lw-cli end-device generate-qr --help for more information.
Support for storage of frequency plans, device repository and interoperability configurations in AWS S3 buckets or GCP blobs.
Changed
Enable the V2 MQTT gateway listener by default on ports 1881/8881.
Improve handling of API-Key and Collaborator rights in the console.
Fixed
Fix bug with logout sometimes not working in the console.
Fix not respecting RootCA and InsecureSkipVerify TLS settings when ACME was configured for requesting TLS certificates.
Fix reading configuration from current, home and XDG directories.
Docker images
docker pull thethingsnetwork/lorawan-stack:latest
docker pull thethingsnetwork/lorawan-stack:3
docker pull thethingsnetwork/lorawan-stack:3.2
docker pull thethingsnetwork/lorawan-stack:3.2.1"
"Merge pull request from rvolosatovs/fix/ns-as-fcnt

Send full FCnt to AS
Merge pull request from rvolosatovs/feature/ns-uplink-buffer-config

Configurable application uplink queue size
doc: Update CHANGELOG
all: Bump to version 3.8.7","Release notes
Docker images
docker pull thethingsnetwork/lorawan-stack:3.8
docker pull thethingsnetwork/lorawan-stack:3.8.7"
